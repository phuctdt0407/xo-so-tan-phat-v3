(function(){var n=baseAppPath+"/activity/views/";routes.activity={url:"/activity",abstract:!0,template:"<ui-view><\/ui-view>"};routes.activity.groupLotteryManage={url:"/groupLotteryManage",templateUrl:n+"groupLotteryManage.html"+versionTemplate,controller:"Activity.groupLotteryManage as $vm",resolve:{viewModel:["$q","reportService",function(n){var t=n.defer();return n.all([]).then(function(){t.resolve({})}),t.promise}]},title:"Quản lý vé"};routes.activity.groupMoneyManage={url:"/groupMoneyManage",templateUrl:n+"groupMoneyManage.html"+versionTemplate,controller:"Activity.groupMoneyManage as $vm",resolve:{viewModel:["$q","reportService",function(n){var t=n.defer();return n.all([]).then(function(){t.resolve({})}),t.promise}]},title:"Quản lý tiền"};routes.activity.manage={url:"/manage?day",params:{day:{value:"",squash:!0}},templateUrl:n+"manage_v2.html"+versionTemplate,controller:"Activity.manage as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(t);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,n.all([r.getDataDistributeForSalePoint({lotteryDate:f.day}),u.agencyDDL(),u.lotteryChannelDDL({regionId:2,lotteryDate:f.day}),u.salePointDDL(),r.getDataReceivedFromAgency({lotteryDate:f.day}),]).then(function(n){var t={params:f,listData:n[0],listAgency:n[1],listLottery:n[2],listSalePoint:n[3],listTotalAgency:n[4]};e.resolve(t)}),e.promise}]},title:"Chia vé cho điểm bán"};routes.activity.manageScratchcard={url:"/manageScratchcard?day",params:{day:{value:"",squash:!0}},templateUrl:n+"manageScratchcard.html"+versionTemplate,controller:"Activity.manageScratchcard as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(t);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,n.all([u.agencyDDL(),u.salePointDDL(),r.getDataDistributeScratchForSalePoint(),r.getScratchcardFull(),u.lotteryChannelDDL({regionId:2}),]).then(function(n){var t={params:f,listAgency:n[0],listSalePoint:n[1],listData:n[2],totalScratchcard:n[3],listLotteryDDL:n[4]};e.resolve(t)}),e.promise}]},title:"Chia vé cào"};routes.activity.create={url:"/create?day",params:{day:{value:"",squash:!0}},templateUrl:n+"create.html"+versionTemplate,controller:"Activity.create as $vm",resolve:{viewModel:["$q","$stateParams","userService","ddlService","activityService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(t);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,n.all([r.agencyDDL(),r.lotteryChannelDDL({regionId:2,lotteryDate:f.day}),u.getDataReceivedFromAgency({lotteryDate:f.day})]).then(function(n){var t={params:f,listAgency:n[0],listLottery:n[1],listTotal:n[2]};e.resolve(t)}),e.promise}]},title:"Nhận vé từ đại lý"};routes.activity.createScratchcard={url:"/createScratchcard?day",params:{day:{value:"",squash:!0}},templateUrl:n+"createScratchcard.html"+versionTemplate,controller:"Activity.createScratchcard as $vm",resolve:{viewModel:["$q","$stateParams","userService","ddlService","activityService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(t);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,n.all([r.agencyDDL(),u.getDataScratchcardFromAgency({date:f.day}),r.lotteryChannelDDL({regionId:2}),]).then(function(n){var t={params:f,listAgency:n[0],listData:n[1],listLotteryDDL:n[2]};e.resolve(t)}),e.promise}]},title:"Nhận vé cào"};routes.activity.salesActivity={url:"/salesActivity?shiftDistributeId&shiftId&clientType&wholesaleId",params:{shiftDistributeId:{value:"",squash:!0},shiftId:{value:"",squash:!0},clientType:{value:"1",squash:!0},wholesaleId:{value:"",squash:!0}},templateUrl:n+"salesActivity.html"+versionTemplate,controller:"Activity.salesActivity as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","ddlService",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(i);return e.clientType=parseInt(e.clientType),n.all([u.getDataSell({shiftDistributeId:e.shiftDistributeId,userRoleId:t.sessionInfo.UserRoleId,date:moment().format("YYYY-MM-DD")}),f.lotteryPriceDDL(),f.lotteryTypeDDL(),f.lotteryChannelDDL({regionId:2,lotteryDate:e.day}),f.lotteryChannelDDL({regionId:2,lotteryDate:moment().format("YYYY-MM-DD")}),]).then(function(n){var t={params:e,listSellData:n[0],listTypeSelect:n[1],listTypeDDL:n[2],listLottery:n[3],listLotteryToday:n[4]};o.resolve(t)}),o.promise}]},title:"Bán hàng"};routes.activity.inventoryManage={url:"/inventoryManage?day",params:{day:{value:"",squash:!0}},templateUrl:n+"inventoryManage.html"+versionTemplate,controller:"Activity.InventoryManage as $vm",resolve:{viewModel:["$q","$stateParams","$rootScope","activityService","ddlService",function(n,t,i,r){var f=n.defer(),u=angular.copy(t);return u.day=u.day==""?moment().format("YYYY-MM-DD"):u.day,n.all([r.getInventoryLog({date:u.day})]).then(function(n){var t={params:u,listInventory:n[0]};f.resolve(t)}),f.promise}]},title:"Chuyển nhận vé"};routes.activity.moveTicket={url:"/moveTicket?day",params:{day:{value:"",squash:!0}},templateUrl:n+"moveTicket.html"+versionTemplate,controller:"Activity.moveTicket as $vm",resolve:{viewModel:["$q","$stateParams","$rootScope","activityService","ddlService",function(n,t,i,r){var f=n.defer(),u=angular.copy(t);return u.day=u.day==""?moment().format("YYYY-MM-DD"):u.day,n.all([r.getSalePointReturn({date:u.day})]).then(function(n){var t={params:u,listInventory:n[0]};f.resolve(t)}),f.promise}]},title:"Kho ế"};routes.activity.checkTransfer={url:"/checkTransfer?p&ps&day&salePointId&transitionTypeId",params:{p:{value:"1",squash:!0},ps:{value:"100",squash:!0},day:{value:"",squash:!0},salePointId:{value:"0",squash:!0},transitionTypeId:{value:"0",squash:!0}},templateUrl:n+"checkTransfer.html"+versionTemplate,controller:"Activity.checkTransfer as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","$rootScope",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(t);return e.day=e.day==""?moment().format("YYYY-MM-DD"):e.day,n.all([r.getTransitionListToConfirm({p:e.p,ps:e.ps,date:e.day,salePointId:e.salePointId,transitionTypeId:e.transitionTypeId,userRoleId:f.sessionInfo.UserRoleId}),u.lotteryChannelDDL({regionId:2}),u.salePointDDL(),]).then(function(n){var t={params:e,listConfirm:n[0],listLottery:n[1],listsalePoint:n[2]};o.resolve(t)}),o.promise}]},title:"Yêu cầu chuyển nhận vé"};routes.activity.selectSalepoint={url:"/selectSalepoint?day",params:{day:{value:"",squash:!0}},templateUrl:n+"selectSalepoint.html"+versionTemplate,controller:"Activity.selectSalepoint as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","ddlService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(i);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,n.all([u.getShiftDistributeByDate({date:moment().format("YYYY-MM-DD"),userId:t.sessionInfo.UserId})]).then(function(n){var t={params:f,listData:n[0]};e.resolve(t)}),e.promise}]},title:"Chọn điểm bán"};routes.activity.manageConfirm={url:"/manageConfirm?salePointId&guestId",params:{salePointId:{value:"",squash:!0},guestId:{value:"",squash:!0}},templateUrl:n+"manageConfirm.html"+versionTemplate,controller:"Activity.manageConfirm as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u,f,e){var s=n.defer(),o=angular.copy(i);return n.all([f.salePointDDL(),f.getGuestDDL({salePointId:o.salePointId}),e.getListConfirmPayment(o),f.lotteryChannelDDL({regionId:2})]).then(function(n){var t={params:o,listSalePoint:n[0],listGuest:n[1],listData:n[2],listLottery:n[3]};s.resolve(t)}),s.promise}]},title:"Quản lý yêu cầu khách nợ"};routes.activity.agencyPrice={url:"/agencyPrice",params:{},templateUrl:n+"agencyPrice.html"+versionTemplate,controller:"Activity.agencyPrice as $vm",resolve:{viewModel:["$q","$stateParams","activityService","ddlService",function(n,t,i,r){var f=n.defer(),u=angular.copy(t);return u.day=u.day==""?moment().format("YYYY-MM-DD"):u.day,n.all([i.getLotteryPriceAgency(),r.agencyDDL(),r.lotteryChannelDDL({regionId:2})]).then(function(n){var t={params:u,listData:n[0],listAgency:n[1],listLottery:n[2]};f.resolve(t)}),f.promise}]},title:"Giá vé từ đại lý"};routes.activity.returnAgency={url:"/returnAgency?day",params:{day:{value:"",squash:!0}},templateUrl:n+"returnAgency.html"+versionTemplate,controller:"Activity.returnAgency as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(t);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,n.all([r.getListLotteryForReturn({lotteryDate:f.day}),u.agencyDDL(),u.lotteryChannelDDL({regionId:2,lotteryDate:f.day}),u.lotteryChannelDDL({regionId:2})]).then(function(n){var t={params:f,listData:n[0],listAgency:n[1],listLottery:n[2],listScratchCard:n[3]};e.resolve(t)}),e.promise}]},title:"Trả ế đại lý"};routes.activity.managePayment={url:"/managePayment?ps&p&salePointId&date&tab",params:{p:{value:"1",squash:!0},ps:{value:"100",squash:!0},date:{value:"",squash:!0},salePointId:{value:"0",squash:!0},tab:{value:"",squash:!0}},templateUrl:n+"managePayment.html"+versionTemplate,controller:"Activity.managePayment as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(t);return e.date=e.date==""?moment().format("YYYY-MM-DD"):e.date,n.all([u.salePointDDL(),f.getListPaymentForConfirm(e)]).then(function(n){var t={params:e,listSalePoint:n[0],listPayment:n[1]};o.resolve(t)}),o.promise}]},title:"Quản lý chuyển khoản"};routes.activity.purchaseHistory={url:"/purchaseHistory",params:{},templateUrl:n+"purchaseHistory.html"+versionTemplate,controller:"Activity.purchaseHistory as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u,f){var e=n.defer(),o=angular.copy(t);return n.all([u.salePointDDL(),f.getListHistoryOfGuest({guestId:1})]).then(function(n){var t={params:o,listSalePoint:n[0],data:n[1]};e.resolve(t)}),e.promise}]},title:"Lịch sử mua hàng"};routes.activity.requestOwnDebt={url:"/requestOwnDebt?date&userId&p&ps",params:{p:{value:"1",squash:!0},ps:{value:"100",squash:!0},date:{value:"",squash:!0},userId:{value:"",squash:!0}},templateUrl:n+"requestOwnDebt.html"+versionTemplate,controller:"Activity.requestOwnDebt as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r){var f=n.defer(),u=angular.copy(i);return u.date=u.date!=""?u.date:moment().format("YYYY-MM-DD"),u.userId=u.userId!=""?u.userId:t.sessionInfo.UserId,n.all([r.getListBorrowForConfirm(u)]).then(function(n){var t={params:u,listBorrow:n[0]};f.resolve(t)}),f.promise}]},title:"Yêu cầu nợ riêng"};routes.activity.ownDebtManage={url:"/ownDebtManage?month&userId",params:{p:{value:"1",squash:!0},ps:{value:"100",squash:!0},month:{value:"",squash:!0},userId:{value:"",squash:!0},date:{value:"",squash:!0},tab:{value:"",squash:!0}},templateUrl:n+"ownDebtManage.html"+versionTemplate,controller:"Activity.ownDebtManage as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(i);return e.month=e.month!=""?e.month:moment().format("YYYY-MM"),e.date=e.date!=""?e.date:moment().format("YYYY-MM-DD"),e.tab=e.tab!=""?e.tab:1,n.all([r.getListBorrowForConfirm({p:e.p,ps:e.ps,userId:e.userId,date:e.date}),r.getListBorrowInMonth({month:e.month,userId:e.userId}),f.getUserDDL({userTitleId:4})]).then(function(n){n[2].unshift({UserId:0,FullName:"Tất cả"});var t={params:e,listBorrow:n[0],listDetail:n[1],listLeader:n[2]};o.resolve(t)}),o.promise}]},title:"Quản lý nợ riêng"};routes.activity.moneyVietlott={url:"/moneyVietlott?month",params:{month:{value:"",squash:!0}},templateUrl:n+"moneyVietlott.html"+versionTemplate,controller:"Activity.moneyVietlott as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(t);return e.month=e.month!=""?e.month:moment().format("YYYY-MM"),n.all([f.getListPayVietlott(e),u.salePointDDL()]).then(function(n){var t={params:e,listPayVietlott:n[0],listSalePoint:n[1]};o.resolve(t)}),o.promise}]},title:"Tiền nạp Vietlott"};routes.activity.historyBill={url:"/historyBill?date&shiftId&salePointId&regionId",params:{date:{value:"",squash:!0},salePointId:{value:"1",squash:!0},shiftId:{value:"1",squash:!0},regionId:{value:"2",squash:!0}},templateUrl:n+"historyBill.html"+versionTemplate,controller:"Activity.historyBill as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","salepointService","shiftStatus2",function(n,t,i,r,u,f,e){var s=n.defer(),o=angular.copy(t);return o.date=o.date!=""?o.date:moment().format("YYYY-MM-DD"),n.all([r.getListHistoryForManager({date:o.date,salePointId:o.salePointId,shiftid:o.shiftId}),u.salePointDDL(),u.lotteryChannelDDL({regionId:o.regionId}),]).then(function(n){var t={params:o,listData:n[0],listSalePoint:n[1],listShift:e,listlotteryChannel:n[2]};s.resolve(t)}),s.promise}]},title:"Lịch Sử Bill"};routes.activity.otherCosts={url:"/otherCosts",params:{},templateUrl:n+"otherCosts.html"+versionTemplate,controller:"Activity.otherCosts as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u,f){var e=n.defer(),o=angular.copy(t);return n.all([u.getTypeNameDDL({transactionTypeId:1}),f.getListSalePoint()]).then(function(n){var t={params:o,listTypeOfFee:n[0],listSalePoint:n[1]};e.resolve(t)}),e.promise}]},title:"Chi phí khác"};routes.activity.otherCostsHistory={url:"/otherCostsHistory?day&salePointId",params:{day:{value:"",squash:!0},salePointId:{value:"",squash:!0}},templateUrl:n+"otherCostsHistory.html"+versionTemplate,controller:"Activity.otherCosts as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(t);return e.day=e.day!=""?e.day:moment().format("YYYY-MM-DD"),e.salePointId=e.salePointId?e.salePointId:0,n.all([u.getTypeNameDDL({transactionTypeId:1}),f.getListOtherFees({date:e.day,salePointId:e.salePointId}),f.getListSalePoint()]).then(function(n){var t={params:e,listTypeOfFee:n[0],listFee:n[1],listSalePoint:n[2]};o.resolve(t)}),o.promise}]},title:"Lịch sử chi phí khác"};routes.activity.scratchCardLog={url:"/scratchCardLog?day&ps&p",params:{day:{value:"",squash:!0},ps:{value:"100",squash:!0},p:{value:"1",squash:!0}},templateUrl:n+"scratchCardLog.html"+versionTemplate,controller:"Activity.scratchCardLog as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i){var u=n.defer(),r=angular.copy(t);return r.day=r.day==""?moment().format("YYYY-MM-DD"):r.day,n.all([i.getHistoryScratchCardLog({ps:r.ps,p:r.p,date:r.day})]).then(function(n){var t={params:r,listScratchCardLog:n[0]};u.resolve(t)}),u.promise}]},title:"Lịch sử chia thẻ cào"};routes.activity.scratchCardFullLog={url:"/scratchCardFullLog?day&ps&p",params:{day:{value:"",squash:!0},ps:{value:"100",squash:!0},p:{value:"1",squash:!0}},templateUrl:n+"scratchCardFullLog.html"+versionTemplate,controller:"Activity.scratchCardFullLog as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i){var u=n.defer(),r=angular.copy(t);return r.day=r.day==""?moment().format("YYYY-MM-DD"):r.day,n.all([i.getHistoryScratchCardFullLog({ps:r.ps,p:r.p,date:r.day})]).then(function(n){var t={params:r,listScratchCardFullLog:n[0]};u.resolve(t)}),u.promise}]},title:"Lịch sử nhập thẻ cào"};routes.activity.activityLog={url:"/activityLog?ShiftDistributeId&SalePointId&day",params:{day:{value:"",squash:!0},p:{value:"1",squash:!0},ps:{value:"20",squash:!0},ShiftDistributeId:{value:"",squash:!0},SalePointId:{value:"",squash:!0}},templateUrl:n+"activityLog.html"+versionTemplate,controller:"Activity.activityLog as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","reportService","salepointService","ddlService",function(n,t,i,r,u,f,e,o){var h=n.defer(),s=angular.copy(i);return s.day=s.day==""?moment().format("YYYY-MM-DD"):s.day,s.p=!parseInt(s.p)||parseInt(s.p)<1?1:s.p,s.ps=!parseInt(s.ps)||parseInt(s.ps)<1?20:s.ps,n.all([u.getSalePointLog({UserRoleId:t.sessionInfo.UserRoleId,ShiftDistributeId:s.ShiftDistributeId,SalePointId:s.SalePointId,Date:moment(s.day).format("YYYY-MM-DD")}),u.getRepaymentLog({UserRoleId:t.sessionInfo.UserRoleId,ShiftDistributeId:s.ShiftDistributeId,SalePointId:s.SalePointId,Date:moment(s.day).format("YYYY-MM-DD")}),u.getWinningList({shiftDistributeId:s.ShiftDistributeId,salePointId:s.SalePointId,date:moment(s.day).format("YYYY-MM-DD")}),u.getSoldLogDetail({UserRoleId:t.sessionInfo.UserRoleId,ShiftDistributeId:s.ShiftDistributeId}),u.getTransLogDetail({ShiftDistributeId:s.ShiftDistributeId}),o.lotteryChannelDDL({regionId:2}),e.getListHistoryOrder({shiftDistributeId:s.ShiftDistributeId,p:s.p,ps:s.ps}),u.getDataSell({shiftDistributeId:s.ShiftDistributeId,userRoleId:t.sessionInfo.UserRoleId,date:moment().format("YYYY-MM-DD")}),e.getListPaymentForConfirm({salePointId:s.SalePointId,date:moment(s.day).format("YYYY-MM-DD")})]).then(function(n){console.log("res",n);let t=n[0].filter(n=>n.TransitionTypeId==0),i=n[0].filter(n=>n.TransitionTypeId!=0);var r={params:s,listSalePointLog:t,listTransferLog:i,listPayingDebtLog:n[1],listWinning:n[2],listSold:n[6],listTrans:n[4],listLottery:n[5],listSellData:n[7],listPayment:n[8]};h.resolve(r)}),h.promise}]},title:"Nhật kí hoạt động"};routes.activity.distributeForSubAgency={url:"/distributeForSubAgency?day",params:{day:{value:"",squash:!0}},templateUrl:n+"manage_v2.html"+versionTemplate,controller:"Activity.distributeForSubAgency as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(t);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,n.all([u.agencyDDL(),u.lotteryChannelDDL({regionId:2,lotteryDate:f.day}),r.getDataReceivedFromAgency({lotteryDate:f.day}),r.getDataSupAgency({Date:f.day}),u.subAgencyDDL()]).then(function(n){var t={params:f,listAgency:n[0],listLottery:n[1],listTotalAgency:n[2],listTotalSupAgency:n[3],listSupAgency:n[4]};e.resolve(t)}),e.promise}]},title:"Chia vé cho đại lý con"};routes.activity.sendAndReceive={url:"/sendAndReceive?month",params:{month:{value:"",squash:!0}},templateUrl:n+"sendAndReceive.html"+versionTemplate,controller:"Activity.sendAndReceive as $vm",resolve:{viewModel:["$q","$stateParams","userService","reportService","ddlService","salepointService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(t);return f.month=f.month==""?moment().format("YYYY-MM"):f.month,n.all([u.salePointDDL(),r.getTransitonTypeOffset({month:f.month})]).then(function(n){var t={params:f,listSalePoint:n[0],listTransitionTypeOffset:n[1]};e.resolve(t)}),e.promise}]},title:"Thống kê chuyển nhận vé"};routes.activity.subAgencyPrice={url:"/subAgencyPrice",params:{day:{value:"",squash:!0}},templateUrl:n+"subAgencyPrice.html"+versionTemplate,controller:"Activity.subAgencyPrice as $vm",resolve:{viewModel:["$q","$stateParams","activityService","ddlService",function(n,t,i,r){var f=n.defer(),u=angular.copy(t);return u.day=u.day==""?moment().format("YYYY-MM-DD"):u.day,n.all([i.getListLotteryPriceSubAgency(),i.getListSubAgency(),r.lotteryChannelDDL({regionId:2}),]).then(function(n){var t={params:u,listData:n[0],listSubAgency:n[1],listLottery:n[2]};f.resolve(t)}),f.promise}]},title:"Giá vé từ đại lý con"};routes.activity.manageScratchcardForSubAgency={url:"/manageScratchcardForSubAgency?day",params:{day:{value:"",squash:!0}},templateUrl:n+"manageScratchcardForSubAgency.html"+versionTemplate,controller:"Activity.manageScratchcardForSubAgency as $vm",resolve:{viewModel:["$q","$stateParams","userService","activityService","ddlService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(t);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,n.all([r.getDataDistributeScratchForSubAgency(),r.getScratchcardFull(),u.lotteryChannelDDL({regionId:2}),r.getListSubAgency(),]).then(function(n){var t={params:f,listData:n[0],totalScratchcard:n[1],listLotteryDDL:n[2],listSubAgency:n[3]};e.resolve(t)}),e.promise}]},title:"Chia vé cào cho đại lý con"};routes.activity.manageStaffDebt={url:"/manageStaffDebt?salePointId&userTitleId",params:{userTitleId:{value:"",squash:!0}},templateUrl:n+"manageStaffDebt.html"+versionTemplate,controller:"Activity.manageStaffDebt as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u){var e=n.defer(),f=angular.copy(i);return f.userTitleId=f.userTitleId?f.userTitleId:5,n.all([u.getDebtOfStaff({UserTitleId:f.userTitleId})]).then(function(n){var t={params:f,listData:n[0]};e.resolve(t)}),e.promise}]},title:"Quản lý nợ nhân viên"};routes.activity.staticFee={url:"/staticFee?month",params:{month:{value:"",squash:!0},date:{value:"",squash:!0}},templateUrl:n+"staticFee.html"+versionTemplate,controller:"Activity.staticFee as $vm",resolve:{viewModel:["$q","$stateParams","userService","reportService","ddlService","salepointService","activityService",function(n,t,i,r,u,f,e){var s=n.defer(),o=angular.copy(t);return o.month=o.month==""?moment().format("YYYY-MM"):o.month,o.date=o.date==""?moment().format("YYYY-MM-DD"):o.date,n.all([u.salePointDDL(),r.getListUnsoldLotteryTicket({month:o.month}),e.getStaticFee({month:o.date})]).then(function(n){var t={params:o,listSalePoint:n[0],listUnsoldLotteryTicket:n[1],listStaticFee:n[2]};s.resolve(t)}),s.promise}]},title:"Chi phí cố định"}})(),function(){app.controller("Activity.activityLog",["$scope","$uibModal","$rootScope","$state","authService","notificationService","viewModel","reportService","salepointService","activityService",function(n,t,i,r,u,f,e,o,s,h){var c=angular.extend(this,e),l;c.isSaving=!1;c.userInfo={UserId:i.sessionInfo.UserId};c.totalRow=c.listSold&&c.listSold.length>0?c.listSold[0].TotalCount:0;c.totalConfirming1=0;c.init=function(){c.listTrans.forEach(function(n){n.totalConfirming1=0;n.detail=n.DetailData?JSON.parse(n.DetailData):[];n.ConfirmStatusId==1&&c.totalConfirming1++});c.listSold.forEach(function(n){n.detail=n.Data?JSON.parse(n.Data):[]});c.listSold=c.listSold.filter(n=>n.detail.SalePointLogData&&n.detail.SalePointLogData.length>0);console.log("vm.listSold",c.listSold);c.listSold.forEach(function(n,t){n.TotalQuantity=0;n.RowNumber=t+1;n.TotalPrice=0;n.detail.SalePointLogData.forEach(function(t){t.ShortName="";c.listLottery.forEach(function(n){t.LotteryChannelId==n.Id&&(t.ShortName=n.ShortName)});n.TotalQuantity+=t.Quantity;n.TotalPrice+=t.TotalValue})});c.listTrans.forEach(function(n){n.detail.forEach(function(n){n.ShortName="";c.listLottery.forEach(function(t){n.LotteryChannelId==t.Id&&(n.ShortName=t.ShortName)})})});c.listWinning.forEach(function(n){n.ShortName="";c.listLottery.forEach(function(t){n.LotteryChannelId==t.Id&&(n.ShortName=t.ShortName)})})};c.init();c.getBootBox=function(n){var t="",i;t=confirm?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> xóa vé?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn muốn <strong>huỷ yêu cầu<\/strong> chuyển/nhận vé?';i=bootbox.confirm({message:t,size:"small",buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){},500);t&&c.deleteData(n)}});i.init(function(){setTimeout(function(){$(".modal-body").css("height","")},0)})};c.getBootBoxWinnning=function(n){var t=bootbox.confirm({message:'<i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> xóa trả thưởng?',size:"small",buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){},500);t&&c.deleteWinning(n)}});t.init(function(){setTimeout(function(){$(".modal-body").css("height","")},0)})};c.deleteData=function(n){c.deleteRow={ActionBy:i.sessionInfo.UserId,ActionByName:i.sessionInfo.FullName,Data:JSON.stringify({ActionType:3,HistoryOfOrderId:n.HistoryOfOrderId})};s.updateHistoryOrder(c.deleteRow).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);r.reload();c.isSaving=!1},200):c.isSaving=!0})};c.deleteWinning=function(n){var t={ActionBy:i.sessionInfo.UserId,ActionByName:i.sessionInfo.FullName,WinningId:n.WinningId};h.deleteLogWinning(t).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);r.reload();c.isSaving=!1},200):c.isSaving=!0})};l=[{dayId:0,name:"Kon Tum"},{dayId:1,name:"Thừa Thiên Huế"},{dayId:2,name:"Đăk Lăk"},{dayId:3,name:"Đà Nẵng"},{dayId:4,name:"Quảng Trị"},{dayId:5,name:"Ninh Thuận"},{dayId:6,name:"Quảng Ngãi"},];c.printBill=function(n){var r="",u=JSON.parse(n.Data),e,f,t,a;console.log("promotion code before",u.SalePointLogData[0].PromotionCode);e=u.SalePointLogData[0].PromotionCode!=null?u.SalePointLogData[0].PromotionCode:[];f=[];e.forEach(n=>{switch(n.length){case 1:n="0000"+n;break;case 2:n="000"+n;break;case 3:n="00"+n;break;case 4:n="0"+n}f.push(n);console.log("check code",n)});var v=f.length>0?f.join(" | \n"):"",o=u.SalePointLogData.filter(n=>n.LotteryDate!=null&&n.LotteryDate!=undefined),s=o.map(function(n){return n.LotteryDate}),h=moment.max(s.map(function(n){return moment(n,"YYYY-MM-DD")})),y=moment.min(s.map(function(n){return moment(n,"YYYY-MM-DD")}));o.find(n=>moment(n.LotteryDate,"YYYY-MM-DD").day()!=moment().day())?(console.log("case 1"),moment().day()==6?(console.log("case 1.1"),r=l.find(n=>n.dayId==0).name+" "+moment(h).format("DD/MM/YYYY")):(console.log("case 1.2"),r=l.find(n=>n.dayId==moment().day()+1).name+" "+moment(h).format("DD/MM/YYYY"))):r=l.find(n=>n.dayId==moment().day()).name+" "+moment(y).format("DD/MM/YYYY");t={FullAddress:c.listSellData.SalePointAddress!=null?c.listSellData.SalePointAddress:"",SalePoint:c.listSellData.SalePointName,DatePrint:moment(n.CreatedDate).format("DD/MM/YYYY"),ShiftName:c.params.shiftId==1?"Ca Sáng":"Ca Chiều",DateTime:moment().format("HH:mm:ss"),BillNumber:i.createBillNumber(n.HistoryOfOrderId),ActionName:i.sessionInfo.FullName,CustomerName:n.detail.GuestData?n.detail.GuestData.FullName:"Khách lẻ",ListInfo:[],TotalQuatity:n.TotalQuantity,Sum:n.TotalPrice,CustomerGive:0,TotalDebt:0,OldDebt:n.LastData?n.LastData.OldDebt:0,NewDebt:n.LastData?n.LastData.NewDebt:0,PromotionCode:v,ChannelName:r};n.detail.SalePointLogData.forEach(function(n){t.ListInfo.push({LotteryName:n.ShortName,Quantity:n.Quantity,FourLastNumber:n.FourLastNumber?" --> "+n.FourLastNumber:"",Price:n.TotalValue})});n.detail.GuestActionData&&n.detail.GuestActionData.length>0?n.detail.GuestActionData.forEach(n=>t.CustomerGive+=n.TotalPrice):t.CustomerGive=t.Sum;a=n.detail.GuestData?2:1;console.log("print bill");i.printBill(t,a)};c.changeTab=function(n){c.view=n;c.showSaveChange=n=="paying-debt-content"?!0:!1};c.changeTab("activity-log-content");c.openDetail=function(n){var r=baseAppPath+"/activity/views/modal/",i=t.open({templateUrl:r+"paymentDetail.html"+versionTemplate,controller:"Activity.paymentDetail as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(t){var i=t.defer();return t.all([]).then(function(){var t={paymentData:n};i.resolve(t)}),i.promise}]}});i.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});i.result.then(function(){},function(n){typeof n=="object"})}}])}(),function(){app.controller("Activity.agencyPrice",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r);s.listLotteryOnWeek=angular.copy(o);s.listLotteryOnWeek.sort((n,t)=>n.Id2-t.Id2);s.isSaving=!1;s.init=function(){s.listLottery.forEach(function(n){n.DayId=JSON.parse(n.DayIds)});s.listScratchcard=s.listLottery.filter(n=>n.IsScratchcard==!0);var n=!0;s.listLotteryOnWeek.push({isColor:n,LotteryData:s.listScratchcard,SName:"Vé cào",IsScratchcard:!0});s.listLotteryOnWeek.forEach(function(t){t.isColor=n;t.IsScratchcard||(t.LotteryData=s.listLottery.filter(n=>n.DayId.includes(t.Id2)));t.LotteryData.forEach(function(n){n.listAgency=angular.copy(s.listAgency);n.listAgency.forEach(function(t){let i=s.listData.filter(i=>i.AgencyId==t.Id&&i.LotteryChannelId==n.Id);t.PriceDisplay=i&&i[0]?i[0].Price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):0;t.isChange=!1})});n=!n})};s.init();s.getListSave=function(){var n=[];return s.listLotteryOnWeek.forEach(function(t){t.LotteryData.forEach(function(t){t.listAgency.forEach(function(i){i.isChange==!0&&(i.Price=i.PriceDisplay.replace(/,/g,""),n.push({AgencyId:i.Id,LotteryChannelId:t.Id,Price:i.Price}))})})}),n};s.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")",ActionType:1};s.save=function(){s.isSaving=!0;var n=s.getListSave();n.length==0?(e.warning("Không có gì để lưu"),s.isSaving=!1):(s.saveInfo.Data=JSON.stringify(n),f.updateLotteryPriceAgency(s.saveInfo).then(function(n){n&&n.Id>0?(e.success(n.Message),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving);i.reload()},1500)):(e.warning(n.Message),s.isSaving=!1)}))}}])}(),function(){app.controller("Activity.checkTransfer",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN","$uibModal","transitionType",function(n,t,i,r,u,f,e,o,s,h){var c=angular.extend(this,r),l=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"],a="YYYY-MM-DD";t.connection.on("ReceiveMessage",function(n,r){n=="checkTransferReload"&&parseInt(r)==t.sessionInfo.UserId&&i.reload()});c.listsalePoint.unshift({Id:0,Name:"Tất cả "});c.listTransitionType=h;c.totalRow=c.listConfirm&&c.listConfirm.length>0?c.listConfirm[0].TotalCount:0;c.getLotteryName=function(n){return c.listLottery.filter(t=>t.Id==n)[0].ShortName};c.listConfirm.length>0&&c.listConfirm.forEach(function(n){n.Data=JSON.parse(n.TransData)});c.changeDate=function(){c.params.day=moment(c.params.day,l).format(a);i.go(i.current,c.params,{reload:!0,notify:!0})};n.getTotalForColumn=function(n){let t=0;return n.forEach(n=>{t+=n.TotalTrans}),t};c.openDetail=function(n={}){if(1){var i=baseAppPath+"/activity/views/modal/",t=s.open({templateUrl:i+"checkTransferDetail.html"+versionTemplate,controller:"Activity.checkTransferDetail as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(t){var i=t.defer();return t.all([]).then(function(){var t={data:n,listLottery:c.listLottery};i.resolve(t)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});t.result.then(function(){},function(n){typeof n=="object"})}}}])}(),function(){app.controller("Activity.create",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e){var o=angular.extend(this,r),s=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"],h="YYYY-MM-DD";o.isSaving=!1;o.params.day=moment(o.params.day,s).format("DD-MM-YYYY");o.dayDisplay=e[moment(moment(o.params.day,s)).day()].Name+", "+o.params.day;o.dayOfWeekVN=angular.copy(e);o.isCanChangeData=currentEvi!="pro"?!0:t.sessionInfo.UserTitleId==3;o.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};o.sumListAgency=function(){o.listAgency.forEach(function(n){n.Total=0;o.listLottery.forEach(function(t){t.InfoDiemBan.forEach(function(t){n.Id===t.AgencyId&&t.TotalReceived&&(n.Total+=t.TotalReceived)})})})};o.sumListLottery=function(){o.listTotalLottery.forEach(function(n){n.Total=0;o.listLottery.forEach(function(t){t.InfoDiemBan.forEach(function(t){n.Id===t.LotteryChannelId&&t.TotalReceived&&(n.Total+=t.TotalReceived)})})});o.listLottery.forEach(function(n){n.Total=0;n.InfoDiemBan.forEach(function(n){n.TotalReceived||(n.TotalReceived=0)});o.listTotalLottery.forEach(function(t){n.Id==t.Id&&(n.Total=t.Total)})});o.listLottery.forEach(function(n){n.sum=0;o.listTotalLottery.forEach(function(t){n.sum+=t.Total})})};o.init=function(n){o.listLottery.forEach(function(t){t.InfoDiemBan=angular.copy(o.listAgency.filter(function(n){return n.IsActive===!0}));t.InfoDiemBan.forEach(function(i){i.LotteryChannelId=t.Id;i.AgencyId=i.Id;i.LotteryDate=moment(n,s).format(h);try{var r=o.listTotal.filter(n=>n.LotteryChannelId==t.Id&&n.AgencyId==i.Id)[0];i.TotalReceived=r.TotalReceived;i.checkNum=r.TotalReceived-r.TotalRemaining}catch(u){i.checkNum=0}})});o.listTotalLottery=angular.copy(o.listLottery);o.sumListAgency();o.sumListLottery()};o.init(o.params.day);o.changeDate=function(){i.go(i.current,{day:moment(o.params.day,s).format(h)},{reload:!0,notify:!0})};o.clickToday=function(n=0){o.params.day=moment().add(n,"days").format("YYYY-MM-DD");o.changeDate()};o.onChangeData=function(n,i,r,u,f){r=r?r:0;i=t.reg.test(i)?Math.floor(i):i?r:0;var e=o.listAgency.filter(n=>n.LotteryChannelId==i.LotteryChannelId&&n.AgencyId==i.AgencyId)[f];i?(n.isChange=!0,n.checkNum>=i?(n.TotalReceived=parseInt(n.checkNum),o.sumListAgency(),o.sumListLottery()):e.Total+(i-r)>=0&&(n.TotalReceived=parseInt(i),o.sumListAgency(),o.sumListLottery())):(n.isChange=!0,o.sumListAgency(),o.sumListLottery(),i=0);document.getElementById("quantity_"+u+"_"+f).value=n.TotalReceived};o.onClick=function(n,t){document.getElementById("quantity_"+n+"_"+t).focus()};o.getSavingData=function(){var n=[];return o.listLottery.forEach(function(t){t.InfoDiemBan.forEach(function(t){t.isChange==!0&&n.push(t)})}),n};o.save=function(){o.isSaving=!0;o.saveInfo.LotteryDate=moment(o.params.day,s).format(h);o.saveInfo.ReceiveData=JSON.stringify(o.getSavingData());u.receiveLotteryFromAgency(o.saveInfo).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();o.isSaving=!1},1e3):o.isSaving=!1})}}])}(),function(){app.controller("Activity.createScratchcard",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e){var o=angular.extend(this,r),s=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"],h="YYYY-MM-DD";o.isSaving=!1;o.params.day=moment(o.params.day,s).format("DD-MM-YYYY");o.dayDisplay=e[moment(moment(o.params.day,s)).day()].Name+", "+o.params.day;o.dayOfWeekVN=angular.copy(e);o.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};o.isShowSave=function(){return moment().format("YYYY-MM-DD")==moment(o.params.day,s).format("YYYY-MM-DD")};o.changeDate=function(){i.go(i.current,{day:moment(o.params.day,s).format(h)},{reload:!0,notify:!0})};o.clickToday=function(n=0){o.params.day=moment().add(n,"days").format("YYYY-MM-DD");o.changeDate()};o.onClick=function(n,t){document.getElementById("quantity_"+n+"_"+t).focus()};o.init=function(){o.listScratchcard=o.listLotteryDDL.filter(n=>n.IsScratchcard==!0);o.listAgency.forEach(function(n){n.listScratchcard=angular.copy(o.listScratchcard);n.listScratchcard.forEach(function(t){t.InputData=0;var i=o.listData.filter(function(i){return i.AgencyId==n.Id&&i.LotteryChannelId==t.Id});t.RemainingData=i&&i.length>0?i[0].TotalReceived:0})})};o.init();o.onChangeData=function(n,t,i,r,u){t=parseInt(t);t&&t!=i?(n.isChange=!0,n.InputData=0>=t?0:parseInt(t)):t||(n.InputData=0);document.getElementById("quantity_"+r+"_"+u).value=n.InputData};o.getSavingData=function(){var n=[];return o.listAgency.forEach(function(t){t.listScratchcard.forEach(function(i){i.InputData>0&&n.push({AgencyId:t.Id,TotalReceived:i.InputData,LotteryChannelId:i.Id})})}),n};o.save=function(){o.isSaving=!0;var n=o.getSavingData();n&&n.length!=0?(o.saveInfo.ReceiveData=JSON.stringify(n),u.receiveScratchcardFromAgency(o.saveInfo).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();o.isSaving=!1},1e3):o.isSaving=!1})):(f.warning("Không có dữ liệu để lưu"),setTimeout(function(){o.isSaving=!1;t.$apply(o.isSaving)},1e3))}}])}(),function(){app.controller("Activity.distributeForSubAgency",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r),h,c;n.$on("$locationChangeStart",function(n){var t=confirm("Dữ liệu có thể mất nếu bạn chưa lưu lại!!!");t||n.preventDefault()});s.isSaving=!1;h=["DD-MM-YYYY","YYYY-MM-DD"];c="YYYY-MM-DD";s.params.day=moment(s.params.day,h).format("DD-MM-YYYY");s.dayDisplay=o[moment(moment(s.params.day,h)).day()].Name+", "+s.params.day;s.dayOfWeekVN=angular.copy(o);s.isCanChangeData=currentEvi!="pro"?!0:t.sessionInfo.UserTitleId==3;s.getSum=function(){s.Total=0;s.listLotteryBk.forEach(function(n){var i=s.listInitDaiBan1.filter(t=>t.Id==n.Id),t=0;i.forEach(function(n){t+=n.TotalRemaining});n.TotalRemaining=t;s.Total+=t})};s.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};s.changeDate=function(){i.go(i.current,{day:moment(s.params.day,h).format(c)},{reload:!0,notify:!0})};s.clickToday=function(n=0){console.log("days",n);s.params.day=moment().add(n,"days").format("YYYY-MM-DD");s.changeDate()};s.init=function(){s.listInit1=[];s.listInitDaiBan1=[];s.listLottery.forEach(function(n){n.TotalRemaining=0});s.Total=0;s.listLotteryBk=angular.copy(s.listLottery);s.listAgency.forEach(function(n){n.InfoDaiBan=angular.copy(s.listLottery);n.InfoDaiBan.forEach(function(t,i){t.AgencyId=n.Id;t.LotteryChannelId=t.Id;try{t.TotalRemaining=s.listTotalAgency.filter(n=>n.AgencyId==t.AgencyId&&n.LotteryChannelId==t.LotteryChannelId)[0].TotalRemaining}catch(r){t.TotalRemaining=0}s.listLotteryBk[i].TotalRemaining+=t.TotalRemaining;s.Total+=t.TotalRemaining});s.listInitDaiBan1=s.listInitDaiBan1.concat(angular.copy(n.InfoDaiBan))});s.listSupAgency.forEach(function(n){n.InfoDaiLy=angular.copy(s.listAgency);n.SubAgencyId=n.SubAgencyId;n.InfoDaiLy.SubAgencyId=n.SubAgencyId;var t={SubAgencyId:n.SubAgencyId,SalePointName:n.SubAgencyName,isClose:!1},i=[],r=0,u=0,f=!1;n.InfoDaiLy.forEach(function(t){t.InfoDaiBan.forEach(function(t){try{var i=s.listTotalSupAgency.filter(i=>i.AgencyId==t.AgencyId&&i.SubAgencyId==n.SubAgencyId&&i.LotteryChannelId==t.LotteryChannelId);console.log("temp3",i);t.SubAgencyId=n.SubAgencyId;t.TotalRemaining=i[0].TotalReceived;r+=i[0].TotalReceived}catch(e){t.TotalRemaining=0}try{t.TotalDupRemaining=i[0].TotalDupReceived;u+=i[0].TotalDupReceived;t.TotalDupRemaining>0&&(f=!0)}catch(e){t.TotalDupRemaining=0}});i=i.concat(t.InfoDaiBan)});t.Info=angular.copy(i);t.TotalRemaining=r;t.TotalDupRemaining=u;t.MainTotal=r+u;t.isCheckDupVal=f;s.listInit1.push(t)});s.listInit1.forEach(function(n){var t=[];s.listLottery.forEach(function(i){var r={Id:i.Id,Name:i.Name,ShortName:i.ShortName,total:0};n.Info.forEach(function(n){n.Id==i.Id&&(r.total+=n.TotalDupRemaining,r.total+=n.TotalRemaining)});t.push(r)});n.detail=t});s.listInit1Bk=angular.copy(s.listInit1)};s.init();s.ChangeValueNumber1=function(n,i,r,u,f){n.TotalRemaining=t.reg.test(n.TotalRemaining)?Math.floor(n.TotalRemaining):n.TotalRemaining?i.TotalRemaining:0;n&&n!=i&&(n.isChange=!0);var e=s.listInitDaiBan1.filter(t=>t.LotteryChannelId==n.LotteryChannelId&&t.AgencyId==n.AgencyId)[0];n.TotalRemaining==undefined?(e.TotalRemaining=e.TotalRemaining+i.TotalRemaining,r.TotalRemaining=r.TotalRemaining-i.TotalRemaining,n.TotalRemaining=0,r.detail[f%r.detail.length].total=0,r.Info.forEach(function(n){n.Id==r.detail[f%r.detail.length].Id&&(r.detail[f%r.detail.length].total+=n.TotalRemaining,r.detail[f%r.detail.length].total+=n.TotalDupRemaining)})):e.TotalRemaining-(n.TotalRemaining-i.TotalRemaining)>=0?(e.TotalRemaining=e.TotalRemaining-(n.TotalRemaining-i.TotalRemaining),r.TotalRemaining=r.TotalRemaining+(n.TotalRemaining-i.TotalRemaining),r.detail[f%r.detail.length].total=0,r.Info.forEach(function(n){n.Id==r.detail[f%r.detail.length].Id&&(r.detail[f%r.detail.length].total+=n.TotalRemaining,r.detail[f%r.detail.length].total+=n.TotalDupRemaining)})):n.TotalRemaining=i.TotalRemaining;s.getSum();document.getElementById("quantity_"+u+"_"+f).value=n.TotalRemaining};s.ChangeValueNumber2=function(n,i,r,u,f){r.isCheckDupVal=!0;n.TotalDupRemaining=t.reg.test(n.TotalDupRemaining)?Math.floor(n.TotalDupRemaining):n.TotalDupRemaining?i.TotalDupRemaining:0;n&&n!=i&&(n.isChange=!0);var e=s.listInitDaiBan1.filter(t=>t.LotteryChannelId==n.LotteryChannelId&&t.AgencyId==n.AgencyId)[0];n.TotalDupRemaining==undefined?(e.TotalRemaining=e.TotalRemaining+i.TotalDupRemaining,r.TotalDupRemaining=r.TotalDupRemaining-i.TotalDupRemaining,n.TotalDupRemaining=0,r.detail[f%r.detail.length].total=0,r.Info.forEach(function(n){n.Id==r.detail[f%r.detail.length].Id&&(r.detail[f%r.detail.length].total+=n.TotalRemaining,r.detail[f%r.detail.length].total+=n.TotalDupRemaining)})):e.TotalRemaining-(n.TotalDupRemaining-i.TotalDupRemaining)>=0?(e.TotalRemaining=e.TotalRemaining-(n.TotalDupRemaining-i.TotalDupRemaining),r.TotalDupRemaining=r.TotalDupRemaining+(n.TotalDupRemaining-i.TotalDupRemaining),r.detail[f%r.detail.length].total=0,r.Info.forEach(function(n){n.Id==r.detail[f%r.detail.length].Id&&(r.detail[f%r.detail.length].total+=n.TotalRemaining,r.detail[f%r.detail.length].total+=n.TotalDupRemaining)})):n.TotalDupRemaining=i.TotalDupRemaining;s.getSum();document.getElementById("quantity_dup_"+u+"_"+f).value=n.TotalDupRemaining};s.onClick=function(n,t){document.getElementById("quantity_"+n+"_"+t).focus()};s.onClickDup=function(n,t){document.getElementById("quantity_dup_"+n+"_"+t).focus()};s.getSavingData=function(){var n=[];return s.listSendData=[],s.listInit1.forEach(function(t,i){t.Info.forEach(function(t,r){if(t.isChange==!0){var f={LotteryChannelId:t.LotteryChannelId,AgencyId:t.AgencyId,TotalReceived:t.TotalRemaining,TotalDupReceived:t.TotalDupRemaining,SupAgencyId:t.SubAgencyId,LotteryDate:moment(s.params.day,h).format(c)},u=s.listInit1Bk[i].Info[r],e={AgencyId:u.AgencyId,SupAgencyId:u.SubAgencyId,LotteryChannelId:u.LotteryChannelId,TotalTrans:t.TotalRemaining-u.TotalRemaining,TotalTransDup:t.TotalDupRemaining-u.TotalDupRemaining,LotteryDate:moment(s.params.day,h).format(c)};s.listSendData.push(e);n.push(f)}})}),n};s.sendDataTL=function(){t.connection.invoke("SendMessage","addLotteryManage",JSON.stringify(s.listSendData)).catch(function(n){return console.error(n.toString())})};s.save=function(){s.isSaving=!0;s.saveInfo.Date=moment(s.params.day,h).format(c);s.saveInfo.Data=JSON.stringify(s.getSavingData());s.saveInfo.Lock=!1;f.distributeForSupAgency(s.saveInfo).then(function(n){n&&n.Id>0?(setTimeout(function(){e.success(n.Message);i.reload();s.isSaving=!1},1e3),s.sendDataTL()):s.isSaving=!1})}}])}(),function(){app.controller("Activity.groupLotteryManage",["$scope","$rootScope","$state","viewModel","sortIcon",function(n,t,i,r){var u=angular.extend(this,r);u.listActivityMenu=[{Name:"Nhập vé từ đại lý",href:"/activity/create",root:"root.activity.create"},{Name:"Chia vé cho điểm bán",href:"/activity/manage",root:"root.activity.manage"},{Name:"Chia vé cho đại lý con",href:"/activity/distributeForSubAgency",root:"root.activity.distributeForSubAgency"},{Name:"Nhận vé cào",href:"/activity/createScratchcard",root:"root.activity.createScratchcard"},{Name:"Chia vé cào",href:"/activity/manageScratchcard",root:"root.activity.manageScratchcard"},{Name:"Chia vé cào cho đại lý con",href:"/activity/manageScratchcardForSubAgency",root:"root.activity.manageScratchcardForSubAgency"},{Name:"Giá vé đại lý",href:"/activity/agencyPrice",root:"root.activity.agencyPrice"},{Name:"Giá vé đại lý con",href:"/activity/subAgencyPrice",root:"root.activity.subAgencyPrice"},{Name:"Trả ế",href:"/activity/returnAgency",root:"root.activity.returnAgency"},];u.listTransferMenu=[{Name:"Chuyển nhận vé",href:"/activity/inventoryManage",root:"root.activity.inventoryManage"},{Name:"Yêu cầu chuyển nhận vé",href:"/activity/checkTransfer",root:"root.activity.checkTransfer"},{Name:"Thống kê chuyển nhận vé",href:"/activity/sendAndReceive",root:"root.activity.sendAndReceive"},];u.isShowList=function(n){var i=!1;return n.forEach(function(n){t.checkPermission(n.root)&&(i=!0)}),i}}])}(),function(){app.controller("Activity.groupMoneyManage",["$scope","$rootScope","$state","viewModel","sortIcon",function(n,t,i,r){var u=angular.extend(this,r);u.listVietlottMenu=[{Name:"Tiền nạp Vietlott",href:"/activity/moneyVietlott",root:"root.activity.moneyVietlott"},{Name:"Đối chiếu Vietlott",href:"/report/compare",root:"root.report.compare"},];u.listOwnDebtMenu=[{Name:"Quản lý nợ riêng",href:"/activity/ownDebtManage",root:"root.activity.ownDebtManage"},{Name:"Yêu cầu nợ riêng",href:"/activity/requestOwnDebt",root:"root.activity.requestOwnDebt"},];u.listTransfer_DebtMenu=[{Name:"Quản lý chuyển khoản",href:"/activity/managePayment",root:"root.activity.managePayment"},{Name:"Quản lý nợ",href:"/activity/manageConfirm",root:"root.activity.manageConfirm"},{Name:"Quản lý nợ nhân viên",href:"/activity/manageStaffDebt",root:"root.activity.manageStaffDebt"},];u.isShowList=function(n){var i=!1;return n.forEach(function(n){t.checkPermission(n.root)&&(i=!0)}),console.log(i),i}}])}(),function(){app.controller("Activity.historyBill",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN",function(n,t,i,r){var u=angular.extend(this,r),f=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"];u.DateDisplay=moment(u.params.date,f).format("DD-MM-YYYY");console.log(u.listlotteryChannel);u.listData.forEach((n,t)=>{n.Data=JSON.parse(n.Data);n.RowNumber=t+1;var i=n.Data.SalePointLogData,r=0,f=0;i&&i.forEach(n=>{r+=n.Quantity;f+=n.TotalValue;var t=u.listlotteryChannel.filter(t=>t.Id==n.LotteryChannelId);n.ShortName=t&&t.length>0&&t[0].ShortName||""});n.Quantity=r;n.TotalPrice=f});u.changeDate=function(){u.params.date=moment(u.DateDisplay,f).format("YYYY-MM-DD");console.log(u.params);i.go(i.current,u.params,{reload:!0,notify:!0})};u.Check=function(){if(u.listData&&u.listData.length!=0){var n=u.listData.filter(n=>n.Data.SalePointLogData);return n&&n.length>0?!1:!0}return!0}}])}(),function(){app.controller("Activity.InventoryManage",["$scope","$rootScope","$state","viewModel","sortIcon","$uibModal","dayOfWeek","userService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o,s,h){var c=angular.extend(this,r),v=u,l=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"],a="YYYY-MM-DD";c.params.day=moment(c.params.day,l).format("DD-MM-YYYY");c.dayDisplay=h[moment(moment(c.params.day,l)).day()].Name+", "+c.params.day;c.changeDate=function(){i.go(i.current,{day:moment(c.params.day,l).format(a)},{reload:!0,notify:!0})};c.init=function(){var n;c.TotalDataChart=[];var r=t.GrpBy(c.listInventory,"LotteryChannelName"),i=Object.keys(r),u=Object.values(r);for(c.dataDaiBan=[],c.listInventory=Enumerable.From(c.listInventory).GroupBy(function(n){return n.SalePointId}).Select(function(n){var r=0,u=0,i=n.source,t=JSON.parse(n.source[0].TransitionLog);if(t&&t.length>0)try{t.forEach(function(n){var t=i.findIndex(t=>t.LotteryChannelId==n.LotteryChannelId);i[t].listLog||(i[t].listLog=[]);n.TransitionTypeId==1&&(u+=n.TotalTrans,u+=n.TotalTransDup);n.TransitionTypeId==2&&(r+=n.TotalTrans,r+=n.TotalTransDup);i[t].listLog.unshift(n)})}catch(f){console.log(f)}return t&&t.length>0&&c.TotalDataChart.unshift.apply(c.TotalDataChart,t),{SalePointId:n.source[0].SalePointId,SalePointName:n.source[0].SalePointName,Data:i,ListLogData:t,Transfer:u,Receive:r,isExpand:!1}}).ToArray(),c.saveIndex=-1,n=0;n<i.length;n++)i[n]!="null"&&c.dataDaiBan.push({name:i[n],receive:0,trans:0,total:0});c.listInventory.forEach(function(n){n.dataDaiBan=angular.copy(c.dataDaiBan)});c.listInventory.forEach(function(n){n.TotalSum=0;n.dataDaiBan.forEach(function(t){if(n.ListLogData&&n.ListLogData.length>0)try{n.ListLogData.forEach(function(n){n.LotteryChannelName==t.name&&(n.TransitionTypeId==1&&(t.trans+=n.TotalTrans,t.trans+=n.TotalTransDup),n.TransitionTypeId==2&&(t.receive+=n.TotalTrans,t.receive+=n.TotalTransDup))})}catch(i){console.log(i)}t.total=t.trans-t.receive;n.TotalSum+=t.trans-t.receive})});c.TotalSum=0;c.dataDaiBan.forEach(function(n){c.listInventory.forEach(function(t){t.dataDaiBan.forEach(function(t){n.name==t.name&&(n.total+=t.total,c.TotalSum+=t.total)})})});c.TotalDataChart&&c.TotalDataChart.length>0&&(c.TotalDataChart.sort(function(n,t){return moment(n.TransitionDate)<moment(t.TransitionDate)?-1:moment(n.TransitionDate)>moment(t.TransitionDate)?1:0}),c.ChartGrp=t.GrpBy(c.TotalDataChart,"LotteryChannelName"),c.tempChart=[],c.ChartGrp&&Object.keys(c.ChartGrp).forEach(function(n){var t={Title:n},r=[moment(c.ChartGrp[n][0].LotteryDate).add(7,"hours").format("YYYY-MM-DD 00:00:00")],i=[[""],[""]],u=[null],f=[null],e=0,o=0;c.ChartGrp[n].forEach(function(n){n.TransitionTypeId==1&&(e+=n.TotalTrans+n.TotalTransDup,i[0].push(n.TotalTrans),i[1].push(""),r.push(moment(n.TransitionDate).add(7,"hours").format("YYYY-MM-DD HH:mm:ss")),u.push(e),f.push(o));n.TransitionTypeId==2&&(o+=n.TotalTrans+n.TotalTransDup,i[1].push(n.ToSalePointName+": "+(n.TotalTrans+n.TotalTransDup)),i[0].push(""),r.push(moment(n.TransitionDate).add(7,"hours").format("YYYY-MM-DD HH:mm:ss")),u.push(e),f.push(o))});r.push(moment(c.ChartGrp[n][0].LotteryDate).add(7,"hours").format("YYYY-MM-DD 23:59:59"));t.listReceive=f;t.listTranfer=u;t.listCustom=i;t.listTime=r;c.tempChart.push(t)}))};c.openDetail=function(n,t){if(n.length>0){var r=baseAppPath+"/activity/views/modal/",i=f.open({params:{day:{value:"",squash:!0}},templateUrl:r+"transferDetail.html"+versionTemplate,controller:"Activity.transferDetail as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","ddlService",function(i,r,u){var e=i.defer(),f=angular.copy(r);return f.day=f.day==""?moment().format("YYYY-MM-DD"):f.day,i.all([u.lotteryChannelDDL({regionId:2,lotteryDate:f.day}),]).then(function(i){var r={listLottery:i[0],listData:n,salePoint:t};e.resolve(r)}),e.promise}]}});i.opened.then(function(){$(document).ready(function(){})});i.result.then(function(){},function(n){typeof n=="object"})}};c.showHide=function(n){c.listInventory[n].ListLogData.length>0&&(c.saveIndex==n?c.listInventory[n].isExpand=c.listInventory[n].isExpand==!1?!0:!1:(c.listInventory[c.saveIndex<0?0:c.saveIndex].isExpand=!1,c.listInventory[n].isExpand=!0,c.saveIndex=n))};c.init();c.clickToday=function(n=0){c.params.day=moment().add(n,"days").format("YYYY-MM-DD");c.changeDate()}}])}(),function(){app.controller("Activity.manage",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r),h,c;n.$on("$locationChangeStart",function(n){var t=confirm("Dữ liệu có thể mất nếu bạn chưa lưu lại!!!");t||n.preventDefault()});s.isSaving=!1;h=["DD-MM-YYYY","YYYY-MM-DD"];c="YYYY-MM-DD";s.params.day=moment(s.params.day,h).format("DD-MM-YYYY");s.dayDisplay=o[moment(moment(s.params.day,h)).day()].Name+", "+s.params.day;s.dayOfWeekVN=angular.copy(o);s.isCanChangeData=currentEvi!="pro"?!0:t.sessionInfo.UserTitleId==3;s.getSum=function(){s.Total=0;s.listLotteryBk.forEach(function(n){var i=s.listInitDaiBan1.filter(t=>t.Id==n.Id),t=0;i.forEach(function(n){t+=n.TotalRemaining});n.TotalRemaining=t;s.Total+=t})};s.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};s.changeDate=function(){i.go(i.current,{day:moment(s.params.day,h).format(c)},{reload:!0,notify:!0})};s.clickToday=function(n=0){s.params.day=moment().add(n,"days").format("YYYY-MM-DD");s.changeDate()};s.init=function(){s.listInit1=[];s.listInitDaiBan1=[];s.listLottery.forEach(function(n){n.TotalRemaining=0});s.Total=0;s.listLotteryBk=angular.copy(s.listLottery);s.listAgency.forEach(function(n){n.InfoDaiBan=angular.copy(s.listLottery);n.InfoDaiBan.forEach(function(t,i){t.AgencyId=n.Id;t.LotteryChannelId=t.Id;try{t.TotalRemaining=s.listTotalAgency.filter(n=>n.AgencyId==t.AgencyId&&n.LotteryChannelId==t.LotteryChannelId)[0].TotalRemaining}catch(r){t.TotalRemaining=0}s.listLotteryBk[i].TotalRemaining+=t.TotalRemaining;s.Total+=t.TotalRemaining});s.listInitDaiBan1=s.listInitDaiBan1.concat(angular.copy(n.InfoDaiBan))});s.listSalePoint.forEach(function(n){n.InfoDaiLy=angular.copy(s.listAgency);n.SalePointId=n.Id;n.InfoDaiLy.SalePointId=n.Id;var t={SalePointId:n.Id,SalePointName:n.Name,isClose:!1},i=[],r=0,u=0,f=!1;n.InfoDaiLy.forEach(function(t){t.InfoDaiBan.forEach(function(t){var i=s.listData.filter(i=>i.AgencyId==t.AgencyId&&i.SalePointId==n.SalePointId&&i.LotteryChannelId==t.LotteryChannelId);try{t.SalePointId=n.SalePointId;t.TotalRemaining=i[0].TotalReceived;r+=i[0].TotalReceived}catch(e){t.TotalRemaining=0}try{t.TotalDupRemaining=i[0].TotalDupReceived;u+=i[0].TotalDupReceived;t.TotalDupRemaining>0&&(f=!0)}catch(e){t.TotalDupRemaining=0}});i=i.concat(t.InfoDaiBan)});t.Info=angular.copy(i);t.TotalRemaining=r;t.TotalDupRemaining=u;t.MainTotal=r+u;t.isCheckDupVal=f;s.listInit1.push(t)});s.listInit1.forEach(function(n){var t=[];s.listLottery.forEach(function(i){var r={Id:i.Id,Name:i.Name,ShortName:i.ShortName,total:0};n.Info.forEach(function(n){n.Id==i.Id&&(r.total+=n.TotalDupRemaining,r.total+=n.TotalRemaining)});t.push(r)});n.detail=t});s.listInit1Bk=angular.copy(s.listInit1)};s.init();s.ChangeValueNumber1=function(n,i,r,u,f){n.TotalRemaining=t.reg.test(n.TotalRemaining)?Math.floor(n.TotalRemaining):n.TotalRemaining?i.TotalRemaining:0;n&&n!=i&&(n.isChange=!0);var e=s.listInitDaiBan1.filter(t=>t.LotteryChannelId==n.LotteryChannelId&&t.AgencyId==n.AgencyId)[0];n.TotalRemaining==undefined?(e.TotalRemaining=e.TotalRemaining+i.TotalRemaining,r.TotalRemaining=r.TotalRemaining-i.TotalRemaining,n.TotalRemaining=0,r.detail[f%r.detail.length].total=0,r.Info.forEach(function(n){n.Id==r.detail[f%r.detail.length].Id&&(r.detail[f%r.detail.length].total+=n.TotalRemaining,r.detail[f%r.detail.length].total+=n.TotalDupRemaining)})):e.TotalRemaining-(n.TotalRemaining-i.TotalRemaining)>=0?(e.TotalRemaining=e.TotalRemaining-(n.TotalRemaining-i.TotalRemaining),r.TotalRemaining=r.TotalRemaining+(n.TotalRemaining-i.TotalRemaining),r.detail[f%r.detail.length].total=0,r.Info.forEach(function(n){n.Id==r.detail[f%r.detail.length].Id&&(r.detail[f%r.detail.length].total+=n.TotalRemaining,r.detail[f%r.detail.length].total+=n.TotalDupRemaining)})):n.TotalRemaining=i.TotalRemaining;s.getSum();document.getElementById("quantity_"+u+"_"+f).value=n.TotalRemaining};s.ChangeValueNumber2=function(n,i,r,u,f){r.isCheckDupVal=!0;n.TotalDupRemaining=t.reg.test(n.TotalDupRemaining)?Math.floor(n.TotalDupRemaining):n.TotalDupRemaining?i.TotalDupRemaining:0;n&&n!=i&&(n.isChange=!0);var e=s.listInitDaiBan1.filter(t=>t.LotteryChannelId==n.LotteryChannelId&&t.AgencyId==n.AgencyId)[0];n.TotalDupRemaining==undefined?(e.TotalRemaining=e.TotalRemaining+i.TotalDupRemaining,r.TotalDupRemaining=r.TotalDupRemaining-i.TotalDupRemaining,n.TotalDupRemaining=0,r.detail[f%r.detail.length].total=0,r.Info.forEach(function(n){n.Id==r.detail[f%r.detail.length].Id&&(r.detail[f%r.detail.length].total+=n.TotalRemaining,r.detail[f%r.detail.length].total+=n.TotalDupRemaining)})):e.TotalRemaining-(n.TotalDupRemaining-i.TotalDupRemaining)>=0?(e.TotalRemaining=e.TotalRemaining-(n.TotalDupRemaining-i.TotalDupRemaining),r.TotalDupRemaining=r.TotalDupRemaining+(n.TotalDupRemaining-i.TotalDupRemaining),r.detail[f%r.detail.length].total=0,r.Info.forEach(function(n){n.Id==r.detail[f%r.detail.length].Id&&(r.detail[f%r.detail.length].total+=n.TotalRemaining,r.detail[f%r.detail.length].total+=n.TotalDupRemaining)})):n.TotalDupRemaining=i.TotalDupRemaining;s.getSum();document.getElementById("quantity_dup_"+u+"_"+f).value=n.TotalDupRemaining};s.onClick=function(n,t){document.getElementById("quantity_"+n+"_"+t).focus()};s.onClickDup=function(n,t){document.getElementById("quantity_dup_"+n+"_"+t).focus()};s.getSavingData=function(){var n=[];return s.listSendData=[],s.listInit1.forEach(function(t,i){t.Info.forEach(function(t,r){if(t.isChange==!0){var f={LotteryChannelId:t.LotteryChannelId,AgencyId:t.AgencyId,TotalReceived:t.TotalRemaining,TotalDupReceived:t.TotalDupRemaining,SalePointId:t.SalePointId},u=s.listInit1Bk[i].Info[r],e={AgencyId:u.AgencyId,SalePointId:u.SalePointId,LotteryChannelId:u.LotteryChannelId,TotalTrans:t.TotalRemaining-u.TotalRemaining,TotalTransDup:t.TotalDupRemaining-u.TotalDupRemaining,LotteryDate:s.saveInfo.LotteryDate};s.listSendData.push(e);n.push(f)}})}),n};s.sendDataTL=function(){t.connection.invoke("SendMessage","addLotteryManage",JSON.stringify(s.listSendData)).catch(function(n){return console.error(n.toString())})};s.save=function(){s.isSaving=!0;s.saveInfo.LotteryDate=moment(s.params.day,h).format(c);s.saveInfo.ReceiveData=JSON.stringify(s.getSavingData());f.distributeForSalesPoint(s.saveInfo).then(function(n){n&&n.Id>0?(setTimeout(function(){e.success(n.Message);i.reload();s.isSaving=!1},1e3),s.sendDataTL()):s.isSaving=!1})}}])}(),function(){app.controller("Activity.manageConfirm",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN","$uibModal",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r);h.listGuest=h.listGuest.filter(n=>n.CanBuyWholesale);h.listGuest.unshift({GuestId:0,FullName:"Tất cả",Phone:""});h.listSalePoint.unshift({Id:0,Name:"Tất cả"});h.loadData=function(){i.go(i.current,h.params,{reload:!0,notify:!0})};h.listData.forEach(function(n){n.DataConfirm=n.DataConfirm?JSON.parse(n.DataConfirm):[];n.DataConfirm.forEach(function(t){t.Data=t.Data?JSON.parse(t.Data):[];t.DataActionInfo=t.DataActionInfo?JSON.parse(t.DataActionInfo):[];n.ConfirmStatusId=t.ConfirmStatusId})});h.openDetail=function(n){var i=baseAppPath+"/activity/views/modal/",t=s.open({templateUrl:i+"confirmDetail.html"+versionTemplate,controller:"Activity.confirmDetail as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(t){var i=t.defer();return t.all([]).then(function(){var t={listConfirm:n,listLottery:h.listLottery};i.resolve(t)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});t.result.then(function(){},function(n){typeof n=="object"})}}])}(),function(){app.controller("Activity.managePayment",["$scope","$rootScope","$state","viewModel","sortIcon","salepointService","notificationService","dayOfWeekVN","$uibModal",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r),c,l;h.changeTab=function(n){h.params.tab=n;i.go(i.current,h.params,{reload:!1,notify:!0,inherit:!1})};h.listSalePointBK=angular.copy(h.listSalePoint);h.listSalePoint.unshift({Id:0,Name:"Tất cả"});h.listPayment.forEach(function(n){n.GuestInfo=n.GuestInfo?JSON.parse(n.GuestInfo):[];n.FullName=n.FullName?n.FullName:n.GuestInfo.Name;n.BankAccount=n.GuestActionTypeId==1?n.GuestInfo.BankAccount:"";n.Description=n.GuestActionTypeId==1?n.GuestInfo.Description:""});c=["DD-MM-YYYY","YYYY-MM-DD"];l="YYYY-MM-DD";h.loadData=function(){i.go(i.current,{date:moment(h.params.date,c).format(l),salePointId:h.params.salePointId},{reload:!0,notify:!0})};h.openDetail=function(n){var i=baseAppPath+"/activity/views/modal/",t=s.open({templateUrl:i+"paymentDetail.html"+versionTemplate,controller:"Activity.paymentDetail as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(t){var i=t.defer();return t.all([]).then(function(){var t={paymentData:n};i.resolve(t)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});t.result.then(function(){},function(n){typeof n=="object"})}}])}(),function(){app.controller("Activity.manageScratchcard",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r),h=["DD-MM-YYYY","YYYY-MM-DD"];s.params.day=moment(s.params.day,h).format("DD-MM-YYYY");s.dayDisplay=o[moment(moment(s.params.day,h)).day()].Name+", "+s.params.day;s.dayOfWeekVN=angular.copy(o);s.isSaving=!1;s.TotalRemaining=JSON.parse(s.totalScratchcard.Data);s.init=function(){s.listScratchcard=s.listLotteryDDL.filter(n=>n.IsScratchcard==!0);s.listSalePoint.forEach(function(n){n.listScratchcard=angular.copy(s.listScratchcard);n.listScratchcard.forEach(function(t){t.InputData=0;t.InputDataBK=0;var i=s.listData.filter(function(i){return i.SalePointId==n.Id&&i.LotteryChannelId==t.Id});t.RemainingData=i&&i.length>0?i[0].TotalRemaining:0})});s.listScratchcard.forEach(function(n){var t=s.TotalRemaining.filter(t=>t.LotteryChannelId==n.Id);n.TotalRemaining=t&&t.length>0?t[0].TotalRemaining:0})};s.init();s.onClick=function(n,t){document.getElementById("quantity_"+n+"_"+t).focus()};s.onChangeData=function(n,t,i){var r=n.InputData,u=n.InputDataBK;r&&r!=u?(n.isChange=!0,0>s.listScratchcard[t].TotalRemaining-(r-u)?n.InputData=n.InputDataBK:(s.listScratchcard[t].TotalRemaining-=r-u,n.InputDataBK=r)):r||(s.listScratchcard[t].TotalRemaining+=u,n.InputData=0,n.InputDataBK=n.InputData);document.getElementById("quantity_"+t+"_"+i).value=n.InputData};s.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};s.getSavingData=function(){var n=[];return s.sendData=[],s.listSalePoint.forEach(function(t){t.listScratchcard.forEach(function(i){i.InputData>0&&(n.push({SalePointId:t.Id,TotalReceived:i.InputData,LotteryChannelId:i.Id}),s.sendData.push({isTypeScratch:!0,SalePointId:t.Id,TotalTrans:i.InputData,LotteryChannelId:i.Id}))})}),n};console.log("vm.listSalePoint",s.listSalePoint);s.sendDataTL=function(){t.connection.invoke("SendMessage","addLotteryManage",JSON.stringify(s.sendData)).catch(function(n){return console.error(n.toString())})};s.save=function(){s.isSaving=!0;var n=s.getSavingData();n&&n.length!=0?(s.saveInfo.ReceiveData=JSON.stringify(n),f.distributeScratchForSalesPoint(s.saveInfo).then(function(n){n&&n.Id>0?(setTimeout(function(){e.success(n.Message);i.reload();s.isSaving=!1},1e3),s.sendDataTL()):s.isSaving=!1})):(e.warning("Không có dữ liệu để lưu"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3))}}])}(),function(){app.controller("Activity.manageScratchcardForSubAgency",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r),h=["DD-MM-YYYY","YYYY-MM-DD"];s.params.day=moment(s.params.day,h).format("DD-MM-YYYY");s.dayDisplay=o[moment(moment(s.params.day,h)).day()].Name+", "+s.params.day;s.dayOfWeekVN=angular.copy(o);s.isSaving=!1;s.TotalRemaining=JSON.parse(s.totalScratchcard.Data);s.init=function(){s.listScratchcard=s.listLotteryDDL.filter(n=>n.IsScratchcard==!0);s.listSubAgency.forEach(function(n){n.listScratchcard=angular.copy(s.listScratchcard);n.listScratchcard.forEach(function(t){t.InputData=0;t.InputDataBK=0;var i=s.listData.filter(function(i){return i.AgencyId==n.AgencyId&&i.LotteryChannelId==t.Id});t.RemainingData=i&&i.length>0?i[0].TotalRemaining:0})});s.listScratchcard.forEach(function(n){var t=s.TotalRemaining.filter(t=>t.LotteryChannelId==n.Id);n.TotalRemaining=t&&t.length>0?t[0].TotalRemaining:0})};s.init();console.log("vm.listScratchcard",s.listScratchcard);s.onClick=function(n,t){document.getElementById("quantity_"+n+"_"+t).focus()};s.onChangeData=function(n,t,i){var r=n.InputData,u=n.InputDataBK;r&&r!=u?(n.isChange=!0,0>s.listScratchcard[t].TotalRemaining-(r-u)?n.InputData=n.InputDataBK:(s.listScratchcard[t].TotalRemaining-=r-u,n.InputDataBK=r)):r||(s.listScratchcard[t].TotalRemaining+=u,n.InputData=0,n.InputDataBK=n.InputData);document.getElementById("quantity_"+t+"_"+i).value=n.InputData};s.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};s.getSavingData=function(){var n=[];return s.sendData=[],s.listSubAgency.forEach(function(t){t.listScratchcard.forEach(function(i){i.InputData>0&&(n.push({SalePointId:t.AgencyId,TotalReceived:i.InputData,LotteryChannelId:i.Id}),s.sendData.push({isTypeScratch:!0,SalePointId:t.AgencyId,TotalTrans:i.InputData,LotteryChannelId:i.Id}))})}),n};s.sendDataTL=function(){t.connection.invoke("SendMessage","addLotteryManage",JSON.stringify(s.sendData)).catch(function(n){return console.error(n.toString())})};console.log("vm.listSubAgency",s.listSubAgency);s.save=function(){s.isSaving=!0;console.log("có vào save");var n=s.getSavingData();n&&n.length!=0?(s.saveInfo.ReceiveData=JSON.stringify(n),f.distributeScratchForSubAgency(s.saveInfo).then(function(n){n&&n.Id>0?(setTimeout(function(){e.success(n.Message);i.reload();s.isSaving=!1},1e3),s.sendDataTL()):s.isSaving=!1})):(e.warning("Không có dữ liệu để lưu"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3))}}])}(),function(){app.controller("Activity.manageStaffDebt",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN","$uibModal",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r);h.staffTypeId=String(h.params.userTitleId);h.month=moment().format("YYYY-MM");h.staffType=[{id:5,name:"Nhân viên"},{id:4,name:"Trưởng nhóm"}];h.changeStaff=function(){console.log("vm.staffTypeId: ",h.staffTypeId);h.params.userTitleId=h.staffTypeId;i.go(i.current,h.params,{reload:!0,notify:!0})};h.showDetail=function(n){console.log("model: ",n);var r=baseAppPath+"/report/views/modal/",t=s.open({templateUrl:r+"debtDetail.html"+versionTemplate,controller:"Report.debtDetail as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(t){var i=t.defer();return t.all([f.getPayedDebtAndNewDebtAllTime({userId:n.UserId})]).then(function(n){var t={data:n[0]};i.resolve(t)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});t.result.then(function(){},function(n){typeof n=="object"?(console.log("data: ",n),i.reload()):(console.log("data2: ",n),i.reload())})};h.openModalDebt=function(n){var r=baseAppPath+"/report/views/modal/",t=s.open({templateUrl:r+"newDebt.html"+versionTemplate,controller:"Report.newDebt as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(t){var i=t.defer();return t.all([]).then(function(){var t={data:n,month:h.month};i.resolve(t)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});t.result.then(function(){},function(n){typeof n=="object"?(console.log("data: ",n),i.reload()):(console.log("data2: ",n),i.reload())})}}])}(),function(){app.controller("Activity.activityLog1",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","reportService","salepointService","activityService",function(n,t,i,r,u,f,e,o,s,h){var c=angular.extend(this,e);c.isSaving=!1;c.userInfo={UserId:t.sessionInfo.UserId};c.totalRow=c.listSold&&c.listSold.length>0?c.listSold[0].TotalCount:0;c.totalConfirming1=0;c.init=function(){c.listTrans.forEach(function(n){n.totalConfirming1=0;n.detail=n.DetailData?JSON.parse(n.DetailData):[];n.ConfirmStatusId==1&&c.totalConfirming1++});c.listSold.forEach(function(n){n.detail=n.Data?JSON.parse(n.Data):[]});c.listSold=c.listSold.filter(n=>n.detail.SalePointLogData&&n.detail.SalePointLogData.length>0);c.listSold.forEach(function(n,t){n.TotalQuantity=0;n.RowNumber=t+1;n.TotalPrice=0;n.detail.SalePointLogData.forEach(function(t){t.ShortName="";c.listLottery.forEach(function(n){t.LotteryChannelId==n.Id&&(t.ShortName=n.ShortName)});n.TotalQuantity+=t.Quantity;n.TotalPrice+=t.TotalValue})});c.listTrans.forEach(function(n){n.detail.forEach(function(n){n.ShortName="";c.listLottery.forEach(function(t){n.LotteryChannelId==t.Id&&(n.ShortName=t.ShortName)})})});c.listWinning.forEach(function(n){n.ShortName="";c.listLottery.forEach(function(t){n.LotteryChannelId==t.Id&&(n.ShortName=t.ShortName)})})};c.init();c.getBootBox=function(n){var t="",i;t=confirm?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> xóa vé?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn muốn <strong>huỷ yêu cầu<\/strong> chuyển/nhận vé?';i=bootbox.confirm({message:t,size:"small",buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){},500);t&&c.deleteData(n)}});i.init(function(){setTimeout(function(){$(".modal-body").css("height","")},0)})};c.getBootBoxWinnning=function(n){var t=bootbox.confirm({message:'<i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> xóa trả thưởng?',size:"small",buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){},500);t&&c.deleteWinning(n)}});t.init(function(){setTimeout(function(){$(".modal-body").css("height","")},0)})};c.deleteData=function(n){c.deleteRow={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,Data:JSON.stringify({ActionType:3,HistoryOfOrderId:n.HistoryOfOrderId})};s.updateHistoryOrder(c.deleteRow).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();c.isSaving=!1},200):c.isSaving=!0})};c.deleteWinning=function(n){var r={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,WinningId:n.WinningId};h.deleteLogWinning(r).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();c.isSaving=!1},200):c.isSaving=!0})};c.printBill=function(n){var i={FullAddress:c.listSellData.SalePointAddress!=null?c.listSellData.SalePointAddress:"",SalePoint:c.listSellData.SalePointName,DatePrint:moment(n.CreatedDate).format("DD/MM/YYYY"),ShiftName:c.params.shiftId==1?"Ca Sáng":"Ca Chiều",DateTime:moment().format("HH:mm:ss"),BillNumber:t.createBillNumber(n.HistoryOfOrderId),ActionName:t.sessionInfo.FullName,CustomerName:n.detail.GuestData?n.detail.GuestData.FullName:"Khách lẻ",ListInfo:[],TotalQuatity:n.TotalQuantity,Sum:n.TotalPrice,CustomerGive:0,TotalDebt:0,OldDebt:n.LastData?n.LastData.OldDebt:0,NewDebt:n.LastData?n.LastData.NewDebt:0},r;n.detail.SalePointLogData.forEach(function(n){i.ListInfo.push({LotteryName:n.ShortName,Quantity:n.Quantity,FourLastNumber:n.FourLastNumber?" --> "+n.FourLastNumber:"",Price:n.TotalValue})});n.detail.GuestActionData&&n.detail.GuestActionData.length>0?n.detail.GuestActionData.forEach(n=>i.CustomerGive+=n.TotalPrice):i.CustomerGive=i.Sum;r=n.detail.GuestData?2:1;t.printBill(i,r)};c.cancel=function(){r.close()};c.changeTab=function(n){c.view=n;c.showSaveChange=n=="paying-debt-content"?!0:!1};c.changeTab("activity-log-content")}])}(),function(){app.controller("Activity.checkTransferDetail",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e),h;s.isLoading=!1;h=s.data.TransitionTypeId==2?s.data.ToSalePointId:s.data.FromSalePointId;s.saveData={UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,TransitionTypeId:s.data.TransitionTypeId,SalePointId:s.data.TransitionTypeId==2?s.data.ToSalePointId:s.data.FromSalePointId,Note:"",Data:JSON.stringify(s.data.Data)};s.sendDataTL=function(){t.connection.invoke("SendMessage","SellActivitySalepoint"+h,JSON.stringify(s.saveData)).catch(function(n){return console.error(n.toString())});t.connection.invoke("SendMessage","ChangeRemain","Change").catch(function(n){return console.error(n.toString())})};s.cancel=function(){r.close()};s.getLotteryName=function(n){return s.listLottery.filter(t=>t.Id==n)[0].Name};s.returnTransitionTypeName=function(n){return n==2?"ToSalePointName":"FromSalePointName"};s.getBootBox=function(n){var t="",i;t=n?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> chuyển/nhận vé?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn muốn <strong>huỷ yêu cầu<\/strong> chuyển/nhận vé?';i=bootbox.confirm({message:t,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){$(".modal-lg").css("display","block")},500);t&&(s.isLoading=!0,s.save(n),s.isLoading=!1)}});i.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})};s.save=function(n){s.saveData.IsConfirm=n;o.confirmTransition(s.saveData).then(function(n){n&&n.Id>0?(s.sendDataTL(),f.success(n.Message)):f.warning(n.Message);i.reload()})}}])}(),function(){app.controller("Activity.confirmDetail",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService","salepointService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,e);console.log("a",h.listConfirm);h.saveData={UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,GuestId:h.listConfirm.GuestId};h.data=[];h.listConfirm.DataConfirm.forEach(function(n){n&&h.data.push({ConfirmLogId:n.ConfirmLogId})});h.cancel=function(){r.close()};h.getLotteryName=function(n){return h.listLottery.find(t=>t.Id==n).ShortName};h.getBootBox=function(n){var t="",i;t=n?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> thanh toán khách sỉ?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn muốn <strong>huỷ yêu cầu<\/strong> thanh toán khách sỉ?';i=bootbox.confirm({message:t,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){$(".modal-lg").css("display","block")},500);t&&h.save(n)}});i.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})};h.save=function(n){h.saveData.ConfirmTypeId=n;h.saveData.Data=JSON.stringify(h.data);s.confirmListPayment(h.saveData).then(function(n){n&&n.Id>0?(t.connection.invoke("SendMessage","ChangeRemain","Change").catch(function(n){return console.error(n.toString())}),f.success(n.Message)):f.warning(n.Message);i.reload()})}}])}(),function(){app.controller("Activity.confirmOwnDebt",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService","userService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,e);h.isSaving=!1;h.saveData={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,Data:{UserId:h.data.UserId,DataConfirm:h.data.DataConfirm,ConfirmLogId:h.data.ConfirmLogId}};h.cancel=function(){r.close()};h.getBootBox=function(n){var t="",i;t=n==2?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> yêu cầu nợ riêng?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn muốn <strong>huỷ yêu cầu<\/strong> nợ riêng?';i=bootbox.confirm({message:t,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){$(".modal-lg").css("display","block")},500);t&&h.save(n)}});i.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})};h.save=function(n){h.isSaving=!0;h.saveData.ActionType=n;h.saveData.Data=JSON.stringify(h.saveData.Data);s.insertUpdateBorrow(h.saveData).then(function(n){n&&n.Id>0?(h.isSaving=!1,f.success(n.Message),i.reload()):(f.warning(n.Message),h.isSaving=!1,setTimeout(function(){t.$apply(h.isSaving)},100))})}}])}(),function(){app.controller("Activity.feeOutsideOfSalePoint",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService","salepointService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,e);h.showForm=!1;h.listTab=[{TabName:"Chuyển khoản cho khách",TabId:1},{TabName:"Khách chuyển khoản",TabId:2},{TabName:"Chi phí ngoài",TabId:3},];h.curTab=1;h.changeTab=n=>{h.curTab=n};h.isSaving=!1;h.saveDataCK={GuestActionTypeId:1,FormPaymentId:2,GuestInfo:{},ShiftDistributeId:t.sessionInfo.ShiftDistributeId,SalePointId:h.data.SalePointId};h.saving={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,Data:[],ActionType:1};h.save=function(n){h.saveDataCK.GuestInfo.Name&&h.saveDataCK.GuestInfo.Phone&&h.saveDataCK.GuestInfo.Bank&&h.saveDataCK.GuestInfo.BankAccount&&h.saveDataCK.GuestInfo.Description&&h.saveDataCK.TotalPrice?h.isSaving||(h.isSaving=!0,h.saveDataCK.GuestActionTypeId=n,n==2&&(h.saveDataCK.Note=h.saveDataCK.GuestInfo.Description),h.saveDataCK.GuestInfo=JSON.stringify(h.saveDataCK.GuestInfo),h.saveDataCK.TotalPrice=h.saveDataCK.TotalPrice.replace(/,/g,""),h.saveDataCK.TotalPrice=parseInt(h.saveDataCK.TotalPrice,10),h.saving.Data=[],h.saving.Data.push(h.saveDataCK),h.saving.Data=JSON.stringify(h.saving.Data),s.updateOrCreateGuestAction(h.saving).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.go(i.current,{tab:1},{reload:!0,notify:!0});h.isSaving=!1;t.$apply(h.isSaving)},200):setTimeout(function(){f.error(n.Message);h.isSaving=!1;t.$apply(h.isSaving)},200)})):(f.error("Yêu cầu nhập đầy đủ thông tin khách hàng"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},200))};h.saveData={Quantity:1,SalePointId:h.data.SalePointId,ShiftDistributeId:h.ShiftDistributeId};h.cancel=function(){r.close()};h.showFormAddFee=function(){h.showForm=!0};h.updateListFee=function(n,i){h.saving.ActionType=n;h.saving.Data=[];h.saving.Data.push(i);h.saving.Data=JSON.stringify(h.saving.Data);s.updateFeeOutSite(h.saving).then(function(n){n&&n.Id>0?(f.success(n.Message),s.getListFeeOutsite({shiftDistributeId:h.ShiftDistributeId}).then(function(n){h.listFee=n}),setTimeout(function(){h.isSaving=!1;t.$apply(h.listFee,h.isSaving)},200),h.saveData.TypeNameId=null,h.saveData.Price=null,h.saveData.Note=null):(f.warning(n.Message),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},200))})};h.addNewFee=function(){h.isSaving=!0;h.saveData.Price?(h.saveData.TypeNameId=3,h.showForm=!1,h.updateListFee(1,h.saveData)):(f.warning("Bạn chưa nhập chi phí!"),setTimeout(function(){h.saveData.Price=null;h.SaveData.Note=null;h.saveData.TypeNameId=null;h.isSaving=!1;t.$apply(h.isSaving)},200))};h.getBootBox=function(n){var t="",i;t=n?' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn có <strong>xác nhận muốn xóa<\/strong> chi phí?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn muốn <strong>huỷ yêu cầu<\/strong> chuyển khoản?';i=bootbox.confirm({message:t,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){$(".modal-lg").css("display","block")},500);t&&h.deleteRow(n)}});i.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})};h.deleteRow=function(n){h.saveData.Note=n.Note;h.saveData.TypeNameId=n.TypeNameId;h.saveData.TransactionId=n.TransactionId;h.saveData.Price=n.Price;h.updateListFee(3,h.saveData)}}])}(),function(){app.controller("Activity.input4LastNum",["$scope","$rootScope","$state","viewModel","notificationService","activityService","dashboardService","authService","$uibModal","dayOfWeekVN","ddlService","reportService","ddlService","salepointService","$uibModalInstance",function(n,t,i,r,u,f,e,o,s,h,c,l,c,a,v){var y=angular.extend(this,r);y.isSaving=!1;y.check=!1;y.data=angular.copy(y.model);y.LotteryDateDisplay=moment(y.data.LotteryDate,"YYYY-MM-DD").format("DD-MM-YYYY");y.addRow=function(){y.data.ListDetail.push({input:0,fourLastNumber:null,sum:0})};y.deleteRow=function(n,t){y.data.remaining+=n.input;y.data.TotalRemaining+=n.input;y.data.ListDetail.splice(t,1);y.getSum()};y.ChangeValueSale=function(n,i,r,u=0,f=0){u==null?(n.input=0,y.data.remaining+=f,r<2?y.data.TotalDupRemaining+=f:y.data.TotalRemaining+=f):r<2&&y.data.TotalDupRemaining-(u-f)>=0?y.data.TotalDupRemaining-=u-f:r==2&&y.data.remaining-(u-f)>=0?(y.data.remaining=y.data.remaining-(u-f),y.data.TotalRemaining-=u-f):n.input=f;setTimeout(function(){t.$apply(y.data)},200);y.getSum()};y.getSum=function(){var i=y.data.isScratchCard?2:0,t,n;y.data.inputSale_2=0;y.data.Sum=0;for(let r=0;r<=2;r++)try{r==0?(t=y.typeOfPrice[1].Name,n=y[t].Price,9090.9==n&&(y.data.Sum+=Math.ceil(y.data["inputSale_"+r]*1e4/11*10))):(t=y.typeOfPrice[i].Name,n=y[t].Price,r==2&&y.data.ListDetail.forEach(function(t){t.sum=n*t.input;y.data.inputSale_2+=t.input}),y.data.Sum+=Math.ceil(n*y.data["inputSale_"+r]))}catch(r){u.warning("Error")}};y.save=function(){y.data.ListDetail.forEach(function(n,t){n.input==0&&y.data.ListDetail.splice(t,1)});y.data.ListDetail.forEach(function(n){n.fourLastNumber&&n.fourLastNumber.length==5?y.check=!0:(y.check=!1,setTimeout(function(){u.error("Tất cả các vé phải nhập đủ 5 số")},100))});(y.check||y.data.ListDetail.length==0)&&(setTimeout(function(){u.success("Lưu thành công")},100),v.dismiss(y.data))};y.cancel=function(){v.close()}}])}(),function(){app.controller("Activity.payBorrow",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService","userService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,e);h.isSaving=!1;h.saveData={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,ActionType:1,Data:{UserId:h.data.UserId,FormPaymentId:1}};h.save=function(){h.isSaving=!0;h.saveData.Data.Price=h.saveData.Data.Price.replace(/,/g,"");h.saveData.Data.Price?h.saveData.Data.Price>h.data.TotalRemaining?(f.error("Số tiền trả không lớn hơn số tiền còn nợ"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},100)):(h.saveData.Data=JSON.stringify(h.saveData.Data),s.payBorrow(h.saveData).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);h.isSaving=!1;i.go(i.current,{tab:2},{reload:!0,notify:!0})},100):(f.warning(n.Message),h.isSaving=!1)})):(f.error("Chưa nhập số tiền trả"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},100))};h.cancel=function(){r.close()}}])}(),function(){app.controller("Activity.payingDebt",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e);s.isSaving=!1;s.userInfo={UserId:t.sessionInfo.UserId};s.saveData={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,SalePointId:s.data.SalePointId,UserRoleId:t.sessionInfo.UserRoleId,CustomerName:"",Note:""};s.save=function(){s.isSaving=!0;s.saveData.CustomerName?s.saveData.Amount&&parseInt(s.saveData.Amount)!==0?(s.saveData.Amount=s.saveData.Amount.replace(/[^0-9]/g,""),o.insertRepayment(s.saveData).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();s.isSaving=!1},1e3):s.isSaving=!1})):(f.error("Số tiền không hợp lệ"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3)):(f.error("Chưa nhập tên khách trả"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3))};s.cancel=function(){r.close()}}])}(),function(){app.controller("Activity.paymentDetail",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService","salepointService","$uibModalInstance",function(n,t,i,r,u,f,e,o,s,r){var h=angular.extend(this,e);console.log("user",t.sessionInfo);h.arrayGuestActionId="";h.saveData={UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName};h.data=JSON.parse(h.paymentData.ArrayGuestActionId);h.Data=[];let c=JSON.parse(h.paymentData.ArrayGuestActionId);c.forEach(n=>{h.arrayGuestActionId=h.arrayGuestActionId!=""?h.arrayGuestActionId+","+n:n});h.data.forEach(function(n){h.Data.push({GuestActionId:n,DoneTransfer:!0})});h.cancel=function(){r.close()};h.getBootBox=function(n){var r="",u;r=n==2?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận yêu cầu<\/strong> chuyển khoản?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn muốn <strong>huỷ yêu cầu<\/strong> chuyển khoản?';u=bootbox.confirm({message:r,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(r){setTimeout(function(){$(".modal-lg").css("display","block")},500);r&&(n==2?h.save(n):(dataDelete={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,ArrGuestActionId:String(h.arrayGuestActionId)},o.updateActivityGuestAction(dataDelete).then(n=>{n&&n.Id>0?(f.success(n.Message),i.go(i.current,{},{reload:!0,notify:!0})):f.error(n.Message)})))}});u.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})};h.save=function(){h.saveData.Data=JSON.stringify(h.Data);s.updateOrCreateGuestAction(h.saveData).then(function(n){n&&n.Id>0?f.success(n.Message):f.warning(n.Message);i.reload()})};h.cancelPayment=function(){};h.checkCanClick=function(){var i,r,n;if(console.log(t.sessionInfo),i=t.sessionInfo.SubUserTitle?JSON.parse(t.sessionInfo.SubUserTitle):[],r=t.sessionInfo.UserTitleId,r==9||r==1)return!0;for(n=0;n<i.length;n++)if(i[n].UserTitleId==9||i[n].UserTitleId==1)return!0;return!1}}])}(),function(){app.controller("Activity.purchaseHistory",["$scope","$rootScope","$state","viewModel","sortIcon","salepointService","notificationService","dayOfWeekVN","$uibModal","$uibModalInstance",function(n,t,i,r,u,f,e,o,s,h){var c=angular.extend(this,r);c.isSaving=!1;c.historyLog.forEach(function(n){if(n.Detail=[],n.Data=n.Data?JSON.parse(n.Data):null,n.Data&&(n.Data.LastData=n.Data.LastData?JSON.parse(n.Data.LastData):null),n.Data.SalePointLogData&&n.Data.SalePointLogData.length!=0)n.Data.SalePointLogData.forEach(function(t){try{t.Cash=n.Data.GuestActionData.find(n=>n.FormPaymentId==1&&n.GuestActionTypeId==2).TotalPrice}catch(i){t.Cash=0}try{t.Transfer=n.Data.GuestActionData.find(n=>n.FormPaymentId==2&&n.GuestActionTypeId==2).TotalPrice}catch(i){t.Transfer=0}try{t.PayForGuest=n.Data.GuestActionData.find(n=>n.FormPaymentId==1&&n.GuestActionTypeId==3).TotalPrice}catch(i){t.PayForGuest=0}n.Detail.push(t)});else{var t={};try{t.Cash=n.Data.GuestActionData.find(n=>n.FormPaymentId==1&&n.GuestActionTypeId==2).TotalPrice}catch(i){t.Cash=0}try{t.Transfer=n.Data.GuestActionData.find(n=>n.FormPaymentId==2&&n.GuestActionTypeId==2).TotalPrice}catch(i){t.Transfer=0}try{t.PayForGuest=n.Data.GuestActionData.find(n=>n.FormPaymentId==1&&n.GuestActionTypeId==3).TotalPrice}catch(i){t.PayForGuest=0}n.Detail.push(t)}});c.cancel=function(){h.close()};c.saving={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,Data:[]};c.save=function(){}}])}(),function(){app.controller("Activity.receiving",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e);s.isSaving=!1;s.saveData={ManagerId:s.ManagerId,ShiftDistributeId:t.sessionInfo.ShiftDistributeId,TransTypeId:2,UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName};console.log("today check",s.data.toDay);s.save=function(){var n,r;s.isSaving=!0;s.saveData.ManagerId?(n=[],s.toDayRecevingData.length&&s.toDayRecevingData.forEach(t=>{n.push({LotteryDate:s.data.toDay.dayBK,IsScratchcard:!1,LotteryChannelId:t.channelId,TotalTrans:t.type==1?t.inputReceiving:0,TotalTransDup:t.type==2?t.inputReceiving:0})}),s.nextDayReceivingData.length&&(r=moment(s.data.toDay.dayBK).add(1,"days").format("YYYY-MM-DD"),s.nextDayReceivingData.forEach(t=>{n.push({LotteryDate:r,IsScratchcard:!1,LotteryChannelId:t.channelId,TotalTrans:t.type==1?t.inputReceiving:0,TotalTransDup:t.type==2?t.inputReceiving:0})})),s.scratchCardReceivingData.length&&s.scratchCardReceivingData.forEach(t=>{n.push({LotteryDate:null,IsScratchcard:!0,LotteryChannelId:t.channelId,TotalTrans:t.inputReceiving})}),n=n.filter(n=>n.TotalTrans>0||n.TotalTransDup>0),s.saveData.TransData=JSON.stringify(n),o.insertTransitionLog(s.saveData).then(function(n){t.connection.invoke("SendMessage","checkTransferReload",""+s.saveData.ManagerId).catch(function(n){return console.error(n.toString())});n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();s.isSaving=!1},1e3):s.isSaving=!1})):(f.error("Chưa chọn quản lý đưa vé"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3))};s.toDayRecevingData=[];s.nextDayReceivingData=[];s.scratchCardReceivingData=[];s.initData=function(){var t=[],i=[],n=[];s.listLotteryToday.forEach(n=>{s.toDayRecevingData.push({ShortName:n.ShortName,channel:n.Name,channelId:n.Id,remaining:0,type:1,inputReceiving:0,inventory:0})});s.listLotteryNextDay.forEach(n=>{s.nextDayReceivingData.push({ShortName:n.ShortName,channel:n.Name,channelId:n.Id,remaining:0,type:1,inputReceiving:0,inventory:0})});s.dataInventory.TodayData&&(t=JSON.parse(s.dataInventory.TodayData));s.dataInventory.TomorrowData&&(i=JSON.parse(s.dataInventory.TomorrowData));s.dataInventory.ScratchcardData&&(n=JSON.parse(s.dataInventory.ScratchcardData));console.log("scratchCardInventory",n);t.forEach(n=>{n.TotalRemaining>0&&(s.toDayRecevingData.find(t=>t.channelId==n.LotteryChannelId).inventory=n.TotalRemaining),n.TotalDupRemaining>0&&s.toDayRecevingData.push({ShortName:n.ShortName,channel:n.LotteryChannelName,channelId:n.LotteryChannelId,remaining:0,type:2,inputReceiving:0,inventory:n.TotalDupRemaining})});s.data.toDay&&s.data.toDay.lottery.forEach(n=>{n.TotalRemaining>0&&(s.toDayRecevingData.find(t=>t.channelId==n.LotteryChannelId).remaining=n.TotalRemaining),n.TotalDupRemaining>0&&s.toDayRecevingData.find(t=>t.channelId==n.LotteryChannelId&&t.type==2)!=undefined&&(s.toDayRecevingData.find(t=>t.channelId==n.LotteryChannelId&&t.type==2).remaining=n.TotalDupRemaining)});i.forEach(n=>{n.TotalRemaining>0&&(s.nextDayReceivingData.find(t=>t.channelId==n.LotteryChannelId).inventory=n.TotalRemaining),n.TotalDupRemaining>0&&s.nextDayReceivingData.push({ShortName:n.ShortName,channel:n.LotteryChannelName,channelId:n.LotteryChannelId,remaining:0,type:2,inputReceiving:0,inventory:n.TotalDupRemaining})});s.data.nextDay&&s.data.nextDay.lottery.forEach(n=>{n.TotalRemaining>0&&(s.nextDayReceivingData.find(t=>t.channelId==n.LotteryChannelId).remaining=n.TotalRemaining),n.TotalDupRemaining>0&&s.nextDayReceivingData.find(t=>t.channelId==n.LotteryChannelId&&t.type==2)!=undefined&&(s.nextDayReceivingData.find(t=>t.channelId==n.LotteryChannelId&&t.type==2).remaining=n.TotalDupRemaining)});n.forEach(function(n){console.log("vm.data.ScratchCardData",s.data.ScratchCardData);s.data.scratchCardData&&s.data.scratchCardData.lottery.forEach(function(t){n.LotteryChannelId==t.LotteryChannelId&&n.TotalRemaining>0&&s.scratchCardReceivingData.push({ShortName:t.ShortName,channel:n.LotteryChannelName,channelId:t.LotteryChannelId,remaining:t.TotalRemaining,type:3,inputReceiving:0,inventory:n.TotalRemaining})})})};s.initData();s.ChangeValueReceiving=function(n,t=0,i=0){t==null?(n.inputReceiving=0,n.inventory+=i,n.remaining-=i):n.inventory-(t-i)>=0?(n.inventory=n.inventory-(t-i),n.remaining=n.remaining+t-i):n.inputReceiving=i};s.cancel=function(){r.close()}}])}(),function(){app.controller("Activity.requestNewOwnDebt",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN","$uibModal","$uibModalInstance","userService",function(n,t,i,r,u,f,e,o,s,h){var c=angular.extend(this,r);c.isSaving=!1;c.saving={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")",ActionType:1,Data:{UserId:t.sessionInfo.UserId,DataForConfirm:[]}};c.cancel=function(){s.close()};c.addRequest=function(){c.cash.value||c.transfer?(c.cash.value&&(c.cash.value=c.cash.value.replace(/,/g,""),c.cash.value=parseInt(c.cash.value,10),c.saving.Data.DataForConfirm.push({FormPaymentId:1,Price:c.cash.value})),c.transfer&&c.saving.Data.DataForConfirm.push({FormPaymentId:2,Price:c.transfer}),c.saving.Data=JSON.stringify(c.saving.Data),h.insertUpdateBorrow(c.saving).then(function(n){n&&n.Id>0?(f.success(n.Message),setTimeout(function(){c.isSaving=!1;t.$apply(c.isSaving);i.reload()},100)):(f.warning(n.Message),setTimeout(function(){c.isSaving=!1;t.$apply(c.isSaving)},100))})):(f.warning("Chưa nhập số tiền"),setTimeout(function(){c.isSaving=!1;t.$apply(c.isSaving)},100))}}])}(),function(){app.controller("Activity.return",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e);s.isSaving=!1;s.saveData={ShiftDistributeId:t.sessionInfo.ShiftDistributeId,TransTypeId:3,UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName};s.save=function(){if(s.isSaving=!0,s.saveData.ManagerId){var n=[];s.data.toDay&&s.data.toDay.newLottery.length&&s.data.toDay.newLottery.forEach(t=>{n.push({LotteryDate:s.data.toDay.dayBK,LotteryChannelId:t.channelId,TotalTrans:t.type==1?t.inputReturn:0,TotalTransDup:t.type==2?t.inputReturn:0})});s.data.nextDay&&s.data.nextDay.newLottery.length&&s.data.nextDay.newLottery.forEach(t=>{n.push({LotteryDate:s.data.nextDay.dayBK,LotteryChannelId:t.channelId,TotalTrans:t.type==1?t.inputReturn:0,TotalTransDup:t.type==2?t.inputReturn:0})});n=n.filter(n=>n.TotalTrans!=0||n.TotalTransDup!=0);s.saveData.TransData=JSON.stringify(n);o.insertTransitionLog(s.saveData).then(function(n){t.connection.invoke("SendMessage","checkTransferReload",""+s.saveData.ManagerId).catch(function(n){return console.error(n.toString())});n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();s.isSaving=!1},1e3):s.isSaving=!1})}else f.error("Chưa chọn quản lý lấy vé"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3)};s.initData=function(){var n=[];s.data.toDay.lottery.forEach(function(t){t.TotalRemaining>=0&&s.listLottery.forEach(function(i){t.channelId==i.Id&&n.push({ShortName:i.ShortName,channel:t.channel,channelId:t.channelId,remaining:t.TotalRemaining,type:1,inputReturn:0})});t.TotalDupRemaining!=0&&s.listLottery.forEach(function(i){t.channelId==i.Id&&n.push({ShortName:i.ShortName,channel:t.channel,channelId:t.channelId,remaining:t.TotalDupRemaining,type:2,inputReturn:0})})});s.data.toDay.newLottery=n;try{n=[];s.data.nextDay.lottery.forEach(function(t){t.TotalRemaining!=0&&n.push({channel:t.channel,channelId:t.channelId,remaining:t.TotalRemaining,type:1,inputReturn:0});t.TotalDupRemaining!=0&&n.push({channel:t.channel,channelId:t.channelId,remaining:t.TotalDupRemaining,type:2,inputReturn:0})});s.data.nextDay.newLottery=n}catch(t){}};s.initData();s.ChangeValueReturn=function(n,t=0,i=0){t==null?(n.inputReturn=0,n.remaining+=i):n.remaining-(t-i)>=0?n.remaining=n.remaining-(t-i):n.inputReturn=i};s.cancel=function(){r.close()}}])}(),function(){app.controller("Activity.sellToWholesaleDetail",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService","salepointService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,e);h.totalPayment=h.newDebt;h.newDebt=0;h.savingBill={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")",ActionType:1,Data:{ShiftDistributeId:h.data.ShiftDistributeId,SalePointId:h.data.SalePointId,GuestId:h.wholesaleData.GuestId,ActionType:1,ActionTypeId:1,Data:{OldDebt:0,NewDebt:0}}};h.getSaveData=function(n){var t=[];return n.forEach(function(n){var r,u,i;for(let f=0;f<=2;f++)f==0?n.inputSale_0>0&&(i={LotteryDate:n.LotteryDate=="VE_CAO"?null:n.LotteryDate,IsScratchcard:n.isScratchCard,LotteryChannelId:n.LotteryChannelId,Quantity:n.inputSale_0,LotteryTypeId:2,LotteryPriceId:6},t.push(i)):f!=2||n.isScratchCard||h.params.clientType!=3?n["inputSale_"+f]>0&&(r=n.isScratchCard?2:0,h.wholesaleData?(u=f==1?2:n.isScratchCard?3:1,i={LotteryDate:n.LotteryDate=="VE_CAO"?null:n.LotteryDate,IsScratchcard:n.isScratchCard,LotteryChannelId:n.LotteryChannelId,Quantity:n["inputSale_"+f],LotteryTypeId:f==1?2:n.isScratchCard?3:1,LotteryPriceId:u==1?h.wholesaleData.WholesalePriceId:h.wholesaleData.ScratchPriceId}):i={LotteryDate:n.LotteryDate=="VE_CAO"?null:n.LotteryDate,IsScratchcard:n.isScratchCard,LotteryChannelId:n.LotteryChannelId,Quantity:n["inputSale_"+f],LotteryTypeId:f==1?2:n.isScratchCard?3:1,LotteryPriceId:h[h.typeOfPrice[r].Name].LotteryPriceId},t.push(i)):n["inputSale_"+f]>0&&(r=n.isScratchCard?2:0,n.ListDetail.forEach(function(i){var u={LotteryDate:n.LotteryDate=="VE_CAO"?null:n.LotteryDate,IsScratchcard:n.isScratchCard,LotteryChannelId:n.LotteryChannelId,Quantity:i.input,FourLastNumber:i.fourLastNumber,LotteryTypeId:f==1?2:n.isScratchCard?3:1,LotteryPriceId:h[h.typeOfPrice[r].Name].LotteryPriceId};t.push(u)}))}),t};h.paymentOldDebt={TypeAction:1,Data:[]};h.paymentNewBuy=[];h.totalPayment=0;h.PaymentData.forEach(function(n){h.totalPayment+=n.TotalPrice});h.returnData.totalReturn>h.wholesaleData.Debt?h.returnData.totalReturn-h.wholesaleData.Debt>=h.totalBuy+h.returnForGuest.Input?h.returnForGuest.Input>0&&h.paymentOldDebt.Data.push({TotalPrice:h.returnForGuest.Input,FormPaymentId:1,GuestId:h.wholesaleData.GuestId,SalePointId:h.data.SalePointId,GuestActionTypeId:3,ShiftDistributeId:h.data.ShiftDistributeId}):h.PaymentData.forEach(function(n){var t={GuestId:h.wholesaleData.GuestId,SalePointId:h.data.SalePointId,TotalPrice:n.TotalPrice,FormPaymentId:n.FormPaymentId,GuestActionTypeId:2,ShiftDistributeId:h.data.ShiftDistributeId};n.FormPaymentId==2?(t.Note=n.Note,t.TotalPrice=n.TotalPrice):t.TotalPrice=t.TotalPrice;t.TotalPrice>0&&h.paymentNewBuy.push(t)}):h.totalPayment<=h.wholesaleData.Debt-h.returnData.totalReturn?h.PaymentData.forEach(function(n){n.TotalPrice>0&&(n.GuestId=h.wholesaleData.GuestId,n.SalePointId=h.data.SalePointId,n.GuestActionTypeId=2,n.ShiftDistributeId=h.data.ShiftDistributeId,h.paymentOldDebt.Data.push(n))}):h.PaymentData[1].TotalPrice>h.wholesaleData.Debt-h.returnData.totalReturn?h.PaymentData.forEach(function(n){var t={GuestId:h.wholesaleData.GuestId,SalePointId:h.data.SalePointId,TotalPrice:n.TotalPrice,FormPaymentId:n.FormPaymentId,GuestActionTypeId:2,ShiftDistributeId:h.data.ShiftDistributeId};n.FormPaymentId==2&&(t.Note=n.Note,t.TotalPrice=n.TotalPrice);t.TotalPrice>0&&h.paymentNewBuy.push(t)}):(h.PaymentData.forEach(function(n){var t={GuestId:h.wholesaleData.GuestId,SalePointId:h.data.SalePointId,TotalPrice:n.TotalPrice,FormPaymentId:n.FormPaymentId,GuestActionTypeId:2,Note:n.Note,ShiftDistributeId:h.data.ShiftDistributeId};n.FormPaymentId==1&&(t.TotalPrice=h.wholesaleData.Debt-h.returnData.totalReturn-h.PaymentData[1].TotalPrice);t.TotalPrice>0&&h.paymentOldDebt.Data.push(t)}),h.totalPayment-(h.wholesaleData.Debt-h.returnData.totalReturn)>0&&h.paymentNewBuy.push({GuestId:h.wholesaleData.GuestId,SalePointId:h.data.SalePointId,TotalPrice:h.totalPayment-(h.wholesaleData.Debt-h.returnData.totalReturn),FormPaymentId:1,GuestActionTypeId:2,ShiftDistributeId:h.data.ShiftDistributeId}));h.totalPaymentOldDebt=0;h.paymentOldDebt.Data.length>0&&h.paymentOldDebt.Data.forEach(function(n){n.GuestActionTypeId!=3&&(h.totalPaymentOldDebt+=n.TotalPrice)});h.savingReturn={ShiftDistributeId:t.sessionInfo.ShiftDistributeId,UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")",GuestId:h.wholesaleData.GuestId};h.savingReturn.Data=[];h.returnData.data.forEach(function(n){n.InputReturn>0&&h.savingReturn.Data.push({GuestId:h.wholesaleData.GuestId,LotteryDate:n.IsScratchcard?"":moment().format("YYYY-MM-DD"),IsScratchcard:n.IsScratchcard,LotteryChannelId:n.LotteryChannelId,Quantity:-n.InputReturn,LotteryTypeId:n.IsScratchcard?3:1,LotteryPriceId:n.IsScratchcard?h.mainScratchCardTypeId.LotteryPriceId:h.mainLotteryTypeId.LotteryPriceId})});h.loading=!0;h.saving.LotteryData=[];h.saving.LotteryDataInfo={UserRoleId:h.saving.UserRoleId,GuestId:h.wholesaleData.GuestId,ShiftDistributeId:h.saving.ShiftDistributeId};h.saving.GuestId=h.wholesaleData.GuestId;h.typeOfLottery.forEach(function(n){h.data[n.JSName]&&(h.saving.LotteryData=h.saving.LotteryData.concat(h.getSaveData(h.data[n.JSName].lottery)))});console.log("vm",h);h.saveWholesale=function(){h.isSaving=!0;var n={FullAddress:h.listSellData.SalePointAddress!=null?h.listSellData.SalePointAddress:"",SalePoint:h.listSellData.SalePointName,DatePrint:moment().format("DD/MM/YYYY"),ShiftName:h.params.shiftId==1?"Ca Sáng":"Ca Chiều",DateTime:moment().format("HH:mm:ss"),ActionName:t.sessionInfo.FullName,CustomerName:h.wholesaleData.FullName,ListInfo:[],TotalQuatity:0,Sum:0,CustomerGive:h.totalPayment,TotalDebt:0,OldDebt:h.wholesaleData.Debt,NewDebt:h.newDebt>0?h.newDebt:0};h.savingReturn.Data.forEach(function(t){var i={LotteryName:h.listLottery.find(n=>n.Id==t.LotteryChannelId).ShortName,Quantity:t.Quantity,FourLastNumber:t.FourLastNumber?" --> "+t.FourLastNumber:"",Price:t.LotteryPriceId!=6?t.Quantity*h.listTypeSelect.find(n=>n.LotteryPriceId==t.LotteryPriceId).Price:t.Quantity*1e4/11*10};console.log("temp111",i);n.ListInfo.push(i);n.TotalQuatity+=i.Quantity;n.Sum+=i.Price});h.saving.LotteryData.forEach(function(t){var i={LotteryName:h.listLottery.find(n=>n.Id==t.LotteryChannelId).ShortName,Quantity:t.Quantity,FourLastNumber:t.FourLastNumber?" --> "+t.FourLastNumber:"",Price:t.LotteryPriceId!=6?t.Quantity*h.listTypeSelect.find(n=>n.LotteryPriceId==t.LotteryPriceId).Price:t.Quantity*1e4/11*10};n.ListInfo.push(i);n.TotalQuatity+=i.Quantity;n.Sum+=i.Price});n.CustomerGive=h.totalPayment;n.TotalDebt=h.wholesaleData?h.wholesaleData.Debt:0;n.OldDebt=h.wholesaleData.Debt;n.NewDebt=h.newDebt;h.savingBill.Data.Data.OldDebt=n.OldDebt;h.savingBill.Data.Data.NewDebt=n.NewDebt+h.returnForGuest.Input;h.savingBill.Data.Data=JSON.stringify(h.savingBill.Data.Data);h.savingBill.Data=JSON.stringify(h.savingBill.Data);h.saving.LotteryData.length==0&&h.paymentOldDebt.Data.length==0&&h.savingReturn.Data.length==0?(f.warning("Không có gì để lưu"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},400)):(console.log("vm.savingBill",h.savingBill),s.updateHistoryOrder(h.savingBill).then(function(r){if(console.log("ress",r),r&&r.Id>0){var u=!0;h.saving.OrderId=r.Id;h.savingReturn.OrderId=r.Id;h.paymentOldDebt.OrderId=r.Id;n.BillNumber=t.createBillNumber(r.Id);h.saving.LotteryDataInfo=JSON.stringify(h.saving.LotteryDataInfo);h.savingReturn.Data.length>0&&(h.savingReturn.Data=JSON.stringify(h.savingReturn.Data),o.sellLottery(h.savingReturn).then(async function(){h.isSaving=!1;u&&(t.printBill(n,2),u=!1)}));h.paymentOldDebt.Data.length>0&&(h.paymentOldDebt.UserRoleId=t.sessionInfo.UserRoleId,h.paymentOldDebt.ActionBy=t.sessionInfo.UserId,h.paymentOldDebt.ActionByName=t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")",h.paymentOldDebt.GuestId=h.wholesaleData.GuestId,h.paymentOldDebt.Data=JSON.stringify(h.paymentOldDebt.Data),h.paymentOldDebt.ShiftDistributeId=h.saving.ShiftDistributeId,s.updateOrCreateGuestAction(h.paymentOldDebt).then(async function(){h.isSaving=!1}));h.saving.LotteryData&&h.saving.LotteryData.length>0&&(h.paymentNewBuy&&h.paymentNewBuy.length>0&&(h.saving.PaymentData=h.paymentNewBuy,h.saving.PaymentData.forEach(function(n,t){n.ShiftDistributeId=h.saving.ShiftDistributeId;n.TotalPrice==0&&h.saving.PaymentData.splice(t,1)}),h.saving.PaymentData=JSON.stringify(h.saving.PaymentData)),h.saving.LotteryData=JSON.stringify(h.saving.LotteryData),console.log("vm.saving.LotteryData",h.saving.LotteryData),s.createListConfirmPayment(h.saving).then(async function(i){if(h.isSaving=!1,i&&i.Id>0&&h.newDebt==0){let n={ActionType:4,HistoryOfOrderId:h.saving.OrderId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};n.data=JSON.stringify(n);s.updateHistoryOrder(n).then(n=>{n&&n.Id>0?f.success("Thao tác thành công"):f.error(i.Message)})}else i&&i.Id>0&&(h.typeOfLottery.forEach(function(n){h.data[n.JSName]&&h.data[n.JSName].lottery.forEach(n=>{var i,t;h.data.soldData[0].TotalRetailQuantity+=n.inputSale_0;h.data.soldData[0].TotalRetailPrice+=Math.ceil(n.inputSale_0*h.mainLotteryDupTypeId.Price);i=n.isScratchcard?2:0;for(let r=1;r<=2;r++)t=h[h.typeOfPrice[i].Name],t.LotteryPriceId==1?(h.data.soldData[0].TotalRetailQuantity+=n["inputSale_"+r],h.data.soldData[0].TotalRetailPrice+=n["inputSale_"+r]*t.Price):(h.data.soldData[0].TotalWholesaleQuantity+=n["inputSale_"+r],h.data.soldData[0].TotalWholesalePrice+=n["inputSale_"+r]*t.Price)})}),u&&(t.printBill(n,2),u=!1))}));t.connection.invoke("SendMessage","ChangeRemain","Change").catch(function(n){return console.error(n.toString())});i.go(i.current,h.params,{reload:!0,notify:!0});f.success("Thao tác thành công")}else f.warning("Chưa có ID order")}))};h.cancel=function(){r.close()}}])}(),function(){app.controller("Activity.summary",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService","salepointService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,e);h.isSaving=!1;h.checkZeroVietlott=!1;h.checkZeroLoto=!1;h.TotalReturnBK=0;h.backupVietlott=0;h.backupLoto=0;let c=-1,l=-1;h.total=0;h.listReportLotteryForView=[];h.rawData=h.listReportLottery!=undefined?h.listReportLottery[0].Data!=null?JSON.parse(h.listReportLottery[0].Data):[]:[];h.rawData.forEach(n=>{if(n.LotteryTypeId=1,n.LotteryChannelName=h.listLottery.find(t=>t.Id==n.LotteryChannelId)!=undefined?h.listLottery.find(t=>t.Id==n.LotteryChannelId).ShortName:"",console.log(n.LotteryChannelName),h.listReportLotteryForView.push(n),n.StockDup>0||n.SoldRetailDup>0||n.RemainingDup>0){var t=angular.copy(n);t.LotteryTypeId=2;t.Stock=t.StockDup;t.Remaining=t.remainingDup;t.SoldRetail=t.remainingDup;t.SoldRetailMoney=t.SoldRetailMoneyDup;t.SoldWholeSale=t.SoldWholeSaleDup;t.SoldWholeSaleMoney=t.SoldWholeSaleMoneyDup;h.listReportLotteryForView.push(t)}});h.editNumber1=function(){c=0;c=h.revenue.Vietlott.replace(/,/g,"");c=parseInt(c);h.total=l>0?h.TotalReturnBK+c+l:h.TotalReturnBK+c};h.editNumber2=function(){l=0;l=h.revenue.Loto.replace(/,/g,"");l=parseInt(l);h.total=c>0?h.TotalReturnBK+l+c:h.TotalReturnBK+l};h.changeTotalReturn1=function(){};h.changeTotalReturn2=function(){};h.saveData={UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,ShiftDistributeId:h.ShiftDistributeId};h.totalConfirming1=0;h.listTrans.forEach(function(n){n.detail=JSON.parse(n.DetailData);n.ConfirmStatusId==1&&h.totalConfirming1++});h.summaryLottery=h.dataSummary[0].LotteryData?JSON.parse(h.dataSummary[0].LotteryData):[];h.summaryMoney=h.dataSummary[0].MoneyData?JSON.parse(h.dataSummary[0].MoneyData):null;h.TotalReturnBK=h.summaryMoney.TotalSoldMoney-h.summaryMoney.TotalGuestTransferConfirm+h.summaryMoney.TotalTransferForGuestConfirm-h.summaryMoney.TotalFeeOutSite-h.summaryMoney.WinningPrice;h.lotterySummaryData=h.summaryLottery.filter(n=>n.LotteryDate);h.scratchSummaryData=h.summaryLottery.filter(n=>!n.LotteryDate);h.totalSummaryLottery={TotalReceived:0,TotalRemaining:0,TotalRetail:0,TotalReturns:0,TotalRetailMoney:0,TotalSold:0,TotalSoldMoney:0,TotalStocks:0,TotalTrans:0,TotalWholesale:0,TotalWholesaleMoney:0};h.lotterySummaryData.forEach(function(n){n.DayDisplay=moment(n.LotteryDate).format("DD-MM-YYYY");h.totalSummaryLottery.TotalStocks+=n.TotalStocks;h.totalSummaryLottery.TotalTrans+=n.TotalTrans;h.totalSummaryLottery.TotalReceived+=n.TotalReceived;h.totalSummaryLottery.TotalReturns+=n.TotalReturns;h.totalSummaryLottery.TotalSold+=n.TotalSold;h.totalSummaryLottery.TotalRemaining+=n.TotalRemaining});h.getBootBox=function(n){var t="",i;c>=0&&l>=0?h.summaryMoney.TotalGuestTransferNotConfirm>0||h.summaryMoney.TotalTranferForGuestNotConfirm>0?(h.isSaving=!1,f.warning("Còn yêu cầu chuyển khoản chưa xác nhận!!!")):(t=n?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> muốn kết ca?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn có <strong>xác nhận<\/strong> muốn kết ca?',i=bootbox.confirm({message:t,buttons:{confirm:{label:"Xác nhận",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(n){setTimeout(function(){$(".modal-lg").css("display","block")},500);n&&h.save()}}),i.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})):(h.isSaving=!1,f.warning("Cần nhập đủ doanh thu Vietlott và Loto!!!"))};h.save=function(){h.isSaving=!0;let n=[];if(n.push({TotalReceived:0,TotalRemaining:0,LotteryChannelId:1,LotteryDate:"2023-03-20",LotteryTypeId:1,TotalStocks:0,TotalTrans:0,TotalReturns:0,TotalSold:0,TotalSoldMoney:0,TotalWholesale:0,TotalWholesaleMoney:0,TotalRetail:0,TotalRetailMoney:0}),h.saveData.Data=JSON.stringify(n),h.saveData.temp=n,c>=0&&l>=0){var r={ActionType:1,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,Data:JSON.stringify([{Price:c,SalePointId:h.data.SalePointId,ShiftDistributeId:h.ShiftDistributeId}])};s.saleOfVietlott(r).then(function(n){if(n&&n.Id>0){h.isSaving=!1;var r={ActionType:1,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,Data:JSON.stringify([{Price:l,SalePointId:h.data.SalePointId,ShiftDistributeId:h.ShiftDistributeId,Date:moment().format("YYYY-MM-DD")}])};s.saleOfLoto(r).then(function(n){n&&n.Id>0&&(h.isSaving=!1,h.saveData.Money=h.total,o.shiftTransfer(h.saveData).then(function(n){n&&n.Id>0&&(f.success(n.Message),u.logout().then(function(n){n&&n.Id>0?setTimeout(function(){localStorage.removeItem("bearer");h.isSaving=!1;deleteCookie("AUTH_");t.isReloading=!1;f.success("Đăng xuất thành công");i.go("auth.login")},1e3):(h.isSaving=!1,setTimeout(function(){f.success(n.Message)},1e3))}))}))})}})}else h.isSaving=!1,f.warning("Cần nhập đủ doanh thu Vietlott và Loto")};h.cancel=function(){r.close()}}])}(),function(){app.controller("Activity.transfer",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e);s.isSaving=!1;s.saveData={ShiftDistributeId:t.sessionInfo.ShiftDistributeId,TransTypeId:1,ManagerId:s.ManagerId,UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName};s.save=function(){s.isSaving=!0;console.log("CHECK",s.data);var n=[];s.saveData.ManagerId?(s.data.toDay&&s.data.toDay.newLottery.length&&s.data.toDay.newLottery.forEach(t=>{n.push({LotteryDate:s.data.toDay.dayBK,IsScratchcard:!1,LotteryChannelId:t.channelId,TotalTrans:t.type==1?t.inputTransfer:0,TotalTransDup:t.type==2?t.inputTransfer:0})}),s.data.nextDay&&s.data.nextDay.newLottery.length&&s.data.nextDay.newLottery.forEach(t=>{n.push({LotteryDate:s.data.nextDay.dayBK,IsScratchcard:!1,LotteryChannelId:t.channelId,TotalTrans:t.type==1?t.inputTransfer:0,TotalTransDup:t.type==2?t.inputTransfer:0})}),s.data.scratchCardData&&s.data.scratchCardData.lottery&&s.data.scratchCardData.lottery.length&&s.data.scratchCardData.newLottery.forEach(t=>{n.push({LotteryDate:null,IsScratchcard:!0,LotteryChannelId:t.channelId,TotalTrans:t.inputTransfer})}),n=n.filter(n=>n.TotalTrans>0||n.TotalTransDup>0),console.log("temp",n),s.saveData.TransData=JSON.stringify(n),o.insertTransitionLog(s.saveData).then(function(n){t.connection.invoke("SendMessage","checkTransferReload",""+s.saveData.ManagerId).catch(function(n){return console.error(n.toString())});n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();s.isSaving=!1},1e3):s.isSaving=!1})):(f.error("Chưa chọn quản lý lấy vé"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3))};s.initData=function(){var n=[];console.log("check data",s.data);s.data.toDay&&(s.data.toDay.lottery.forEach(function(t){t.TotalRemaining>=0&&s.listLottery.forEach(function(i){t.channelId==i.Id&&n.push({ShortName:i.ShortName,channel:t.channel,channelId:t.channelId,remaining:t.TotalRemaining,type:1,inputTransfer:0})});t.TotalDupRemaining!=0&&s.listLottery.forEach(function(i){t.channelId==i.Id&&n.push({ShortName:i.ShortName,channel:t.channel,channelId:t.channelId,remaining:t.TotalDupRemaining,type:2,inputTransfer:0})})}),s.data.toDay.newLottery=n);try{n=[];s.data.nextDay&&(s.data.nextDay.lottery.forEach(function(t){t.TotalRemaining!=0&&n.push({channel:t.channel,channelId:t.channelId,remaining:t.TotalRemaining,type:1,inputTransfer:0});t.TotalDupRemaining!=0&&n.push({channel:t.channel,channelId:t.channelId,remaining:t.TotalDupRemaining,type:2,inputTransfer:0})}),s.data.nextDay.newLottery=n)}catch(t){}try{n=[];s.data.scratchCardData.lottery.forEach(function(t){t.TotalRemaining>0&&n.push({channel:t.ShortName,channelId:t.LotteryChannelId,remaining:t.TotalRemaining,type:3,inputTransfer:0})});s.data.scratchCardData.newLottery=n}catch(t){}console.log("data: ",s.data)};s.initData();s.ChangeValueTransfer=function(n,t=0,i=0){t==null?(n.inputTransfer=0,n.remaining+=i):n.remaining-(t-i)>=0?n.remaining=n.remaining-(t-i):n.inputTransfer=i};s.cancel=function(){r.close()}}])}(),function(){app.controller("Activity.transferDetail",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel",function(n,t,i,r,u,f,e){var o=angular.extend(this,e);o.isSaving=!1;o.userInfo={UserId:t.sessionInfo.UserId};o.cancel=function(){r.close()};o.changeTab=function(n){o.view=n;o.showSaveChange=n=="paying-debt-content"?!0:!1};o.changeTab("activity-log-content");o.listData.forEach(function(n){n.ShortName="";try{o.listLottery.forEach(function(t){n.LotteryChannelId==t.Id&&(n.ShortName=t.ShortName)})}catch(t){}})}])}(),function(){app.controller("Activity.updateScratchCardFullLog",["$scope","$rootScope","$state","viewModel","$uibModalInstance","shiftStatus","userService","notificationService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r);s.RevisionNumberUpdate=s.TotalReceive;s.save=function(){if(s.RevisionNumberUpdate!=s.TotalReceive&&s.RevisionNumberUpdate!=null&&!s.isSaving){s.isSaving=!0;var n={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,ScratchcardFullLogId:s.Id,RevisionNumber:Number(s.RevisionNumberUpdate)};console.log("data: ",n);e.updateScratchcardFullLog(n).then(function(n){n&&n.Id>0?setTimeout(function(){o.success(n.Message);i.reload();s.isSaving=!1},1e3):setTimeout(function(){o.error(n.Message);s.isSaving=!1;t.$apply(s.isSaving)},1e3)})}};s.close=function(){u.close()}}])}(),function(){app.controller("Activity.updateScratchCardLog",["$scope","$rootScope","$state","viewModel","$uibModalInstance","shiftStatus","userService","notificationService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r);s.RevisionNumberUpdate=s.TotalReceive;s.save=function(){if(s.RevisionNumberUpdate!=s.TotalReceive&&s.RevisionNumberUpdate!=null&&!s.isSaving){s.isSaving=!0;var n={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,ScratchcardLogId:s.Id,RevisionNumber:Number(s.RevisionNumberUpdate)};console.log("data: ",n);n=JSON.stringify(n);e.updateScratchcardLog(n).then(function(n){n&&n.Id>0?setTimeout(function(){o.success(n.Message);i.reload();s.isSaving=!1},1e3):setTimeout(function(){o.error(n.Message);s.isSaving=!1;t.$apply(s.isSaving)},1e3)})}};s.close=function(){u.close()}}])}(),function(){app.controller("Activity.winningLottery",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","activityService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e);s.isSaving=!1;s.userInfo={UserId:t.sessionInfo.UserId};s.saveData={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,UserRoleId:t.sessionInfo.UserRoleId,SalePointId:s.data.SalePointId};s.errorMsg="";s.save=function(){s.isSaving=!0;s.saveData.WinningTypeId?s.selectedType.HasSalePoint&&!s.saveData.FromSalePointId?(f.error("Chưa chọn cửa hàng bán"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3)):s.selectedType.HasChannel&&!s.saveData.LotteryChannelId?(f.error("Chưa chọn đài xổ số"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3)):s.saveData.WinningPrice&&s.saveData.WinningPrice!=0&&s.saveData.WinningPrice!=""?s.selectedType.HasFourNumber&&s.saveData.Quantity==0?(f.error("Chưa nhập số lượng vé"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3)):(s.saveData.WinningPrice=s.saveData.WinningPrice.replace(/[^0-9]/g,""),o.insertWinningLottery(s.saveData).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();s.isSaving=!1},1e3):s.isSaving=!1})):(f.error("Chưa nhập số tiền trả"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3)):(f.error("Chưa chọn loại trả thưởng"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3))};s.onSelected=function(n){n?(s.saveData.WinningPrice=angular.copy(n.WinningPrize).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),s.selectedType=n,s.saveData.Quantity=1):(s.saveData.WinningPrize=0,s.saveData.Quantity=1,s.selectedType={CanChangePrice:!1,HasChannel:!1,HasFourNumber:!1,HasSalePoint:!1})};s.onSelected();s.OnChangeQuantity=function(n){n?s.saveData.WinningPrice=(n*s.selectedType.WinningPrize).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):(n=0,s.saveData.WinningPrice=0)};$(function(){$("input[name='numonly']").on("input",function(){$(this).val($(this).val().replace(/[^0-9]/g,""))})});s.cancel=function(){r.close()}}])}(),function(){app.controller("Activity.moneyVietlott",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN","$uibModal","userService","salepointService",function(n,t,i,r,u,f,e,o,s,h){var c=angular.extend(this,r),l,a;c.isSaving=!1;c.saving={ActionType:1,ActionBy:t.sessionInfo.UsserId,ActionByName:t.sessionInfo.FullName,Data:[]};l=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"];a="YYYY-MM-DD";c.listSalePoint&&c.listSalePoint.unshift({Id:0,Name:"Tất cả"});c.salepointId=0;c.params.date=moment(c.params.date,l).format("DD-MM-YYYY");c.listData=angular.copy(c.listPayVietlott);c.init=function(){c.listData.forEach(function(n){n.ListHistory=n.ListHistory?JSON.parse(n.ListHistory):[]})};c.init();c.tab=1;c.changeTab=function(n){c.tab=n};c.loadData=function(){i.go(i.current,c.params,{reload:!0,notify:!0})};c.save=function(){c.isSaving=!0;c.saveData.Date?c.saveData.SalePointId?c.saveData.Price?(c.saveData.Date=moment(c.saveData.Date,"DD-MM-YYYY").format("YYYY-MM-DD"),c.isSaving=!1,c.saving.Data.push(c.saveData),c.saving.Data=JSON.stringify(c.saving.Data),h.payVietlott(c.saving).then(function(n){n&&n.Id>0?(f.success(n.Message),setTimeout(function(){t.$apply(c.isSaving)},200),c.params.month=moment().format("YYYY-MM"),i.go(i.current,c.params,{reload:!0,notify:!0})):(f.warning(n.Message),setTimeout(function(){t.$apply(c.isSaving)},200))})):(c.isSaving=!1,f.error("Chưa nhập số tiền nạp!")):(c.isSaving=!1,f.error("Chưa chọn điểm bán!")):(c.isSaving=!1,f.error("Chưa chọn ngày!"))};c.filterbySalePoint=()=>{c.salepointId==0?(c.listData=angular.copy(c.listPayVietlott),c.listData=c.listData.filter(n=>n.SalePointId!=0)):(c.listData=angular.copy(c.listPayVietlott),c.listData=c.listData.filter(n=>n.SalePointId==c.salepointId)),c.listData.forEach(function(n){n.ListHistory=n.ListHistory?JSON.parse(n.ListHistory):[]})};c.getBootBox=function(n){var t="",i;t=confirm?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> xóa?':' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> xóa?';i=bootbox.confirm({message:t,size:"small",buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){$(".modal-lg").css("display","block")},500);t&&c.deleteRow(n)}});i.init(function(){setTimeout(function(){$(".modal-body").css("height","");$(".modal-lg").css("display","none")},0)})};c.getTotalAmount=function(n,t){var i=0;return n.forEach(function(n){n.SalePointId===t&&n.ListHistory&&n.ListHistory.forEach(function(n){i+=n.TotalPrice})}),i};console.log("vm.getTotalAmount ",c.getTotalAmount);c.deleteRow=function(n){c.saveData={Date:n.Date,TransactionId:n.TransactionId,Note:n.Note,Price:n.TotalPrice,SalePointId:n.SalePointId};c.saving.ActionType=3;c.saving.Data.push(c.saveData);c.saving.Data=JSON.stringify(c.saving.Data);h.payVietlott(c.saving).then(function(n){n&&n.Id>0?(f.success(n.Message),setTimeout(function(){t.$apply(c.isSaving)},200),i.reload()):(f.warning(n.Message),setTimeout(function(){t.$apply(c.isSaving)},200))})}}])}(),function(){app.controller("Activity.moveTicket",["$scope","$rootScope","$state","viewModel","sortIcon","$uibModal","dayOfWeek","userService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o,s,h){var c=angular.extend(this,r),y=u,l=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"],v="YYYY-MM-DD",a;c.params.day=moment(c.params.day,l).format("DD-MM-YYYY");c.dayDisplay=h[moment(moment(c.params.day,l)).day()].Name+", "+c.params.day;c.changeDate=function(){i.go(i.current,{day:moment(c.params.day,l).format(v)},{reload:!0,notify:!0})};a=function(n,t){return n.reduce(function(n,i){return(n[i[t]]=n[i[t]]||[]).push(i),n},{})};c.init=function(){var n;c.TotalDataChart=[];var i=a(c.listInventory,"LotteryChannelName"),t=Object.keys(i),r=Object.values(i);for(c.dataDaiBan=[],c.listInventory=Enumerable.From(c.listInventory).GroupBy(function(n){return n.SalePointId}).Select(function(n){var r=0,i=n.source,t=JSON.parse(n.source[0].TransitionLog);if(t&&t.length>0)try{t.forEach(function(n){var t=i.findIndex(t=>t.LotteryChannelId==n.LotteryChannelId);i[t].listLog||(i[t].listLog=[]);n.TransitionTypeId==3&&(r+=n.TotalTrans,r+=n.TotalTransDup);i[t].listLog.unshift(n)})}catch(u){console.log(u)}return t&&t.length>0&&c.TotalDataChart.unshift.apply(c.TotalDataChart,t),{SalePointId:n.source[0].SalePointId,SalePointName:n.source[0].SalePointName,Data:i,ListLogData:t,Transfer:r,Receive:0,isExpand:!1}}).ToArray(),c.saveIndex=-1,n=0;n<t.length;n++)t[n]!="null"&&c.dataDaiBan.push({name:t[n],receive:0,trans:0,total:0});c.listInventory.forEach(function(n){n.dataDaiBan=angular.copy(c.dataDaiBan)});c.listInventory.forEach(function(n){n.dataDaiBan.forEach(function(t){if(n.ListLogData&&n.ListLogData.length>0)try{n.ListLogData.forEach(function(n){n.LotteryChannelName==t.name&&n.TransitionTypeId==3&&(t.trans+=n.TotalTrans,t.trans+=n.TotalTransDup)})}catch(i){console.log(i)}t.total=t.trans-t.receive})});c.dataDaiBan.forEach(function(n){c.listInventory.forEach(function(t){t.dataDaiBan.forEach(function(t){n.name==t.name&&(n.total+=t.total)})})});c.TotalDataChart&&c.TotalDataChart.length>0&&(c.TotalDataChart.sort(function(n,t){return moment(n.TransitionDate)<moment(t.TransitionDate)?-1:moment(n.TransitionDate)>moment(t.TransitionDate)?1:0}),c.ChartGrp=a(c.TotalDataChart,"LotteryChannelName"),c.tempChart=[],c.ChartGrp&&Object.keys(c.ChartGrp).forEach(function(n){var t={Title:n},i=[moment(c.ChartGrp[n][0].LotteryDate).add(7,"hours").format("YYYY-MM-DD 00:00:00")],r=[[""],[""]],u=[null],f=[null],e=0,o=0;c.ChartGrp[n].forEach(function(n){n.TransitionTypeId==3&&(e+=n.TotalTrans+n.TotalTransDup,r[0].push(n.TotalTrans),r[1].push(""),i.push(moment(n.TransitionDate).add(7,"hours").format("YYYY-MM-DD HH:mm:ss")),u.push(e),f.push(o))});i.push(moment(c.ChartGrp[n][0].LotteryDate).add(7,"hours").format("YYYY-MM-DD 23:59:59"));t.listReceive=f;t.listTranfer=u;t.listCustom=r;t.listTime=i;console.log("temp",t);c.tempChart.push(t)}))};c.openDetail=function(n,t){if(n.length>0){var r=baseAppPath+"/activity/views/modal/",i=f.open({templateUrl:r+"transferDetail.html"+versionTemplate,controller:"Activity.transferDetail as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(i,r){var u=i.defer();return i.all([r.lotteryChannelDDL({regionId:2,lotteryDate:moment().format("YYYY-MM-DD")}),]).then(function(i){var r={listData:n,salePoint:t,listLottery:i[0]};u.resolve(r)}),u.promise}]}});i.opened.then(function(){$(document).ready(function(){})});i.result.then(function(){},function(n){typeof n=="object"})}};c.showHide=function(n){c.listInventory[n].ListLogData.length>0&&(c.saveIndex==n?c.listInventory[n].isExpand=c.listInventory[n].isExpand==!1?!0:!1:(c.listInventory[c.saveIndex<0?0:c.saveIndex].isExpand=!1,c.listInventory[n].isExpand=!0,c.saveIndex=n))};c.init();c.clickToday=function(n=0){c.params.day=moment().add(n,"days").format("YYYY-MM-DD");c.changeDate()}}])}(),function(){app.controller("Activity.otherCosts",["$scope","$rootScope","$state","authService","notificationService","viewModel","activityService","salepointService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,f);s.showForm=!1;s.listSalePointForGet=angular.copy(s.listSalePoint);s.date=s.params.day;s.listSalePoint.forEach(function(n){n.Id==s.params.salePointId&&(s.salePointGet=n)});console.log("vm.salePointGet",s.salePointGet);s.saveData={SalePointId:""};s.changeSalePointUpdate=function(n){s.saveData.SalePointId=n.Id};s.showFormAddFee=function(){s.showForm=!0};s.submitSearch=()=>{s.params.day=s.date?moment(s.date).format("YYYY-MM-DD"):moment().format("YYYY-MM-DD"),s.params.salePointId=s.salePointGet?s.salePointGet.Id:0,i.go(i.current,s.params,{reload:!0,notify:!0})};try{s.listSalePointForGet.unshift({Id:0,Name:"All"});s.listActivityCode.unshift({Id:0,Name:"All"})}catch(h){}s.saving={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,Data:[],ActionType:1};s.updateListFee=function(n,i){s.saving.ActionType=n;s.saving.Data=[];s.saving.Data.push(i);s.saving.Data=JSON.stringify(s.saving.Data);o.updateFeeOutSite(s.saving).then(function(n){n&&n.Id>0?(u.success(n.Message),o.getListOtherFees({date:s.params.day,salePointId:s.params.salePointId}).then(function(n){s.listFee=n}),setTimeout(function(){s.isSaving=!1;t.$apply(s.listFee,s.isSaving)},200),s.saveData.TypeNameId=null,s.saveData.Price=null,s.saveData.Note=null):(u.warning(n.Message),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},200))})};s.addNewFee=function(){s.isSaving=!0;s.saveData.TypeNameId?s.saveData.Price?(s.showForm=!1,s.updateListFee(1,s.saveData)):(u.warning("Bạn chưa nhập chi phí!"),setTimeout(function(){s.saveData.Price=null;s.SaveData.Note=null;s.saveData.TypeNameId=null;s.isSaving=!1;t.$apply(s.isSaving)},200)):(u.warning("Bạn chưa chọn loại chi phí!"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},200))};s.getBootBox=function(n){var t="",i;t=n?' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn có <strong>xác nhận muốn xóa<\/strong> chi phí?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn muốn <strong>huỷ yêu cầu<\/strong> chuyển khoản?';i=bootbox.confirm({message:t,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){$(".modal-lg").css("display","block")},500);t&&s.deleteRow(n)}});i.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})};s.deleteRow=function(n){s.saveData.Note=n.Note;s.saveData.TypeNameId=n.TypeNameId;s.saveData.TransactionId=n.TransactionId;s.saveData.Price=n.Price;s.updateListFee(3,s.saveData)}}])}(),function(){app.controller("Activity.ownDebtManage",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN","$uibModal","userService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r),h=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"],c="YYYY-MM-DD";s.params.date=moment(s.params.date,h).format("DD-MM-YYYY");s.changeTab=function(n){s.params.tab=n;s.params.userId="";s.loadData()};s.loadData=function(){s.params.date=moment(s.params.date,h).format(c);i.go(i.current,s.params,{reload:!0,notify:!0})};s.totalRow=s.listBorrow&&s.listBorrow.length>0?s.listBorrow.length:0;s.listBorrow.forEach(function(n){n.DataConfirm=n.DataConfirm?JSON.parse(n.DataConfirm):[];n.DataConfirm&&n.DataConfirm.length>0&&n.DataConfirm.forEach(function(t){n.TotalPrice=0;t.FormPaymentId==1?(n.Cash=t.Price,n.TotalPrice+=n.Cash):(n.Transfer=t.Price,n.TotalPrice+=n.Transfer)})});s.openModalConfirm=function(n){var i=baseAppPath+"/activity/views/modal/",t=o.open({templateUrl:i+"confirmOwnDebt.html"+versionTemplate,controller:"Activity.confirmOwnDebt as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(t){var i=t.defer();return t.all([]).then(function(){var t={data:n};i.resolve(t)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});t.result.then(function(){},function(n){typeof n=="object"})};s.listDetail.forEach(function(n){n.TotalData=n.TotalData?JSON.parse(n.TotalData):[]});s.openModalPayBorrow=function(n){var i=baseAppPath+"/activity/views/modal/",t=o.open({templateUrl:i+"payBorrow.html"+versionTemplate,controller:"Activity.payBorrow as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService",function(t){var i=t.defer();return t.all([]).then(function(){var t={data:n};i.resolve(t)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});t.result.then(function(){},function(n){typeof n=="object"})}}])}(),function(){app.controller("Activity.requestOwnDebt",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN","$uibModal","userService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r);h.saving={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")",Data:{UserId:t.sessionInfo.UserId,DataForConfirm:[]}};h.totalRow=h.listBorrow&&h.listBorrow.length>0?h.listBorrow.length:0;h.listBorrow.forEach(function(n){n.DataConfirm=n.DataConfirm?JSON.parse(n.DataConfirm):[];n.DataConfirm&&n.DataConfirm.length>0&&n.DataConfirm.forEach(function(t){n.TotalPrice=0;t.FormPaymentId==1?(n.Cash=t.Price,n.TotalPrice+=n.Cash):(n.Transfer=t.Price,n.TotalPrice+=n.Transfer)})});console.log("vm.listBorrow: ",h.listBorrow);h.openModalAddRequest=function(){var t=baseAppPath+"/activity/views/modal/",n=o.open({templateUrl:t+"requestNewOwnDebt.html"+versionTemplate,controller:"Activity.requestNewOwnDebt as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","ddlService",function(n){var t=n.defer();return n.all([]).then(function(){t.resolve({})}),t.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});n.result.then(function(){},function(n){typeof n=="object"})};h.getBootBox=function(n){var t="",i;t=n?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xác nhận<\/strong> xóa yêu cầu nợ?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn có <strong>xác nhận<\/strong> xóa yêu cầu nợ?';i=bootbox.confirm({message:t,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){$(".modal-lg").css("display","block")},500);t&&h.deleteRow(n)}});i.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})};h.deleteRow=function(n){console.log("deleteRow: ",n);h.isSaving=!0;h.saving.ActionType=3;h.saving.Data.ConfirmLogId=n.ConfirmLogId;h.saving.Data.DataConfirm=n.DataConfirm;h.saving.Data=JSON.stringify(h.saving.Data);s.insertUpdateBorrow(h.saving).then(function(n){n&&n.Id>0?(f.success(n.Message),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving);i.reload()},200)):(f.warning(n.Message),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},200))})}}])}(),function(){app.controller("Activity.returnAgency",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r),h=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"],c="YYYY-MM-DD";s.isSaving=!1;s.params.day=moment(s.params.day,h).format("DD-MM-YYYY");s.dayDisplay=o[moment(moment(s.params.day,h)).day()].Name+", "+s.params.day;s.dayOfWeekVN=angular.copy(o);s.lotteryDate=moment(s.params.day,h).format("YYYY-MM-DD");s.TypeLottery=[{Name:"listLottery",Type:""},{Name:"listScratchCard",Type:"Vé Cào"}];s.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};s.changeDate=function(){i.go(i.current,{day:moment(s.params.day,h).format(c)},{reload:!0,notify:!0})};s.clickToday=function(n=0){s.params.day=moment().add(n,"days").format("YYYY-MM-DD");s.changeDate()};s.getHaveReturned=function(n,t=-1){var i=0;return t<0?s[n].forEach(function(n){n.listAgency.forEach(function(n){i+=n.TotalHaveReturned})}):s[n][t].listAgency.forEach(function(n){i+=n.TotalHaveReturned}),i};s.getSumAgency=function(n,t,i=-1){var r=0;return i<0?s[n].forEach(function(n){r+=n[t]}):s[n].forEach(function(n){r+=n.listAgency[i][t]}),r};s.OnChangeValue=function(n,t,i){var f=s[n][t].Sum,r=s[n][t].listAgency[i].Receiced,o=s[n][t].listAgency[i].ReceicedDisplay,e=s[n][t].listAgency[i].TotalCanReturn,u=parseInt(o.replace(/,/g,""));f-(u-r)<0||e-(u-r)<0?o=r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):(e=e-(u-r),f=f-(u-r),r=u);s[n][t].Sum=f;s[n][t].listAgency[i].Receiced=r;s[n][t].listAgency[i].ReceicedDisplay=o;s[n][t].listAgency[i].TotalCanReturn=e};s.intiDataLottery=function(n){s[n].forEach(function(n){if(n.listAgency=angular.copy(s.listAgency),n.listAgency.forEach(function(t){var i=s.listData.DataReceived.filter(i=>i.AgencyId==t.Id&&i.LotteryChannelId==n.Id);t.ReceicedDisplay=0;t.Receiced=0;i&&i[0]?(t.TotalReceiced=i[0].TotalReceived,t.TotalHaveReturned=i[0].TotalHaveReturned,t.TotalCanReturn=i[0].TotalCanReturn):(t.TotalReceiced=0,t.TotalHaveReturned=0,t.TotalCanReturn=0)}),s.listData.DataForReturn&&s.listData.DataForReturn.length>0){var t=s.listData.DataForReturn.filter(t=>t.LotteryChannelId==n.Id);t&&t[0]?(n.TotalTrans=t[0].TotalTrans,n.TotalTransDup=t[0].TotalTransDup,n.Sum=n.TotalTrans+n.TotalTransDup):(n.TotalTrans=0,n.TotalTransDup=0,n.Sum=0)}})};s.init=function(){s.listScratchCard=s.listScratchCard.filter(n=>n.IsScratchcard==!0);try{s.listData.DataForReturn=JSON.parse(s.listData[0].DataForReturn)}catch(n){s.listData.DataForReturn=[]}try{s.listData.DataReceived=JSON.parse(s.listData[0].DataReceived)}catch(n){s.listData.DataReceived=[]}s.TypeLottery.forEach(n=>s.intiDataLottery(n.Name));console.log("vm.listScratchCard",s.listScratchCard);console.log("vm.listAgency",s.listAgency);console.log("vm.listLottery",s.listLottery);console.log("vm.listData",s.listData)};s.init();s.getSaveData=function(){var n=[];return s.TypeLottery.forEach(function(t){s[t.Name].forEach(function(t){var i=t.TotalTransDup;t.listAgency.forEach(function(r){if(r.Receiced>0){var u=r.Receiced,f=0;i-r.Receiced>=0?(u=0,f=r.Receiced,i=i-r.Receiced):i>0&&(f=i,u=r.Receiced-i,i=0);n.push({LotteryDate:s.lotteryDate,LotteryChannelId:t.Id,FromSalePointId:0,ToAgencyId:r.Id,TotalTrans:u,TotalTransDup:f,IsScratchcard:t.IsScratchcard})}})})}),n};s.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")",ActionType:1,Date:moment().format("YYYY-MM-DD")};s.save=function(){s.isSaving=!0;var n=s.getSaveData();n==[]?(e.warning("Không có thông tin để lưu"),s.isSaving=!1):(s.saveInfo.Data=JSON.stringify(n),f.returnLottery(s.saveInfo).then(function(n){n&&n.Id>0?setTimeout(function(){e.success(n.Message);i.reload();s.isSaving=!1},1e3):(e.warning(n.Message),s.isSaving=!1)}))}}])}(),function(){app.controller("Activity.salesActivity",["$scope","$rootScope","$state","viewModel","notificationService","activityService","dashboardService","authService","$uibModal","dayOfWeekVN","ddlService","reportService","ddlService","salepointService",function(n,t,i,r,u,f,e,o,s,h,c,l,c,a){var v=angular.extend(this,r),y;n.isLoading=!1;v.isSaving=!1;y=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"];v.dayOfWeekVN=angular.copy(h);v.checkShow=!1;v.showLD="overlay-hide";v.checkButtonTT=v.params.clientType&&v.params.clientType!=1?!1:!0;v.typeOfLottery=[{Id:1,JSName:"toDay",ApiName:"TodayData",ListPrice:"Normal"},{Id:2,JSName:"nextDay",ApiName:"TomorrowData",ListPrice:"Dup"},{Id:3,JSName:"scratchCardData",ApiName:"ScratchcardData",ListPrice:"ScratchCard"}];v.typeOfPrice=[{Id:1,Name:"mainLotteryTypeId"},{Id:2,Name:"mainLotteryDupTypeId"},{Id:3,Name:"mainScratchCardTypeId"}];v.listPriceNormal=v.listTypeSelect.filter(n=>n.LotteryTypeIds.includes("1")&&n.LotteryPriceId!=6);v.listPriceDup=v.listTypeSelect.filter(n=>n.LotteryTypeIds.includes("2")&&n.LotteryPriceId!=6);v.listPriceScratchCard=v.listTypeSelect.filter(n=>n.LotteryTypeIds.includes("3")&&n.LotteryPriceId!=6);v.mainLotteryTypeId=v.listPriceNormal[0];v.mainScratchCardTypeId=v.listPriceScratchCard[0];v.mainLotteryDupTypeId=v.listTypeSelect.filter(n=>n.LotteryPriceId==6)[0];console.log("vm.listPriceScratchCard ",v.listPriceScratchCard);v.listSellData.TodayData||v.listSellData.TomorrowData||(v.noData=!0);v.isChangeValue=!1;t.connection.on("ReceiveMessage",function(n,t){var r,e,i,f;n=="SellActivitySalepoint"+v.data.SalePointId&&t?(i=JSON.parse(t),i.IsConfirm==!0?(r=i.TransitionTypeId==2,e=JSON.parse(i.Data),e.forEach(function(n){v.addData("toDay",n,r);v.addData("nextDay",n,r)})):setTimeout(function(){u.warning("Trưởng nhóm vừa huỷ yêu cầu")},500)):n=="addLotteryManage"&&t&&(i=JSON.parse(t),f=i.filter(n=>n.SalePointId==v.data.SalePointId),f.length>0&&(f.forEach(function(n){n.isTypeScratch?v.addData("",n,!0,!0):(v.addData("toDay",n,!0),v.addData("nextDay",n,!0))}),v.isChangeValue=!0,setTimeout(function(){u.success("Bạn vừa nhận thêm vé thêm từ người chia vé")},500)))});v.addData=function(n,i,r,f=false){var e,o;try{if(f)o=v.data.ScratchCardData.findIndex(n=>n.LotteryChannelId==i.LotteryChannelId),o<0?v.isChangeValue=!0:(r?v.data.ScratchCardData[o].TotalRemaining+=i.TotalTrans:v.data.ScratchCardData[o].TotalRemaining-=i.TotalTrans,setTimeout(function(){u.success("Bạn vừa nhận thêm vé cào từ trưởng nhóm");t.$apply(v.data)},500));else if(v.data[n]&&v.data[n].dayBK==i.LotteryDate){if(e=v.data[n].lottery.filter(n=>n.LotteryChannelId==i.LotteryChannelId)[0],o=v.data[n].lottery.findIndex(n=>n.LotteryChannelId==i.LotteryChannelId),o<0)v.isChangeValue=!0;else{if(r){e.remaining+=i.TotalTrans;e.remainingBK+=i.TotalTrans;e.TotalRemaining+=i.TotalTrans;try{e.remainingDupBK+=i.TotalTransDup;e.TotalDupRemaining+=i.TotalTransDup;v.isChangeValue=!0}catch(s){}}else{e.remaining-=i.TotalTrans;e.remainingBK-=i.TotalTrans;e.TotalRemaining-=i.TotalTrans;try{e.remainingDupBK-=i.TotalTransDup;e.TotalDupRemaining-=i.TotalTransDup;v.isChangeValue=!0}catch(s){}}v.data[n].lottery[o]=e}t.$apply(v.data);v.getTotal();setTimeout(function(){u.success("Trưởng nhóm vừa xác nhận yêu cầu")},500)}}catch(s){v.isChangeValue=!0}};v.saving={ShiftDistributeId:t.sessionInfo.ShiftDistributeId,UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")"};v.changeTab=function(n){t.closeKeyBoard();v.params.clientType=n;i.go(i.current,v.params,{reload:!1,notify:!0,inherit:!1})};v.today=moment().format("YYYY-MM-DD");v.initSubData=function(n){var t=JSON.parse(n),i=!1,r=!1;return t[0].LotteryDate&&t[0].LotteryDate.length!=0?t[0].Day=v.dayOfWeekVN[moment(t[0].LotteryDate).day()].Name+", "+moment(t[0].LotteryDate).format("DD-MM-YYYY"):(t[0].Day="Vé Cào",r=!0),t.forEach(function(n){n.channel=n.LotteryChannelName?n.LotteryChannelName:n.ShortName;n.channelId=n.LotteryChannelId;n.remaining=n.TotalRemaining;n.TotalDupRemaining>0&&(i=!0);n.remainingBK=n.TotalRemaining;n.remainingDupBK=n.TotalDupRemaining;n.inputTemp=0;n.inputSale_0=0;n.inputSale_1=0;n.inputSale_2=0;n.isScratchCard=r}),{dayBK:t[0].LotteryDate,day:t[0].Day,lottery:t,isShowDup:i}};v.getTotal=function(){v.typeOfLottery.forEach(function(n){var r=n.JSName,i;try{v.data[r].lottery&&v.data[r].lottery.length>0&&(i={Total:0,TotalMoney:0},v.data[r].lottery.forEach(function(n){i.Total+=(n.TotalRemaining?n.TotalRemaining:0)+(n.TotalDupRemaining?n.TotalDupRemaining:0);i.TotalMoney+=n.Sum?n.Sum:0;n.totalRemainingBK=n.totalRemainingBK?n.totalRemainingBK:n.remaining;n.TotalDupRemainingBK=n.TotalDupRemainingBK?n.TotalDupRemainingBK:n.TotalDupRemaining}),v["typeData"+n.Id]=i,setTimeout(function(){t.$apply([v.typeData1,v.typeData2,v.typeData3])},200))}catch(u){}})};v.initData=function(){var t={SalePointId:0,SalePointName:"Không tìm thấy ca trực",ShiftDistributeId:0},n=v.listSellData;n&&(t.SalePointId=n.SalePointId,t.SalePointName=n.SalePointName,t.ShiftDistributeId=n.ShiftDistributeId,v.typeOfLottery.forEach(function(i){n[i.ApiName]&&(t[i.JSName]=v.initSubData(n[i.ApiName]))}));t.soldData=JSON.parse(n.SoldData);v.data=t;v.getTotal()};v.initData();console.log("vm.listSellData.ManagerName",v.listSellData);v.getSum=function(n){var r,i,t;console.log("model",n);r=n.isScratchCard?2:0;console.log("getType",r);n.Sum=0;for(let f=0;f<=2;f++)try{f==0?(i=v.typeOfPrice[1].Name,console.log("vm",v),t=v[i].Price,console.log("getName",i),9090.9==t&&(n.Sum+=Math.ceil(n["inputSale_"+f]*1e4/11*10),console.log("vào đây",n.Sum))):(i=v.typeOfPrice[r].Name,t=0,n.ShortName=="Vé Bóc"||n.ShortName=="Cào XO"?t=5e3:n.ShortName=="Cào ĐN"?t=1e4:n.ShortName=="Cào XO 2k"?t=2e3:n.ShortName=="Cào TP"?t=v.wholesaleData!=null?v.wholesaleData.ScratchPrice:v[i].Price:v.wholesaleData!=null?t=v.wholesaleData.WholesalePrice:(console.log("Vào đây2"),t=v[i].Price),n.Sum+=Math.ceil(t*n["inputSale_"+f]))}catch(f){u.warning("Error")}};v.ChangeValueSaleModify=function(n,t=0,i=0){t==null?(n.inputTemp=0,n.TotalDupRemaining+=i*11):n.TotalDupRemaining-(t-i)*11>=0?n.TotalDupRemaining-=(t-i)*11:n.inputTemp=i;n.inputSale_0=n.inputTemp*11;v.getSum(n);v.getTotal();v.params.clientType==3&&v.getTotalBuy()};v.ChangeValueSale=function(n,i,r,u=0,f=0){var o,e;v.mainLotteryTypeId=v.listPriceNormal[0];v.mainScratchCardTypeId=v.listPriceScratchCard[0];v.mainLotteryDupTypeId=v.listTypeSelect.filter(n=>n.LotteryPriceId==6)[0];console.log("channel",n);console.log("typePrice",i);u==null?(n["inputSale_"+r]=0,n.remaining+=f,r<2?n.TotalDupRemaining+=f:n.TotalRemaining+=f):(o=v.typeOfPrice[i].Name,console.log("getName1: ",String(o)),e=v[String(o)].Step,console.log("step: ",e),u%e!=0&&(u<f?(u=u-u%e,n["inputSale_"+r]=u):(u=u+(e-u%e),n["inputSale_"+r]=u)),r<2&&n.TotalDupRemaining-(u-f)>=0?n.TotalDupRemaining-=u-f:r==2&&n.remaining-(u-f)>=0?(n.remaining=n.remaining-(u-f),n.TotalRemaining-=u-f):n["inputSale_"+r]=f);setTimeout(function(){t.$apply(n)},200);v.getSum(n);v.getTotal();v.wholesaleData&&(v.getTotalBuy(),console.log("Vào ddaaay1111112 "));console.log("Vào ddaaay ")};v.openModalTransfer=function(){var t=baseAppPath+"/activity/views/modal/",n=s.open({params:{day:{value:"",squash:!0}},templateUrl:t+"transfer.html"+versionTemplate,controller:"Activity.transfer as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","ddlService",function(n,t,i){var u=n.defer(),r=angular.copy(t);return r.day=r.day==""?moment().format("YYYY-MM-DD"):r.day,n.all([i.lotteryChannelDDL({regionId:2,lotteryDate:r.day}),]).then(function(n){var t={ManagerId:v.listSellData.ManagerId,ManagerName:v.listSellData.ManagerName,listLottery:n[0],data:angular.copy(v.data)};u.resolve(t)}),u.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh")})});n.result.then(function(){},function(n){typeof n=="object"})};v.openModalReceiving=function(){var t=baseAppPath+"/activity/views/modal/",n=s.open({params:{day:{value:"",squash:!0}},templateUrl:t+"receiving.html"+versionTemplate,controller:"Activity.receiving as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","ddlService","activityService",function(n,t,i,r){var u=n.defer(),e=angular.copy(t),f=moment(v.today).add(1,"days").format("YYYY-MM-DD");return n.all([r.getDataInventory({date:v.today}),i.lotteryChannelDDL({regionId:2,lotteryDate:v.today}),i.lotteryChannelDDL({regionId:2,lotteryDate:f}),]).then(function(n){var t={ManagerId:v.listSellData.ManagerId,ManagerName:v.listSellData.ManagerName,dataInventory:n[0],listLotteryToday:n[1],listLotteryNextDay:n[2],data:angular.copy(v.data)};u.resolve(t)}),u.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh")})});n.result.then(function(){},function(n){typeof n=="object"})};v.openModalReturn=function(){var t=baseAppPath+"/activity/views/modal/",n=s.open({params:{day:{value:"",squash:!0}},templateUrl:t+"return.html"+versionTemplate,controller:"Activity.return as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","ddlService",function(n,t,i){var u=n.defer(),r=angular.copy(t);return r.day=r.day==""?moment().format("YYYY-MM-DD"):r.day,n.all([i.userByTitleDDL({UserTitleId:4}),i.lotteryChannelDDL({regionId:2,lotteryDate:r.day}),]).then(function(n){var t={managerList:n[0],listLottery:n[1],data:angular.copy(v.data)};u.resolve(t)}),u.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh")})});n.result.then(function(){},function(n){typeof n=="object"})};v.openModalPayingDebt=function(){var t=baseAppPath+"/activity/views/modal/",n=s.open({templateUrl:t+"payingDebt.html"+versionTemplate,controller:"Activity.payingDebt as $vm",backdrop:"static",size:"md",resolve:{viewModel:{data:v.data}}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh")})});n.result.then(function(){},function(n){typeof n=="object"})};v.openModalActivityLog=function(){var i=baseAppPath+"/activity/views/modal/",n=s.open({params:{day:{value:"",squash:!0},p:{value:"1",squash:!0},ps:{value:"99999",squash:!0}},templateUrl:i+"activityLog.html"+versionTemplate,controller:"Activity.activityLog1 as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","userService","activityService","reportService","salepointService","ddlService",function(n,i,r,u,f,e,o){var h=n.defer(),s=angular.copy(i);return s.day=s.day==""?moment().format("YYYY-MM-DD"):s.day,s.p=!parseInt(s.p)||parseInt(s.p)<1?1:s.p,s.ps=!parseInt(s.ps)||parseInt(s.ps)<1?99999:s.ps,n.all([u.getSalePointLog({UserRoleId:t.sessionInfo.UserRoleId,ShiftDistributeId:v.data.ShiftDistributeId,SalePointId:v.data.SalePointId,Date:moment(v.data.toDay.dayBK).format("YYYY-MM-DD")}),u.getRepaymentLog({UserRoleId:t.sessionInfo.UserRoleId,ShiftDistributeId:v.data.ShiftDistributeId,SalePointId:v.data.SalePointId,Date:moment(v.data.toDay.dayBK).format("YYYY-MM-DD")}),u.getWinningList({shiftDistributeId:v.data.ShiftDistributeId,salePointId:v.data.SalePointId,date:moment(v.data.toDay.dayBK).format("YYYY-MM-DD")}),u.getSoldLogDetail({UserRoleId:t.sessionInfo.UserRoleId,ShiftDistributeId:v.data.ShiftDistributeId}),u.getTransLogDetail({ShiftDistributeId:v.data.ShiftDistributeId}),o.lotteryChannelDDL({regionId:2,lotteryDate:s.day}),e.getListHistoryOrder({shiftDistributeId:v.data.ShiftDistributeId,p:s.p,ps:s.ps})]).then(function(n){let t=n[0].filter(n=>n.TransitionTypeId==0),i=n[0].filter(n=>n.TransitionTypeId!=0);var r={params:s,listSalePointLog:t,listTransferLog:i,listPayingDebtLog:n[1],listWinning:n[2],listSold:n[6],listTrans:n[4],listLottery:n[5],data:v.data,listSellData:v.listSellData};h.resolve(r)}),h.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh");$(".modal-lg").css("max-width","950px")})});n.result.then(function(){},function(n){typeof n=="object"})};v.openModalWinningLottery=function(){var t=baseAppPath+"/activity/views/modal/",n=s.open({templateUrl:t+"winningLottery.html"+versionTemplate,controller:"Activity.winningLottery as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","ddlService",function(n,t){var i=n.defer();return n.all([t.winningTypeDDL(),t.lotteryChannelDDL({RegionId:2,LotteryDate:null}),t.salePointDDL()]).then(function(n){var t={winningTypeDDL:n[0],channels:n[1],salePoints:n[2],data:v.data};i.resolve(t)}),i.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh")})});n.result.then(function(){},function(n){typeof n=="object"})};v.openModalSummary=function(n){var r=document.getElementById("showSpiner"),u,i;r.style.display="inline-block";v.showLD="overlay";u=baseAppPath+"/activity/views/modal/";i=s.open({params:{day:{value:"",squash:!0}},templateUrl:u+"summary.html"+versionTemplate,controller:"Activity.summary as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService",function(i,r,u,f,e){var s=i.defer(),o=angular.copy(r);return o.day=o.day==""?moment().format("YYYY-MM-DD"):o.day,i.all([f.reuseReportDataFinishShift({UserRole:t.sessionInfo.UserRoleId,shiftDistributeId:v.data.ShiftDistributeId}),u.lotteryChannelDDL({regionId:2,lotteryDate:o.day}),e.getTransLogDetail({ShiftDistributeId:v.data.ShiftDistributeId}),f.reportLotteryInADay({SalePointId:v.data.SalePointId,Date:moment().format("YYYY-MM-DD"),ShiftId:v.params.shiftId})]).then(function(t){console.log("res3",t[3]);var i={flag:n,dataSummary:t[0],listLottery:t[1],listTrans:t[2],listReportLottery:t[3],data:v.data,ShiftDistributeId:v.params.shiftDistributeId};s.resolve(i)}),s.promise}]}});i.opened.then(function(){r.style.display="none";v.showLD="overlay-hide";$(document).ready(function(){$(".modal-body").css("height","60vh");$(".modal-lg").css("max-width","70%")})});i.result.then(function(){},function(n){typeof n=="object"})};v.openModalInput4LastNum=function(n,i,r){n.ListDetail||(n.ListDetail=[]);var f=baseAppPath+"/activity/views/modal/",u=s.open({params:{},templateUrl:f+"input4LastNum.html"+versionTemplate,controller:"Activity.input4LastNum as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService",function(t,i){var r=t.defer(),u=angular.copy(i);return t.all([]).then(function(){var t={model:n,mainLotteryTypeId:v.mainLotteryTypeId,mainScratchCardTypeId:v.mainScratchCardTypeId,mainLotteryDupTypeId:v.mainLotteryDupTypeId,typeOfPrice:v.typeOfPrice};r.resolve(t)}),r.promise}]}});u.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh");$(".modal-lg").css("max-width","950px")})});u.result.then(function(){},function(u){typeof u=="object"&&(setTimeout(function(){t.$apply(n)},20),v.data[i].lottery[r]=u,v.getSum(n),v.getTotal(),v.wholesaleData&&v.getTotalBuy())})};v.openModalFeeOutside=function(n){var i=baseAppPath+"/activity/views/modal/",t=s.open({params:{},templateUrl:i+"feeOutsideOfSalePoint.html"+versionTemplate,controller:"Activity.feeOutsideOfSalePoint as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService","salepointService",function(t,i,r,u,f,e){var o=t.defer(),s=angular.copy(i);return t.all([r.getTypeNameDDL({transactionTypeId:1}),e.getListFeeOutsite({shiftDistributeId:n}),r.salePointDDL()]).then(function(n){var t={data:v.data,listTypeOfFee:n[0],listFee:n[1],listSalePoint:n[2],ShiftDistributeId:v.params.shiftDistributeId};o.resolve(t)}),o.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh");$(".modal-lg").css("max-width","950px")})});t.result.then(function(){},function(n){typeof n=="object"})};v.openModalPurchaseHistory=function(){var t=baseAppPath+"/activity/views/modal/",n=s.open({params:{p:{value:"1",squash:!0},ps:{value:"100",squash:!0},guestId:{value:v.wholesaleData.GuestId,squash:!0}},templateUrl:t+"purchaseHistory.html"+versionTemplate,controller:"Activity.purchaseHistory as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService","salepointService",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(t);return e.p=e.p?e.p:"1",e.ps=e.ps?e.ps:"100",n.all([f.getListHistoryOfGuest({p:e.p,ps:e.ps,guestId:v.wholesaleData.GuestId})]).then(function(n){var t={params:e,data:v.data,historyLog:n[0]};o.resolve(t)}),o.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh");$(".modal-lg").css("max-width","950px")})});n.result.then(function(){},function(n){typeof n=="object"})};v.getSaveData=function(n){var t=[];return n.forEach(function(n){var i,r;for(let u=0;u<=2;u++)u==0?n.inputSale_0>0&&(r={LotteryDate:n.LotteryDate=="VE_CAO"?null:n.LotteryDate,IsScratchcard:n.isScratchCard,LotteryChannelId:n.LotteryChannelId,Quantity:n.inputSale_0,LotteryTypeId:2,LotteryPriceId:6},t.push(r)):u!=2||n.isScratchCard?n["inputSale_"+u]>0&&(i=n.isScratchCard?2:0,console.log("check",v[v.typeOfPrice[i].Name].LotteryPriceId),r={LotteryDate:n.LotteryDate=="VE_CAO"?null:n.LotteryDate,IsScratchcard:n.isScratchCard,LotteryChannelId:n.LotteryChannelId,Quantity:n["inputSale_"+u],LotteryTypeId:u==1?2:n.isScratchCard?3:1,LotteryPriceId:n.LotteryChannelId==1002||n.LotteryChannelId==1003?10:n.LotteryChannelId==1004?11:v[v.typeOfPrice[i].Name].LotteryPriceId},t.push(r)):n["inputSale_"+u]>0&&(i=n.isScratchCard?2:0,n.ListDetail.forEach(function(r){var f={LotteryDate:n.LotteryDate=="VE_CAO"?null:n.LotteryDate,IsScratchcard:n.isScratchCard,LotteryChannelId:n.LotteryChannelId,Quantity:r.input,FourLastNumber:r.fourLastNumber,LotteryTypeId:u==1?2:n.isScratchCard?3:1,LotteryPriceId:n.LotteryChannelId==1002||n.LotteryChannelId==1003?10:n.LotteryChannelId==1004?11:v[v.typeOfPrice[i].Name].LotteryPriceId};t.push(f)}))}),t};v.save=function(){var n,i,o,r,e,s;v.isSaving=!0;v.saving.Data=[];v.typeOfLottery.forEach(function(n){v.data[n.JSName]&&(v.saving.Data=v.saving.Data.concat(v.getSaveData(v.data[n.JSName].lottery)))});n={FullAddress:v.listSellData.SalePointAddress,SalePoint:v.listSellData.SalePointName,DatePrint:moment().format("DD/MM/YYYY"),ShiftName:v.params.shiftId==1?"Ca Sáng":"Ca Chiều",DateTime:moment().format("HH:mm:ss"),ActionName:t.sessionInfo.FullName,CustomerName:"Khách lẻ",ListInfo:[],TotalQuatity:0,Sum:0,CustomerGive:0,TotalDebt:0,OldDebt:0,NewDebt:0,PromotionCode:"",ChannelName:""};v.saving.Data.forEach(function(t){var i={LotteryName:v.listLottery.find(n=>n.Id==t.LotteryChannelId).ShortName,Quantity:t.Quantity,FourLastNumber:t.FourLastNumber?"-->"+t.FourLastNumber:"",Price:t.LotteryChannelId==1002||t.LotteryChannelId==1003?t.Quantity*5e3:t.LotteryChannelId==1004?t.Quantity*2e3:t.LotteryPriceId!=6?t.Quantity*v.listTypeSelect.find(n=>n.LotteryPriceId==t.LotteryPriceId).Price:t.Quantity*1e4/11*10};n.ListInfo.push(i);n.TotalQuatity+=i.Quantity;n.Sum+=i.Price;console.log("temp",i)});i=[{dayId:0,name:"Kon Tum"},{dayId:1,name:"Thừa Thiên Huế"},{dayId:2,name:"Đăk Lăk"},{dayId:3,name:"Đà Nẵng"},{dayId:4,name:"Quảng Trị"},{dayId:5,name:"Ninh Thuận"},{dayId:6,name:"Quảng Ngãi"},];n.CustomerGive=n.Sum;n.TotalDebt=0;v.saving.Data.length==0?(u.warning("Không có gì để lưu"),setTimeout(function(){v.isSaving=!1;t.$apply(v.isSaving)},400)):(o=v.saving.Data.filter(n=>n.IsScratchcard==!1),r=o.map(function(n){return n.LotteryDate}),console.log("listDate",r),e=moment.max(r.map(function(n){return moment(n,"YYYY-MM-DD")})),s=moment.min(r.map(function(n){return moment(n,"YYYY-MM-DD")})),console.log(s),console.log(e),o.find(n=>moment(n.LotteryDate,"YYYY-MM-DD").day()!=moment().day())?(console.log("case 1 - trong đơn hàng có vé ngày hôm khác "),moment().day()==6?(console.log("case 1.1"),n.ChannelName=i.find(n=>n.dayId==0).name+" "+moment(e).format("DD/MM/YYYY")):(console.log("case 1.2"),n.ChannelName=i.find(n=>n.dayId==moment().day()+1).name+" "+moment(e).format("DD/MM/YYYY"))):(console.log("case 2 - trong đơn hàng chỉ có vé ngày hôm nay "),n.ChannelName=i.find(n=>n.dayId==moment().day()).name+" "+moment(s).format("DD/MM/YYYY")),v.saving.Data=JSON.stringify(v.saving.Data),f.sellLottery(v.saving).then(async function(i){i.PromotionCode==null&&i.PromotionCode==undefined?(n.PromotionCode="",n.ChannelName=""):n.PromotionCode=i.PromotionCode.substring(1,i.PromotionCode.length-1).split(",").join(" | \n");v.isSaving=!1;i&&i.Id>0&&(v.data.toDay.lottery.forEach(function(n){n.totalRemainingBK=n.remaining;n.TotalDupRemainingBK=n.TotalDupRemaining}),n.BillNumber=t.createBillNumber(i.OrderId),v.typeOfLottery.forEach(function(n){v.data[n.JSName]&&v.data[n.JSName].lottery.forEach(n=>{var i,t;v.data.soldData[0].TotalRetailQuantity+=n.inputSale_0;v.data.soldData[0].TotalRetailPrice+=Math.ceil(n.inputSale_0*v.mainLotteryDupTypeId.Price);i=n.isScratchcard?2:0;for(let r=1;r<=2;r++)t=v[v.typeOfPrice[i].Name],t.LotteryPriceId==1?(v.data.soldData[0].TotalRetailQuantity+=n["inputSale_"+r],v.data.soldData[0].TotalRetailPrice+=n["inputSale_"+r]*t.Price):(v.data.soldData[0].TotalWholesaleQuantity+=n["inputSale_"+r],v.data.soldData[0].TotalWholesalePrice+=n["inputSale_"+r]*t.Price);n.ListDetail=[];n.inputSale_0=0;n.inputSale_1=0;n.inputSale_2=0;n.inputTemp=0;n.Sum=0})}),v.getTotal(),u.success("Thao tác thành công"),t.connection.invoke("SendMessage","ChangeRemain","Change").catch(function(n){return console.error(n.toString())}),t.printBill(n,1))}))};v.returnLottery=1;v.returnData={data:[],totalReturn:0};v.totalBuy=0;v.PaymentData=[{TotalPrice:0,FormPaymentId:1},{TotalPrice:0,FormPaymentId:2,Note:""}];v.changeReturnTab=function(n){v.returnLottery=n};v.listWholesaleGuest=null;v.wholesaleData=null;v.params.clientType==2&&c.getGuestDDL({salePointId:v.data.SalePointId}).then(async function(n){v.listWholesaleGuest=n.filter(n=>n.CanBuyWholesale)});v.params.clientType==3&&c.getGuestDDL({salePointId:v.data.SalePointId}).then(async function(n){v.listWholesaleGuest=n.filter(n=>!n.CanBuyWholesale)});v.loadWholesaleData=function(n){v.wholesaleData=n;n.CanBuyWholesale&&(v.mainLotteryTypeId=v.listPriceNormal.filter(t=>t.LotteryPriceId==n.WholesalePriceId)[0],v.mainScratchCardTypeId=v.listPriceScratchCard.filter(t=>t.LotteryPriceId==n.ScratchPriceId)[0]);v.newDebt=v.wholesaleData.Debt;v.returnForGuest={Debt:v.wholesaleData.Debt<0?0-v.wholesaleData.Debt:0,Input:0};a.getDataForGuestReturn({date:moment().format("YYYY-MM-DD"),guestId:n.GuestId}).then(function(n){v.returnData.data=n;v.returnData.data.forEach(function(n){n.LotteryName=v.listLottery.find(t=>t.Id==n.LotteryChannelId).ShortName;n.InputReturn=0;n.SumReturn=0;n.Day=n.IsScratchcard?"":moment().format("DD/MM/YYYY")})})};v.changeValuePayment=function(n,t=0,i=0){t==null?(n.TotalPrice=0,v.newDebt+=i):v.newDebt-(t-i)>=0?v.newDebt-=t-i:n.TotalPrice=i};v.changeInputReturnForGuest=function(n,t=0,i=0){t==null?(v.returnForGuest.Input=0,v.returnForGuest.Debt+=i):v.returnForGuest.Debt-(t-i)>=0?v.returnForGuest.Debt-=t-i:v.returnForGuest.Input=i};v.checkCode=function(){return v.PaymentData[1].TotalPrice>0};v.getTotalBuy=function(){v.totalBuy=0;for(var n=1;n<=3;n++)v["typeData"+n]&&v["typeData"+n].TotalMoney&&(v.totalBuy+=v["typeData"+n].TotalMoney);v.getNewDebt()};v.getNewDebt=function(){v.newDebt=v.wholesaleData.Debt-v.returnData.totalReturn+v.totalBuy-(v.PaymentData[0].TotalPrice+v.PaymentData[1].TotalPrice);v.returnForGuest.Debt=v.newDebt<0?0-v.newDebt:0};v.changeInputReturn=function(n,t=0,i=0){t==null?(n.InputReturn=0,n.TotalCanReturn+=i):n.TotalCanReturn-(t-i)>=0?n.TotalCanReturn-=t-i:n.InputReturn=i;v.getSumReturn(n);v.getTotalReturn()};v.getSumReturn=function(n){n.SumReturn=n.IsScratchcard?Math.ceil(n.InputReturn*v.mainScratchCardTypeId.Price):Math.ceil(n.InputReturn*v.mainLotteryTypeId.Price)};v.getTotalReturn=function(){v.returnData.totalReturn=0;v.returnData.data.forEach(function(n){v.returnData.totalReturn+=n.SumReturn});v.getNewDebt()};v.openModalSellToWholesale=function(){t.closeKeyBoard();var i=baseAppPath+"/activity/views/modal/",n=s.open({templateUrl:i+"sellToWholesaleDetail.html"+versionTemplate,controller:"Activity.sellToWholesaleDetail as $vm",backdrop:"static",size:"lg",resolve:{viewModel:["$q","ddlService","salepointService",function(n){var t=n.defer();return n.all([]).then(function(){var n={params:v.params,listSellData:v.listSellData,wholesaleData:v.wholesaleData,typeOfLottery:v.typeOfLottery,listLottery:v.listLottery,typeOfPrice:v.typeOfPrice,listTypeSelect:v.listTypeSelect,PaymentData:v.PaymentData,returnForGuest:v.returnForGuest,saving:v.saving,data:v.data,returnData:v.returnData,mainLotteryTypeId:v.mainLotteryTypeId,mainScratchCardTypeId:v.mainScratchCardTypeId,mainLotteryDupTypeId:v.mainLotteryDupTypeId,totalBuy:v.totalBuy,newDebt:v.newDebt};t.resolve(n)}),t.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").removeClass("modal-body")})});n.result.then(function(){},function(n){typeof n=="object"})};console.log("vm.data: ",v.data)}])}(),function(){app.controller("Activity.scratchCardFullLog",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN","$uibModal",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r);s.day=s.params.day;s.TotalReceiveForUpdate;console.log("listScratchCardFullLog: ",s.listScratchCardFullLog);s.totalRow=s.listScratchCardFullLog&&s.listScratchCardFullLog.length>0?s.listScratchCardFullLog.length:0;s.changeDate=function(){s.params.p=1;s.params.day=s.day?moment(s.day).format("YYYY-MM-DD"):moment().format("YYYY-MM-DD");i.go(i.current,s.params,{reload:!0,notify:!0})};s.openModal=function(n={}){var r=baseAppPath+"/activity/views/modal/",t=o.open({templateUrl:r+"updateScratchCardFullLog.html"+versionTemplate,controller:"Activity.updateScratchCardFullLog as $vm",backdrop:"static",size:"sm",resolve:{viewModel:["$q","$uibModal","userService","ddlService",function(t){var i=t.defer(),r=angular.copy(n.ScratchcardFullLogId),u=angular.copy(n.TotalReceive);return t.all([]).then(function(){var n={Id:r,TotalReceive:u};i.resolve(n)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-footer").addClass("remove-modal-footer")})});t.result.then(function(){},function(n){typeof n=="object"&&i.reload()})}}])}(),function(){app.controller("Activity.scratchCardLog",["$scope","$rootScope","$state","viewModel","activityService","notificationService","dayOfWeekVN","$uibModal",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r);s.day=s.params.day;s.totalRow=s.listScratchCardLog&&s.listScratchCardLog.length>0?s.listScratchCardLog.length:0;s.changeDate=function(){s.params.p=1;s.params.day=s.day?moment(s.day).format("YYYY-MM-DD"):moment().format("YYYY-MM-DD");i.go(i.current,s.params,{reload:!0,notify:!0})};s.openModal=function(n={}){var r=baseAppPath+"/activity/views/modal/",t=o.open({templateUrl:r+"updateScratchCardLog.html"+versionTemplate,controller:"Activity.updateScratchCardLog as $vm",backdrop:"static",size:"sm",resolve:{viewModel:["$q","$uibModal","userService","ddlService",function(t){var i=t.defer(),r=angular.copy(n.ScratchcardLogId),u=angular.copy(n.TotalReceived);return t.all([]).then(function(){var n={Id:r,TotalReceive:u};i.resolve(n)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-footer").addClass("remove-modal-footer")})});t.result.then(function(){},function(n){typeof n=="object"&&i.reload()})}}])}(),function(){app.controller("Activity.selectSalepoint",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN",function(n,t,i,r){var u=angular.extend(this,r)}])}(),function(){app.controller("Activity.sendAndReceive",["$scope","$rootScope","$state","viewModel","notificationService","reportService","shiftStatus",function(n,t,i,r){function e(n){var t=moment(n,"YYYY-MM").format("YYYY-MM-01"),i=moment(n,"YYYY-MM").endOf("month").format("YYYY-MM-DD");return{startDate:t,endDate:i}}function e(n){var t=moment(n,"YYYY-MM").format("YYYY-MM-01"),i=moment(n,"YYYY-MM").endOf("month").format("YYYY-MM-DD");return{startDate:t,endDate:i}}var u=angular.extend(this,r),o,s,f;u.month=u.params.month==""?moment().format("YYYY-MM"):u.params.month;u.thisMonth=moment(u.month,"YYYY-MM").format("MM-YYYY");u.listMonth=[];u.dataTable=[];u.listDate=[],{startDate:o,endDate:s}=e(u.month);f=o;u.getDaysArray=function(n,t){for(var r=t-1,o=["(CN)","(T2)","(T3)","(T4)","(T5)","(T6)","(T7)"],i=new Date(n,r,1),e=[];i.getMonth()==r;)e.push(i.getDate()+" "+o[i.getDay()]),i.setDate(i.getDate()+1);while(moment(f)<=moment(s)){const n=moment(f).format("YYYY-MM-DD"),t=parseInt(n.slice(8)),i={date:n,time:e[t-1],quantity:0};u.listDate.push(i);f=moment(f).add(1,"day")}};u.init=function(){var t,i,n,r,f,o;for(u.listMonth=[],{startDate:t,endDate:i}=e(u.month),n=t;moment(n)<=moment(i);)r=moment(n).format("YYYY-MM-DD"),u.listMonth.push({date:r,quantity:0}),n=moment(n).add(1,"day");u.listSalePoint.forEach(function(n){var i=0,t={};t.name=n.Name;t.data=[];t.data1=[];u.listMonth.forEach(function(){t.data.push(null);t.data1.push(null)});u.listTransitionTypeOffset.forEach(function(r){var u;n.Id==r.SalePointId&&r.ChannelGroup==-1?(i+=r.Offset,u=parseInt(r.TransitionDate.slice(8,10))-1,t.data[u]+=r.Offset):n.Id==r.SalePointId&&r.ChannelGroup==1&&(i+=r.Offset,u=parseInt(r.TransitionDate.slice(8,10))-1,t.data1[u]+=r.Offset)});u.dataTable.push(t)});f=u.month?moment(u.month).format("MM"):moment().format("MM");o=u.month?moment(u.month).format("YYYY"):moment().format("YYYY");u.getDaysArray(o,f)};u.init();console.log("vm.dataTable",u.dataTable);console.log("vm.listTransitionTypeOffset",u.listTransitionTypeOffset);u.loadData=function(){u.params.month=moment(u.month).format("YYYY-MM");i.go(i.current,u.params,{reload:!1,notify:!0})}}])}(),function(){app.controller("Activity.staticFee",["$scope","$rootScope","$state","viewModel","notificationService","reportService","shiftStatus","$uibModal",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r);s.month=s.params.month==""?moment().format("YYYY-MM"):s.params.month;s.thisMonth=moment(s.month,"YYYY-MM").format("MM-YYYY");s.listMonth=[];s.isSaving=!1;s.dataTable=[];s.listDisplay=[{Name:"Tiền điện ",DisplayName:"ElectronicFee",Id:1},{Name:"Tiền nước",DisplayName:"WaterFee",Id:2},{Name:"Tiền mặt bằng",DisplayName:"EstateFee",Id:3},{Name:"Tiền internet",DisplayName:"InternetFee",Id:4}];s.changeFee=function(n){console.log("ele: ",n)};s.init=function(){s.listSalePoint.forEach(function(n){var t={};t.name=n.Name;t.id=n.Id;t.data=[];s.listDisplay.forEach(i=>{smallData={id:i.Id,fee:0,feeName:i.DisplayName,isUpdate:!1},t.data.push(smallData),s.listStaticFee.forEach(function(i){n.Id==i.SalePointId&&t.data.forEach(function(n){n.feeName=="WaterFee"?(n.fee=i.WaterFee,n.isUpdate=!0):n.feeName=="ElectronicFee"?(n.fee=i.ElectronicFee,n.isUpdate=!0):n.feeName=="EstateFee"?(n.fee=i.EstateFee,n.isUpdate=!0):n.feeName=="InternetFee"&&(n.fee=i.InternetFee,n.isUpdate=!0)})})});s.dataTable.push(t)});console.log("listSalePoint: ",s.listSalePoint);console.log("dataTable: ",s.dataTable)};s.init();s.loadData=function(){s.params.month=moment(s.month).format("YYYY-MM");i.go(i.current,s.params,{reload:!1,notify:!0})};console.log("dataTable111: ",s.dataTable);s.updateStaticFee=function(n,t,i){var u=baseAppPath+"/activity/views/modal/",r=o.open({params:{},templateUrl:u+"updateStaticFee.html"+versionTemplate,controller:"Activity.updateStaticFee as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService",function(r,u){var f=r.defer(),e=angular.copy(u);return r.all([]).then(function(){var r={data:n,index:t,fee:i};f.resolve(r)}),f.promise}]}});r.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh");$(".modal-lg").css("max-width","950px")})});r.result.then(function(){},function(n){typeof n=="object"})}}])}(),function(){app.controller("Activity.subAgencyPrice",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r);s.listLotteryOnWeek=angular.copy(o);s.listLotteryOnWeek.sort((n,t)=>n.Id2-t.Id2);s.isSaving=!1;s.init=function(){s.listLottery.forEach(function(n){n.DayId=JSON.parse(n.DayIds)});s.listScratchcard=s.listLottery.filter(n=>n.IsScratchcard==!0);var n=!0;s.listLotteryOnWeek.push({isColor:n,LotteryData:s.listScratchcard,SName:"Vé cào",IsScratchcard:!0});s.listLotteryOnWeek.forEach(function(t){t.isColor=n;t.IsScratchcard||(t.LotteryData=s.listLottery.filter(n=>n.DayId.includes(t.Id2)));t.LotteryData.forEach(function(n){n.listSubAgency=angular.copy(s.listSubAgency);n.listSubAgency.forEach(function(t){let i=s.listData.filter(i=>i.AgencyId==t.AgencyId&&i.LotteryChannelId==n.Id);t.PriceDisplay=i&&i[0]?i[0].Price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):0;t.isChange=!1})});n=!n})};s.init();s.getListSave=function(){var n=[];return s.listLotteryOnWeek.forEach(function(t){t.LotteryData.forEach(function(t){t.listSubAgency.forEach(function(i){i.isChange==!0&&(i.Price=i.PriceDisplay.replace(/,/g,""),n.push({AgencyId:i.AgencyId,LotteryChannelId:t.Id,Price:i.Price}))})})}),n};s.saveInfo={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName+" ("+t.sessionInfo.UserTitleName+")",ActionType:1};s.save=function(){s.isSaving=!0;var n=s.getListSave();n.length==0?(e.warning("Không có gì để lưu"),s.isSaving=!1):(s.saveInfo.Data=JSON.stringify(n),f.updateLotteryPriceSubAgency(s.saveInfo).then(function(n){n&&n.Id>0?(e.success(n.Message),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving);i.reload()},1500)):(e.warning(n.Message),s.isSaving=!1)}))}}])}(),function(){app.service("activityService",["baseService",function(n){var t=n.baseUrl+"/Activity";this.receiveLotteryFromAgency=function(i){var r=t+"/ReceiveLotteryFromAgency";return n.postData(r,i)};this.getDataReceivedFromAgency=function(i){var r=t+"/GetDataReceivedFromAgency";return n.getData(r,i)};this.getTmpWinningTicket=function(i){var r=t+"/GetTmpWinningTicket";return n.getData(r,i)};this.distributeForSalesPoint=function(i){var r=t+"/DistributeForSalesPoint";return n.postData(r,i)};this.updateIsdeletedSalepointLog=function(i){var r=t+"/UpdateIsdeletedSalepointLog";return n.postData(r,i)};this.updateActivityGuestAction=function(i){var r=t+"/UpdateActivityGuestAction";return n.postData(r,i)};this.insertOrUpdateAgency=function(i){var r=t+"/InsertOrUpdateAgency";return n.postData(r,i)};this.insertOrUpdateSubAgency=function(i){var r=t+"/InsertOrUpdateSubAgency";return n.postData(r,i)};this.getDataDistributeForSalePoint=function(i){var r=t+"/GetDataDistributeForSalePoint";return n.getData(r,i)};this.sellLottery=function(i){var r=t+"/SellLottery";return n.postData(r,i)};this.getDataSell=function(i){var r=t+"/GetDataSell";return n.getData(r,i)};this.getListSubAgency=function(i){var r=t+"/GetListSubAgency";return n.getData(r,i)};this.insertTransitionLog=function(i){var r=t+"/InsertTransitionLog";return n.postData(r,i)};this.getSalePointLog=function(i){var r=t+"/GetSalePointLog";return n.getData(r,i)};this.getListLotteryPriceSubAgency=function(i){var r=t+"/GetListLotteryPriceSubAgency";return n.getData(r,i)};this.insertRepayment=function(i){var r=t+"/InsertRepayment";return n.postData(r,i)};this.getDataInventory=function(i){var r=t+"/GetDataInventory";return n.getData(r,i)};this.getRepaymentLog=function(i){var r=t+"/GetRepaymentLog";return n.getData(r,i)};this.getInventoryLog=function(i){var r=t+"/GetInventoryLog";return n.getData(r,i)};this.getDataInventoryInMonthOfAllSalePoint=function(i){var r=t+"/GetDataInventoryInMonthOfAllSalePoint";return n.getData(r,i)};this.insertWinningLottery=function(i){var r=t+"/InsertWinningLottery";return n.postData(r,i)};this.shiftTransfer=function(i){var r=t+"/ShiftTransfer";return n.postData(r,i)};this.receiveScratchcardFromAgency=function(i){var r=t+"/ReceiveScratchcardFromAgency";return n.postData(r,i)};this.getDataScratchcardFromAgency=function(i){var r=t+"/GetDataScratchcardFromAgency";return n.getData(r,i)};this.distributeScratchForSalesPoint=function(i){var r=t+"/DistributeScratchForSalesPoint";return n.postData(r,i)};this.distributeScratchForSubAgency=function(i){var r=t+"/DistributeScratchForSubAgency";return n.postData(r,i)};this.getDataDistributeScratchForSalePoint=function(){var i=t+"/GetDataDistributeScratchForSalePoint";return n.getData(i)};this.getDataDistributeScratchForSubAgency=function(){var i=t+"/GetDataDistributeScratchForSubAgency";return n.getData(i)};this.getScratchcardFull=function(){var i=t+"/GetScratchcardFull";return n.getData(i)};this.getWinningList=function(i){var r=t+"/GetWinningList";return n.getData(r,i)};this.getTransitionListToConfirm=function(i){var r=t+"/GetTransitionListToConfirm";return n.getData(r,i)};this.getShiftDistributeByDate=function(i){var r=t+"/GetShiftDistributeByDate";return n.getData(r,i)};this.confirmTransition=function(i){var r=t+"/ConfirmTransition";return n.postData(r,i)};this.getSoldLogDetail=function(i){var r=t+"/GetSoldLogDetail";return n.getData(r,i)};this.getTransLogDetail=function(i){var r=t+"/GetTransLogDetail";return n.getData(r,i)};this.getSalePointReturn=function(i){var r=t+"/GetSalePointReturn";return n.getData(r,i)};this.createSalePoint=function(i){var r=t+"/CreateSalePoint";return n.postData(r,i)};this.updateLotteryPriceAgency=function(i){var r=t+"/UpdateLotteryPriceAgency";return n.postData(r,i)};this.updateLotteryPriceSubAgency=function(i){var r=t+"/UpdateLotteryPriceSubAgency";return n.postData(r,i)};this.getLotteryPriceAgency=function(i){var r=t+"/GetLotteryPriceAgency";return n.getData(r,i)};this.getListLotteryForReturn=function(i){var r=t+"/GetListLotteryForReturn";return n.getData(r,i)};this.returnLottery=function(i){var r=t+"/ReturnLottery";return n.postData(r,i)};this.updateConstantPrice=function(i){var r=t+"/UpdateConstantPrice";return n.postData(r,i)};this.deleteLogWinning=function(i){var r=t+"/DeleteLogWinning";return n.postData(r,i)};this.getListHistoryForManager=function(i){var r=t+"/GetListHistoryForManager";return n.getData(r,i)};this.getListReportMoneyInADay=function(i){var r=t+"/getListReportMoneyInADay";return n.getData(r,i)};this.updateReportMoneyInAShift=function(i){var r=t+"/UpdateReportMoneyInAShift";return n.postData(r,i)};this.updatePriceForGuest=function(i){var r=t+"/UpdatePriceForGuest";return n.postData(r,i)};this.deleteGuestAction=function(i){var r=t+"/DeleteGuestAction";return n.postData(r,i)};this.distributeForSupAgency=function(i){var r=t+"/DistributeForSubAgency";return n.postData(r,i)};this.getDataSupAgency=function(i){var r=t+"/GetDataSubAgency";return n.getData(r,i)};this.updatePriceForSubAgency=function(i){var r=t+"/UpdatePriceForSubAgency";return n.postData(r,i)};this.getStaticFee=function(i){var r=t+"/GetStaticFee";return n.getData(r,i)};this.updateStaticFee=function(i){var r=t+"/UpdateStaticFee";return n.postData(r,i)};this.distributeForSubAgency=function(i){var r=t+"/DistributeForSubAgency";return n.postData(r,i)};this.getDebtOfStaff=function(i){var r=t+"/GetDebtOfStaff";return n.getData(r,i)};this.updateDebt=function(i){var r=t+"/UpdateDebt";return n.postData(r,i)};this.getPayedDebtAndNewDebtAllTime=function(i){var r=t+"/GetPayedDebtAndNewDebtAllTime";return n.getData(r,i)}}])}();