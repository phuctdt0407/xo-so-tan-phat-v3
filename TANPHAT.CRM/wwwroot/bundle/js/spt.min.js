(function(){app.controller("Salepoint.commissionWinning",["$scope","$rootScope","$state","viewModel","notificationService","userService","$uibModal","salepointService",function(n,t,i,r,u,f,e,o){function h(n){var t=moment(n,"YYYY-MM").format("YYYY-MM-01"),i=moment(n,"YYYY-MM").endOf("month").format("YYYY-MM-DD");return{startDate:t,endDate:i}}var s=angular.extend(this,r);s.month=s.params.month;s.listDateOfMonth=[];s.modifiedData=[];s.listStaff=s.listUser.filter(n=>n.UserTitleId==5);s.listManager=s.listUser.filter(n=>n.UserTitleId==4);s.tabId=1;s.checkStaff=t.sessionInfo.IsStaff?!0:!1;s.staffId=t.sessionInfo.IsStaff?t.sessionInfo.UserId:0;s.listTotalComissionAndFee.forEach(function(n){n.Users="";n.User&&(n.User=JSON.parse(n.User),n.Users=n.User.map(n=>n.UserName).join(","))});console.log("vm.listTotalComissionAndFee",s.listTotalComissionAndFee);s.listSalePoint.unshift({Id:0,Name:"Tất cả",Email:null});s.classItem0=s.tabId&&s.tabId==1?"nav-link active":"nav-link";s.classItem1=s.tabId&&s.tabId==2?"nav-link active":"nav-link";s.changeTab=function(n){n===1&&(s.tabId=1);n===2&&(s.tabId=2)};s.changeSalePoint=function(){};s.loadData=function(){s.params.month=moment(s.month).format("YYYY-MM");i.go(i.current,s.params,{reload:!0,notify:!0})};s.clickMonth=function(n){s.month=moment().add(n,"month").format("YYYY-MM");s.loadData()};s.initData=function(){for(var{startDate:e,endDate:o}=h(s.params.month),t=e,n,i,u,f,r;moment(t)<=moment(o);)n=moment(t).format("YYYY-MM-DD"),s.listDateOfMonth.push({Date:n,IsWeekEnd:moment(n).day()==0}),t=moment(t).add(1,"day");s.listCommission=s.listCommission.filter(n=>n.UserTitleId!=2);n=Enumerable.From(s.listCommission).GroupBy(function(n){return n.UserId}).Select(function(n){var r=Enumerable.From(n.source).GroupBy(function(n){return n.Date}).Select(function(n){let t=0;return n.source.forEach(n=>{t+=n.TotalCommision}),{commission:Math.round(t/1e3),date:n.source[0].Date}}).ToArray();let t={};r.forEach(n=>{var i=moment(n.date).date();t[i+""]=n.commission});let i=0;return n.source.forEach(n=>{i+=n.TotalCommision}),{UserId:n.source[0].UserId,FullName:n.source[0].FullName,Commission:t,TotalCommission:i}}).ToArray();s.listStaff.forEach(t=>{var i=n.find(n=>n.UserId==t.UserId);t.Commission=i&&i.Commission||{};t.TotalCommission=i&&i.TotalCommission||0});s.listStaff=s.listStaff.filter(n=>n.SalePointId!=0);s.listStaffGrpBySalePoint=Enumerable.From(s.listStaff).GroupBy(function(n){return n.SalePointId}).Select(function(n){return{SalePointId:n.source[0].SalePointId,SalePointName:s.listSalePoint.filter(t=>t.Id==n.source[0].SalePointId)[0].Name,Data:n.source}}).ToArray();s.listManager.forEach(t=>{var i=n.find(n=>n.UserId==t.UserId);t.Commission=i&&i.Commission||{};t.TotalCommission=i&&i.TotalCommission||0});i=s.listCommission.filter(n=>n.UserId==0);s.adminCommission=Enumerable.From(i).GroupBy(function(n){return n.SalePointId}).Select(function(n){var u=Enumerable.From(n.source).GroupBy(function(n){return n.Date}).Select(function(n){let t=0;return n.source.forEach(n=>{t+=n.TotalCommision}),{commission:Math.round(t/1e3),date:n.source[0].Date}}).ToArray(),t;let i={};u.forEach(n=>{var t=moment(n.date).date();i[t+""]=n.commission});let r=0;return n.source.forEach(n=>{r+=n.TotalCommision}),t="",s.listSalePoint&&s.listSalePoint.length>0&&(t=s.listSalePoint.find(t=>t.Id==n.source[0].SalePointId)),{SalePointName:t?t.Name:"",SalePointId:n.source[0].SalePointId,Commission:i,TotalCommission:r}}).ToArray();s.adminCommission.forEach(n=>{n.TotalCommissionBySalepoint=0;for(let t of Object.values(n.Commission))n.TotalCommissionBySalepoint+=t});u=Enumerable.From(i).GroupBy(function(n){return n.Date}).Select(function(n){var t=0,i;n.source.forEach(n=>{t+=n.TotalCommision});i=moment(n.source[0].Date).date();let r={};return r[i+""]=Math.round(t/1e3),r}).ToArray();s.adminCommissionGroupByDate={};u.forEach(n=>{Object.assign(s.adminCommissionGroupByDate,n)});s.SumAdminCommission=0;for(let n of Object.values(s.adminCommissionGroupByDate))s.SumAdminCommission+=n*1e3;f=Enumerable.From(s.listFee).GroupBy(function(n){return n.Date}).Select(function(n){var t=0,i;n.source.forEach(n=>{t+=n.Fee});i=moment(n.source[0].Date).date();let r={};return r[i+""]=Math.round(t/1e3),r}).ToArray();s.totalFeeByDate={};f.forEach(n=>{Object.assign(s.totalFeeByDate,n)});s.SumFee=0;for(let n of Object.values(s.totalFeeByDate))s.SumFee+=n*1e3;r=Enumerable.From(s.listCommission).GroupBy(function(n){return n.Date}).Select(function(n){var r=0,t;console.log("ele.source",n.source);n.source.forEach(n=>{r+=n.TotalCommision});t=moment(n.source[0].Date).date();let i={};return i[t+""]=Math.round(r/1e3),s.totalFeeByDate[t+""]&&(i[t+""]+=s.totalFeeByDate[t+""],console.log("vm.totalFeeByDate",s.totalFeeByDate)),console.log("obj",i),i}).ToArray();s.totalCommissionByDate={};r.forEach(n=>{Object.assign(s.totalCommissionByDate,n)});s.SumCommission=0;for(let n of Object.values(s.totalCommissionByDate))s.SumCommission+=n*1e3;console.log("temp5",r)};s.initData();console.log("vm.totalCommissionByDate",s.totalCommissionByDate);s.openModalAddCommission=function(){var t=baseAppPath+"/salepoint/views/modal/",n=e.open({templateUrl:t+"addCommission.html"+versionTemplate,controller:"Salepoint.addCommission as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","$stateParams","ddlService",function(n,t,i){var r=n.defer(),u=angular.copy(t);return u.date=moment().format("YYYY-MM-DD"),n.all([i.salePointDDL(),]).then(function(n){var t={params:u,listStaff:s.listStaff,listSalePoint:n[0]};r.resolve(t)}),r.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh")})});n.result.then(function(){},function(n){typeof n=="object"})};s.updateCommissionWinning=function(n){var r=baseAppPath+"/salepoint/views/modal/",t=e.open({templateUrl:r+"updateCommissionWinning.html"+versionTemplate,controller:"Salepoint.updateCommissionWinning as $vm",backdrop:"static",size:"sm",resolve:{viewModel:["$q","$uibModal","userService","ddlService",function(t){var i=t.defer();return t.all([]).then(function(){var t={model:n};i.resolve(t)}),i.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-footer").addClass("remove-modal-footer")})});t.result.then(function(){},function(n){typeof n=="object"&&i.reload()})};s.deleteCommissionWining=function(n){var t=bootbox.confirm({message:' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Bạn có <strong>xoá<\/strong>hoa hồng đst?',buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(t){setTimeout(function(){$(".modal-lg").css("display","block")},500);t&&(o.deleteStaffInCommissionWining({commissionId:n.CommissionId}).then(t=>{t&&t.Id==1&&(s.listTotalComissionAndFee=s.listTotalComissionAndFee.filter(t=>t.CommissionId!=n.CommissionId),u.success("Xoá thành công"))}),console.log("XOA HH DST",n))}});t.init(function(){setTimeout(function(){$(".modal-body").removeClass("modal-body");$(".modal-lg").css("display","none")},0)})}}])})(),function(){app.controller("Salepoint.debtManage",["$scope","$rootScope","$state","viewModel","sortIcon","salepointService","notificationService","dayOfWeekVN",function(n,t,i,r){var u=angular.extend(this,r);u.changeTab=function(n){u.view=n};u.changeTab("debtManage")}])}(),function(){app.controller("Salepoint.guestManage",["$scope","$rootScope","$state","viewModel","sortIcon","salepointService","notificationService","dayOfWeekVN","$uibModal",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r);h.listSalePoint.unshift({Id:0,Name:"Tất cả "});h.listAllGuest.forEach(function(n){n.SalePointName=h.listSalePoint.find(t=>t.Id==n.SalePointId).Name});h.listWholesaleGuest=h.listAllGuest.filter(n=>n.CanBuyWholesale);h.listDebtGuest=h.listAllGuest.filter(n=>!n.CanBuyWholesale);h.loadData=function(){i.go(i.current,h.params,{reload:!0,notify:!0})};h.changeTab=function(n){h.tabId=n};h.openModalEdit=function(n,t){var r=baseAppPath+"/salepoint/views/modal/",i=s.open({params:{},templateUrl:r+"updateGuest.html"+versionTemplate,controller:"Salepoint.updateGuest as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService","salepointService",function(i,r,u){var f=i.defer(),e=angular.copy(r);return i.all([u.lotteryPriceDDL(),u.salePointDDL()]).then(function(i){var r={params:h.params,guestData:n,listPrice:i[0],typeGuest:t,listSalePoint:i[1],listDebtGuest:h.listDebtGuest};f.resolve(r)}),f.promise}]}});i.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","50vh");$(".modal-md").css("max-width","800px")})});i.result.then(function(){},function(n){typeof n=="object"})};h.addNewGuest=function(n){var i=baseAppPath+"/salepoint/views/modal/",t=s.open({params:{},templateUrl:i+"addNewGuest.html"+versionTemplate,controller:"Salepoint.addNewGuest as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService","salepointService",function(t,i,r){var u=t.defer(),f=angular.copy(i);return t.all([r.lotteryPriceDDL(),r.salePointDDL()]).then(function(t){var i={params:h.params,listPrice:t[0],typeGuest:n,listSalePoint:t[1],listDebtGuest:h.listDebtGuest};u.resolve(i)}),u.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","50vh");$(".modal-md").css("max-width","800px")})});t.result.then(function(){},function(n){typeof n=="object"})}}])}(),function(){app.controller("Salepoint.addCommission",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","salepointService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e),h;s.isSaving=!1;h=["DD/MM/YYYY","YYYY-MM-DD","DD-MM-YYYY"];s.params.date=moment(s.params.date,h).format("DD-MM-YYYY");s.userInfo={UserId:t.sessionInfo.UserId};s.listUser=[];s.saveData={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,ActionType:1,Data:{ListStaff:[]}};s.Data={};s.getListUser=function(){s.params.salePointId&&s.params.date&&(s.params.date=moment(s.params.date,h).format("YYYY-MM-DD"),o.getListUserByDateAndSalePoint(s.params).then(function(n){s.listUser=n}));s.listUser.forEach(function(n){n.IsCheck=!1})};s.checkStaff=function(n){var t=[];n.forEach(function(n){n.IsCheck&&t.push(n.UserId)});s.saveData.Data.ListStaff=t};s.save=function(){s.saveData.Data.Fee=s.saveData.Data.Fee?s.saveData.Data.Fee.replaceAll(",",""):0;s.isSaving=!0;s.saveData.Data.ListStaff.length==0?(f.error("Chưa chọn nhân viên"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3)):!s.saveData.Data.Commission||parseInt(s.saveData.Data.Commission)===0||parseInt(s.saveData.Data.Fee)>=parseInt(s.saveData.Data.Commission.replaceAll(",",""))?(f.error("Số tiền không hợp lệ"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},1e3)):(s.saveData.Data.SalePointId=s.params.salePointId,s.saveData.Data.Date=s.params.date,s.saveData.Data.Commission=s.saveData.Data.Commission.replaceAll(",",""),s.saveData.Data.Commission=s.saveData.Data.Commission-s.saveData.Data.Fee,s.saveData.Data=JSON.stringify(s.saveData.Data),o.updateCommission(s.saveData).then(function(n){n&&n.Id>0?setTimeout(function(){f.success(n.Message);i.reload();s.isSaving=!1},1e3):s.isSaving=!1}))};s.cancel=function(){r.close()}}])}(),function(){app.controller("Salepoint.addNewGuest",["$scope","$rootScope","$state","viewModel","sortIcon","salepointService","notificationService","dayOfWeekVN","$uibModalInstance",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r);h.isSaving=!1;h.saving={ActionType:1,UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName};h.listPriceNormal=h.listPrice.filter(n=>n.LotteryTypeIds.includes("1")&&n.LotteryPriceId!=6);h.listPriceDup=h.listPrice.filter(n=>n.LotteryTypeIds.includes("2")&&n.LotteryPriceId!=6);h.listPriceScratchCard=h.listPrice.filter(n=>n.LotteryTypeIds.includes("3")&&n.LotteryPriceId!=6);console.log("lisst",h.listPrice);h.cancel=function(){s.close()};h.findDebtGuest=function(){var n=h.listDebtGuest.find(n=>n.Phone==h.saveData.Phone);n&&(h.saveData=n,h.saveData.ScratchPriceId=null,h.saveData.WholesalePriceId=null,h.saving.ActionType=2)};h.formatCurrency=function(){h.saveData.WholesalePriceId&&(h.saveData.WholesalePriceId=h.saveData.WholesalePriceId.toLocaleString())};h.formatCurrency2=function(){h.saveData.ScratchPriceId&&(h.saveData.ScratchPriceId=h.saveData.ScratchPriceId.toLocaleString())};h.save=function(){h.isSaving=!0;var n=!0;h.saveData.FullName?h.saveData.Phone?h.saveData.SalePointId?h.typeGuest==1&&(h.saveData.WholesalePriceId?h.saveData.ScratchPriceId||(n=!1,e.error("Chưa chọn giá vé cào"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3)):(n=!1,e.error("Chưa chọn giá vé thường"),console.log("WholesalePriceId",h.saveData.WholesalePriceId),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3))):(n=!1,e.error("Chưa chọn điểm bán cho khách hàng"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3)):(n=!1,e.error("Chưa nhập số điện thoại khách hàng"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3)):(n=!1,e.error("Chưa nhập tên khách hàng"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3));n==!0&&(h.saving.Data=JSON.stringify({GuestId:h.saveData.GuestId,FullName:h.saveData.FullName,Phone:h.saveData.Phone,SalePointId:h.saveData.SalePointId,WholesalePriceId:h.saveData.WholesalePriceId.replaceAll(",",""),ScratchPriceId:h.saveData.ScratchPriceId.replaceAll(",","")}),console.log(h.saving.Data),f.updateOrCreateGuest(h.saving).then(function(n){n&&n.Id>0?setTimeout(function(){e.success(n.Message);i.reload();h.isSaving=!1},1e3):setTimeout(function(){e.error(n.Message);h.isSaving=!1;t.$apply(h.isSaving)},1e3)}))}}])}(),function(){app.controller("Salepoint.createInvestor",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","userService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e);s.saveData={Account:"",Password:"tanphat123",FullName:"",Phone:"",Email:"",NumberIdentity:"",BankAccount:"",Address:"",SalePointId:0};s.data={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName};s.save=function(){s.isSaving=!0;var n=[];n.push(s.saveData);s.data.Data=JSON.stringify(n);o.createManager(s.data).then(n=>{n&&n.Id>0&&(f.success(n.Message),r.close(),i.reload())});s.isSaving=!1};s.cancel=function(){r.close()}}])}(),function(){app.controller("Salepoint.updateCommissionWinning",["$scope","$rootScope","$state","viewModel","$uibModalInstance","shiftStatus","userService","notificationService","salepointService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r);h.commission=angular.copy(h.model);h.isSaving=!1;h.save=function(){h.commission.Fee==null||h.commission.TotalCommision==null||h.isSaving||(h.isSaving=!0,s.updateCommisionAndFee({CommisionId:h.commission.CommissionId,Commision:h.commission.TotalCommision,Date:moment(h.commission.Date,"DD-MM-YYYY").format("YYYY-MM-DD"),Fee:h.commission.Fee}).then(function(n){n&&n.Id>0?setTimeout(function(){o.success(n.Message);i.reload();h.isSaving=!1},1e3):setTimeout(function(){o.error(n.Message);h.isSaving=!1;t.$apply(h.isSaving)},1e3)}))};h.close=function(){u.close()}}])}(),function(){app.controller("Salepoint.updateGuest",["$scope","$rootScope","$state","viewModel","sortIcon","salepointService","notificationService","dayOfWeekVN","$uibModalInstance",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r);h.isSaving=!1;h.saving={ActionType:2,UserRoleId:t.sessionInfo.UserRoleId,ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName};h.saveData={GuestId:h.guestData.GuestId,FullName:h.guestData.FullName,Phone:h.guestData.Phone,SalePointId:h.guestData.SalePointId,WholesalePriceId:h.guestData.WholesalePriceId,ScratchPriceId:h.guestData.ScratchPriceId};h.listPriceNormal=h.listPrice.filter(n=>n.LotteryTypeIds.includes("1")&&n.LotteryPriceId!=6);h.listPriceDup=h.listPrice.filter(n=>n.LotteryTypeIds.includes("2")&&n.LotteryPriceId!=6);h.listPriceScratchCard=h.listPrice.filter(n=>n.LotteryTypeIds.includes("3")&&n.LotteryPriceId!=6);console.log("vm.saveData.WholesalePriceId",h.saveData.WholesalePriceId);const c=h.listPrice.find(n=>n.LotteryPriceId==h.saveData.WholesalePriceId);console.log("priceItem",c);h.saveData.WholesalePriceId=c.Price.toLocaleString();const l=h.listPrice.find(n=>n.LotteryPriceId==h.saveData.ScratchPriceId);h.saveData.ScratchPriceId=l.Price.toLocaleString();console.log("dsdsds",h.saveData.WholesalePriceId);h.cancel=function(){s.close()};h.findDebtGuest=function(){var n=h.listDebtGuest.find(n=>n.Phone==h.saveData.Phone);n&&(h.saveData=n,h.saveData.ScratchPriceId=null,h.saveData.WholesalePriceId=null,h.saving.ActionType=2)};h.save=function(){h.isSaving=!0;var n=!0;h.saveData.FullName?h.saveData.Phone?h.saveData.SalePointId?h.typeGuest==1&&(h.saveData.WholesalePriceId?h.saveData.ScratchPriceId||(n=!1,e.error("Chưa chọn giá vé cào"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3)):(n=!1,e.error("Chưa chọn giá vé thường"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3))):(n=!1,e.error("Chưa chọn điểm bán cho khách hàng"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3)):(n=!1,e.error("Chưa nhập số điện thoại khách hàng"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3)):(n=!1,e.error("Chưa nhập tên khách hàng"),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving)},1e3));n==!0&&(h.saving.Data=JSON.stringify({GuestId:h.saveData.GuestId,FullName:h.saveData.FullName,Phone:h.saveData.Phone,SalePointId:h.saveData.SalePointId,WholesalePriceId:h.saveData.WholesalePriceId.replaceAll(",",""),ScratchPriceId:h.saveData.ScratchPriceId.replaceAll(",","")}),f.updateOrCreateGuest(h.saving).then(function(n){n&&n.Id>0?setTimeout(function(){e.success(n.Message);i.reload();h.isSaving=!1},1e3):setTimeout(function(){e.error(n.Message);h.isSaving=!1;t.$apply(h.isSaving)},1e3)}))}}])}(),function(){app.controller("Salepoint.updatePercent",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","salepointService",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,e);s.listData=angular.copy(s.data.MainUserData);s.listBackup=angular.copy(s.data.MainUserData);s.isSaving=!1;s.saveData={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName,Data:[]};s.showForm=!1;s.showFormUpdate=function(){s.showForm=!0};s.closeForm=function(){s.showForm=!1;s.UserId=null;s.Percent=null};s.updateListPercent=function(){s.isSaving=!0;s.UserId?s.Percent?s.listData.filter(n=>n.UserId==s.UserId).length>0?(s.isSaving=!1,setTimeout(function(){t.$apply(s.isSaving)},200),s.getBootBox(s.UserId,1)):(s.listData.push({UserId:s.UserId,FullName:s.listLeader.find(n=>n.UserId==s.UserId).FullName,Percent:s.Percent}),s.isSaving=!1,setTimeout(function(){t.$apply(s.isSaving,s.listData)},200),s.closeForm()):(f.error("Chưa nhập hệ số"),setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving)},200)):(s.isSaving=!1,f.error("Chưa chọn quản lý"),setTimeout(function(){console.log(" vm.isSaving: ",s.isSaving);t.$apply(s.isSaving)},200))};s.getBootBox=function(n,t){var i="",r;i=t==1?' <i class="fa fa-check fa-lg" aria-hidden="true" style="color: green;"><\/i> Quản lý đã có trong danh sách, bạn có <strong>xác nhận cập nhật<\/strong> hệ số?':' <i class="fa fa-times fa-lg" aria-hidden="true" style="color: red;"><\/i> Bạn có muốn <strong>xóa hệ số<\/strong> khỏi danh sách?';r=bootbox.confirm({message:i,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-secondary"}},callback:function(i){setTimeout(function(){$(".modal-md").css("display","block")},500);i&&(s.updateRow(n,t),s.closeForm())}});r.init(function(){setTimeout(function(){$(".modal-md").css("display","none")},0)})};s.updateRow=function(n,i){var r=s.listData.findIndex(t=>t.UserId==n);i==3?s.listData.splice(r,1):s.listData[r].Percent=s.Percent;setTimeout(function(){s.isSaving=!1;t.$apply(s.isSaving,s.listData)},200)};s.checkChange=function(){return s.listBackup.length==s.listData.length?(s.listBackup.forEach(n=>{var t=!1;return s.listData.forEach(i=>{i.UserId==n.UserId&&i.Percent==n.Percent&&(t=!0)}),t==!1?!0:void 0}),!1):!0};s.save=function(){s.isSaving=!0;s.saveData.Data.push({SalePointId:s.data.SalePointId,MainUserData:s.listData});s.saveData.Data=JSON.stringify(s.saveData.Data);o.updatePercent(s.saveData).then(function(n){n&&n.Id>0?(s.isSaving=!1,f.success(n.Message),setTimeout(function(){t.$apply(s.isSaving,s.listData)},200),i.reload()):(s.isSaving=!1,f.warning(n.Message),setTimeout(function(){t.$apply(s.isSaving,s.listData)},200))})};s.cancel=function(){r.close()}}])}(),function(){app.controller("Salepoint.updateStaticFee",["$scope","$rootScope","$state","$uibModalInstance","authService","notificationService","viewModel","salepointService","activityService",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,e);h.dataFee=[];h.isSaving=!1;h.dataFee.fee=h.fee;h.backupFee=h.fee;h.Data={SalePointId:h.model.id,SalePointName:h.model.name,Month:moment(h.month).format("YYYY-MM")};h.dataUpdate={ActionBy:t.sessionInfo.UserId,ActionByName:t.sessionInfo.FullName};h.save=function(){var n=0;n=h.dataFee.fee.replace(/,/g,"");n=parseInt(n);h.Data.Value=n;h.Data.StaticFeeTypeId=h.index;h.isSaving=!0;h.dataFee.fee==h.backupFee?(f.warning("Không có gì để lưu"),h.isSaving=!1):(h.dataUpdate.Data=JSON.stringify(h.Data),s.updateStaticFee(h.dataUpdate).then(function(n){n&&n.Id>0?(f.success(n.Message),setTimeout(function(){h.isSaving=!1;t.$apply(h.isSaving);i.reload()},1500)):(f.warning(n.Message),h.isSaving=!1)}))};h.test=function(){console.log("vm.dataFee.fee: ",h.dataFee.fee)};h.cancel=function(){r.close()}}])}(),function(){app.controller("Salepoint.salePointPercent",["$scope","$rootScope","$state","viewModel","sortIcon","activityService","notificationService","dayOfWeekVN","$uibModal",function(n,t,i,r,u,f,e,o,s){var h=angular.extend(this,r);h.listSalePoint.unshift({Id:0,Name:"Tất cả"});h.month=angular.copy(h.params.month);h.listPercent.forEach(function(n){n.MainUserData=n.MainUserData?JSON.parse(n.MainUserData):[]});h.listData=angular.copy(h.listPercent);h.filterBySalePoint=function(n){h.salePointId=n;h.listData=n!=0?h.listPercent.filter(n=>n.SalePointId==h.salePointId):angular.copy(h.listPercent)};h.openModalCreateInvestor=function(){var t=baseAppPath+"/salepoint/views/modal/",n=s.open({params:{},templateUrl:t+"createInvestor.html"+versionTemplate,controller:"Salepoint.createInvestor as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","userService",function(n,t){var i=n.defer(),r=angular.copy(t);return n.all([]).then(function(){i.resolve()}),i.promise}]}});n.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh");$(".modal-lg").css("max-width","950px")})});n.result.then(function(){},function(n){typeof n=="object"})};h.updatePercent=function(n){var i=baseAppPath+"/salepoint/views/modal/",t=s.open({params:{},templateUrl:i+"updatePercent.html"+versionTemplate,controller:"Salepoint.updatePercent as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService",function(t,i){var r=t.defer(),u=angular.copy(i);return t.all([]).then(function(){var t={data:n,listLeader:h.listLeader};r.resolve(t)}),r.promise}]}});t.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","60vh");$(".modal-lg").css("max-width","950px")})});t.result.then(function(){},function(n){typeof n=="object"})}}])}(),function(){app.controller("Salepoint.staticFee",["$scope","$rootScope","$state","viewModel","notificationService","reportService","shiftStatus","$uibModal",function(n,t,i,r,u,f,e,o){var s=angular.extend(this,r);s.month=s.params.month==""?moment().format("YYYY-MM"):s.params.month;s.thisMonth=moment(s.month,"YYYY-MM").format("MM-YYYY");s.listMonth=[];s.isSaving=!1;s.dataTable=[];s.init=function(){s.listSalePoint.forEach(function(n){var t={};t.name=n.Name;t.id=n.Id;t.data=[];s.listDisplay.forEach(i=>{smallData={id:i.StaticFeeTypeId,fee:0,feeName:i.StaticFeeTypeName,isUpdate:!1,feeNameV:i.StaticFeeTypeNameVIET},t.data.push(smallData),s.listStaticFee.forEach(function(i){n.Id==i.SalePointId&&t.data.forEach(function(n){i.StaticFeeTypeId==1&&n.feeName=="EstateFee"?(n.fee=i.Value,n.isUpdate=!0):i.StaticFeeTypeId==2&&n.feeName=="WaterFee"?(n.fee=i.Value,n.isUpdate=!0):i.StaticFeeTypeId==3&&n.feeName=="InternetFee"?(n.fee=i.Value,n.isUpdate=!0):i.StaticFeeTypeId==4&&n.feeName=="ElectronicFee"&&(n.fee=i.Value,n.isUpdate=!0)})})});s.dataTable.push(t)})};s.init();s.loadData=function(){s.params.month=moment(s.month).format("YYYY-MM")+"-01";i.go(i.current,s.params,{reload:!1,notify:!0})};s.updateStaticFee=function(n,t,i,r,u){var e=baseAppPath+"/salepoint/views/modal/",f=o.open({params:{},templateUrl:e+"updateStaticFee.html"+versionTemplate,controller:"Salepoint.updateStaticFee as $vm",backdrop:"static",size:"md",resolve:{viewModel:["$q","$stateParams","ddlService","reportService","activityService",function(f,e){var o=f.defer(),h=angular.copy(e);return u=moment(s.params.month).format("YYYY-MM"),f.all([]).then(function(){var f={model:n,index:t,fee:i,feeName:r,month:u};o.resolve(f)}),o.promise}]}});f.opened.then(function(){$(document).ready(function(){$(".modal-body").css("height","20vh");$(".modal-lg").css("max-width","950px")})});f.result.then(function(){},function(n){typeof n=="object"})}}])}(),function(){var n=baseAppPath+"/salepoint/views/";routes.salepoint={url:"/salepoint",abstract:!0,template:"<ui-view><\/ui-view>"};routes.salepoint.debtManage={url:"/debtManage",params:{day:{value:"",squash:!0}},templateUrl:n+"debtManage.html"+versionTemplate,controller:"Salepoint.debtManage as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","salepointService","ddlService",function(n,t,i,r,u){var f=n.defer(),e=angular.copy(i);return n.all([u.getListItemConfirm({Month:"2022-06",ConfirmForTypeId:2})]).then(function(n){var t={params:e,listRequestDebt:n[0]};f.resolve(t)}),f.promise}]},title:"Quản lý nợ"};routes.salepoint.salePointPercent={url:"/salePointPercent?month",params:{month:{value:"",squash:!0}},templateUrl:n+"salePointPercent.html"+versionTemplate,controller:"Salepoint.salePointPercent as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","ddlService","salepointService",function(n,t,i,r,u,f,e){var s=n.defer(),o=angular.copy(i);return o.month=o.month!=""?o.month:moment().format("YYYY-MM"),n.all([e.getListSalePointPercent(o),f.salePointDDL(),f.getUserDDL({userTitleId:2})]).then(function(n){var t={params:o,listPercent:n[0],listSalePoint:n[1],listLeader:n[2]};s.resolve(t)}),s.promise}]},title:"Hệ số chia sẻ doanh thu"};routes.salepoint.guestManage={url:"/guestManage?salePointId",params:{salePointId:{value:"0",squash:!0}},templateUrl:n+"guestManage.html"+versionTemplate,controller:"Salepoint.guestManage as $vm",resolve:{viewModel:["$q","$rootScope","$stateParams","userService","activityService","ddlService",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(i);return e.salePointId=e.salePointId?e.salePointId:0,n.all([f.getGuestDDL(e),f.salePointDDL()]).then(function(n){var t={params:e,listAllGuest:n[0],listSalePoint:n[1]};o.resolve(t)}),o.promise}]},title:"Quản lý khách"};routes.salepoint.commissionWinning={url:"/commissionWinning?month",params:{month:{value:"",squash:!0}},templateUrl:n+"commissionWinning.html"+versionTemplate,controller:"Salepoint.commissionWinning as $vm",resolve:{viewModel:["$q","$stateParams","$rootScope","salepointService","userService","ddlService",function(n,t,i,r,u,f){var o=n.defer(),e=angular.copy(t);return e.month=e.month.length>0?e.month:moment().format("YYYY-MM"),n.all([r.getListComission({month:e.month}),r.getListFeeOfCommission({month:e.month}),u.getListUser({p:1,ps:100,qj:1}),f.salePointDDL(),r.getTotalCommisionAndFee({date:e.month,salePointId:0})]).then(function(n){var t={params:e,listCommission:n[0],listFee:n[1],listUser:n[2],listSalePoint:n[3],listTotalComissionAndFee:n[4]};o.resolve(t)}),o.promise}]},title:"Hoa hồng ĐST"};routes.salepoint.staticFee={url:"/staticFee?month",params:{month:{value:"",squash:!0}},templateUrl:n+"staticFee.html"+versionTemplate,controller:"Salepoint.staticFee as $vm",resolve:{viewModel:["$q","$stateParams","userService","reportService","ddlService","salepointService","activityService",function(n,t,i,r,u,f,e){var s=n.defer(),o=angular.copy(t);return o.month=o.month==""?moment().format("YYYY-MM-DD"):o.month,n.all([u.salePointDDL(),e.getStaticFee({month:o.month}),f.getAllStaticFee()]).then(function(n){var t={params:o,listSalePoint:n[0],listStaticFee:n[1],listDisplay:n[2]};s.resolve(t)}),s.promise}]},title:"Chi phí cố định"}}(),function(){app.service("salepointService",["baseService",function(n){var t=n.baseUrl+"/SalePoint";this.updateSalePoint=function(i){var r=t+"/UpdateSalePoint";return n.postData(r,i)};this.getListSalePoint=function(i){var r=t+"/GetListSalePoint";return n.getData(r,i)};this.updateItemInSalePoint=function(i){var r=t+"/UpdateItemInSalePoint";return n.postData(r,i)};this.getListFeeOutsite=function(i){var r=t+"/GetListFeeOutsite";return n.getData(r,i)};this.updateFeeOutSite=function(i){var r=t+"/UpdateFeeOutSite";return n.postData(r,i)};this.updateOrCreateGuest=function(i){var r=t+"/UpdateOrCreateGuest";return n.postData(r,i)};this.getListItemConfirm=function(i){var r=t+"/GetListItemConfirm";return n.getData(r,i)};this.updateOrCreateGuestAction=function(i){var r=t+"/UpdateOrCreateGuestAction";return n.postData(r,i)};this.createListConfirmPayment=function(i){var r=t+"/CreateListConfirmPayment";return n.postData(r,i)};this.getListConfirmPayment=function(i){var r=t+"/GetListConfirmPayment";return n.getData(r,i)};this.getListComission=function(i){var r=t+"/GetListComission";return n.getData(r,i)};this.confirmListPayment=function(i){var r=t+"/ConfirmListPayment";return n.postData(r,i)};this.updateCommission=function(i){var r=t+"/UpdateCommission";return n.postData(r,i)};this.updateHistoryOrder=function(i){var r=t+"/UpdateHistoryOrder";return n.postData(r,i)};this.getListHistoryOrder=function(i){var r=t+"/GetListHistoryOrder";return n.getData(r,i)};this.insertUpdateTransaction=function(i){var r=t+"/InsertUpdateTransaction";return n.postData(r,i)};this.getListUserByDateAndSalePoint=function(i){var r=t+"/GetListUserByDateAndSalePoint";return n.getData(r,i)};this.rewardForUser=function(i){var r=t+"/RewardForUser";return n.postData(r,i)};this.punishUser=function(i){var r=t+"/PunishUser";return n.postData(r,i)};this.saleOfVietlott=function(i){var r=t+"/SaleOfVietlott";return n.postData(r,i)};this.advanceSalary=function(i){var r=t+"/AdvanceSalary ";return n.postData(r,i)};this.getDataForGuestReturn=function(i){var r=t+"/GetDataForGuestReturn";return n.getData(r,i)};this.getListGuestForConfirm=function(i){var r=t+"/GetListGuestForConfirm";return n.getData(r,i)};this.saleOfLoto=function(i){var r=t+"/SaleOfLoto";return n.postData(r,i)};this.getListFeeOfCommission=function(i){var r=t+"/GetListFeeOfCommission";return n.getData(r,i)};this.getListTransaction=function(i){var r=t+"/GetListTransaction";return n.getData(r,i)};this.getListPaymentForConfirm=function(i){var r=t+"/GetListPaymentForConfirm";return n.getData(r,i)};this.debtForUser=function(i){var r=t+"/DebtForUser";return n.postData(r,i)};this.payFundOfUser=function(i){var r=t+"/PayFundOfUser";return n.postData(r,i)};this.getListSalePointOfLeader=function(i){var r=t+"/GetListSalePointOfLeader";return n.getData(r,i)};this.updateDateOffOfLeader=function(i){var r=t+"/UpdateDateOffOfLeader";return n.postData(r,i)};this.getListAttendentOfLeader=function(i){var r=t+"/GetListAttendentOfLeader";return n.getData(r,i)};this.updateLeaderAttendent=function(i){var r=t+"/UpdateLeaderAttendent";return n.postData(r,i)};this.useUnion=function(i){var r=t+"/UseUnion";return n.postData(r,i)};this.payVietlott=function(i){var r=t+"/PayVietlott";return n.postData(r,i)};this.saleOfVietlottForCheck=function(i){var r=t+"/SaleOfVietlottForCheck";return n.postData(r,i)};this.getListSaleOfVietLottInDate=function(i){var r=t+"/GetListSaleOfVietLottInDate";return n.getData(r,i)};this.getListSaleOfVietLottInMonth=function(i){var r=t+"/GetListSaleOfVietLottInMonth";return n.getData(r,i)};this.getListSaleOfLotoInMonth=function(i){var r=t+"/GetListSaleOfLotoInMonth";return n.getData(r,i)};this.getListFeeOutSiteInMonth=function(i){var r=t+"/GetListFeeOutSiteInMonth";return n.getData(r,i)};this.getListUnionInYear=function(i){var r=t+"/GetListUnionInYear";return n.getData(r,i)};this.getListHistoryOfGuest=function(i){var r=t+"/GetListHistoryOfGuest";return n.getData(r,i)};this.getListPayVietlott=function(i){var r=t+"/GetListPayVietlott";return n.getData(r,i)};this.getListSalePointPercent=function(i){var r=t+"/GetListSalePointPercent";return n.getData(r,i)};this.updatePercent=function(i){var r=t+"/UpdatePercent";return n.postData(r,i)};this.getListLotteryAwardExpected=function(i){var r=t+"/GetListLotteryAwardExpected";return n.getData(r,i)};this.getListOtherFees=function(i){var r=t+"/GetListOtherFees";return n.getData(r,i)};this.getTotalCommisionAndFee=function(i){var r=t+"/GetTotalCommisionAndFee";return n.getData(r,i)};this.updateCommisionAndFee=function(i){var r=t+"/UpdateCommisionAndFee";return n.postData(r,i)};this.deleteStaffInCommissionWining=function(i){var r=t+"/DeleteStaffInCommissionWining";return n.postData(r,i)};this.createSubAgency=function(i){var r=t+"/CreateSubAgency";return n.postData(r,i)};this.getAllStaticFee=function(i){var r=t+"/GetAllStaticFee";return n.getData(r,i)}}])}();